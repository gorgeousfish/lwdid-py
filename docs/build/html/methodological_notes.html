

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Methodological Notes &mdash; lwdid 0.2.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=938c9ccc"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing Guide" href="contributing.html" />
    <link rel="prev" title="Exceptions Module (exceptions)" href="api/exceptions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            lwdid
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#system-requirements">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-methods">Installation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#install-via-pip-recommended">Install via pip (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#install-from-source">Install from Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#common-issues">Common Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#numpy-version-conflicts">numpy Version Conflicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#statsmodels-installation-failure">statsmodels Installation Failure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#basic-example">Basic Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#simplest-usage">Simplest Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#key-parameters">Key Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#required-parameters">Required Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#common-options">Common Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#small-sample-exact-inference">Small-Sample Exact Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#large-sample-inference">Large-Sample Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#doubly-robust-estimation">Doubly Robust Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#randomization-inference">Randomization Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#adding-control-variables">Adding Control Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#quarterly-data">Quarterly Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#results-object">Results Object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#core-attributes">Core Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#sample-information">Sample Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#period-specific-effects">Period-Specific Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#methods">Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#data-format-requirements">Data Format Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#panel-data-structure">Panel Data Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#key-requirements">Key Requirements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#staggered-adoption">Staggered Adoption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#staggered-results">Staggered Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#key-staggered-parameters">Key Staggered Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#scenario-selection-guide">Scenario Selection Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#quick-reference">Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#transformation-methods">Transformation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#demean-standard-did-with-unit-fixed-effects">demean: Standard DiD with Unit Fixed Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#detrend-did-with-unit-specific-linear-trends">detrend: DiD with Unit-Specific Linear Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#demeanq-seasonal-data-with-seasonal-fixed-effects">demeanq: Seasonal Data with Seasonal Fixed Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#detrendq-seasonal-data-with-trends-and-seasonal-effects">detrendq: Seasonal Data with Trends and Seasonal Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#variance-estimation">Variance Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#ols-homoskedastic">OLS (Homoskedastic)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#hc0-white-s-heteroskedasticity-consistent">HC0 (Whiteâ€™s Heteroskedasticity-Consistent)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#hc1-heteroskedasticity-robust">HC1 (Heteroskedasticity-Robust)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#hc2-leverage-adjusted">HC2 (Leverage-Adjusted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#hc3-small-sample-adjusted-robust">HC3 (Small-Sample Adjusted Robust)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#hc4-high-leverage-adjusted">HC4 (High-Leverage Adjusted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#cluster-robust">Cluster-Robust</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#randomization-inference">Randomization Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#ri-methods">RI Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#accessing-ri-results">Accessing RI Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#control-variables">Control Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#id1">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#effect-on-inference">Effect on Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#working-with-results">Working with Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#core-estimates">Core Estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#period-specific-effects">Period-Specific Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#sample-information">Sample Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#export-results">Export Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#print-summary">Print Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#data-requirements-and-validation">Data Requirements and Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#panel-structure">Panel Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#treatment-structure">Treatment Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#treatment-indicator">Treatment Indicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#missing-data">Missing Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#never-treated-unit-data-preparation">Never-Treated Unit Data Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#valid-never-treated-encodings">Valid Never-Treated Encodings</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#converting-from-stata-data">Converting from Stata Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#checking-never-treated-status">Checking Never-Treated Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#common-issues-and-solutions">Common Issues and Solutions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#choosing-transformation-method">Choosing Transformation Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#choosing-variance-estimator">Choosing Variance Estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#sample-size-considerations">Sample Size Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#sample-size-and-inference-method-selection-matrix">Sample Size and Inference Method Selection Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#estimator-selection-large-sample-common-timing">Estimator Selection (Large-Sample Common Timing)</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#diagnostic-checks">Diagnostic Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#common-errors">Common Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#performance-tips">Performance Tips</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#staggered-adoption-design">Staggered Adoption Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#id2">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#staggered-specific-parameters">Staggered-Specific Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#robustness-to-no-anticipation-violations">Robustness to No-Anticipation Violations</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#accessing-staggered-results">Accessing Staggered Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#control-group-strategies">Control Group Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#estimator-selection">Estimator Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#staggered-example">Staggered Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#pre-treatment-dynamics-and-parallel-trends-testing">Pre-treatment Dynamics and Parallel Trends Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#why-pre-treatment-dynamics-matter">Why Pre-treatment Dynamics Matter</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#id3">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#accessing-pre-treatment-results">Accessing Pre-treatment Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#interpreting-the-parallel-trends-test">Interpreting the Parallel Trends Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#event-study-visualization-with-pre-treatment">Event Study Visualization with Pre-treatment</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#complete-workflow-example">Complete Workflow Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#transformation-methods-for-pre-treatment">Transformation Methods for Pre-treatment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#trend-diagnostics-tools">Trend Diagnostics Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#testing-parallel-trends-with-standalone-function">Testing Parallel Trends with Standalone Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#diagnosing-heterogeneous-trends">Diagnosing Heterogeneous Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#getting-automated-transformation-recommendation">Getting Automated Transformation Recommendation</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide.html#visualizing-cohort-trends">Visualizing Cohort Trends</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#basic-did-estimation">Basic DiD Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#california-smoking-restriction">California Smoking Restriction</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#robustness-checks">Robustness Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#quarterly-data">Quarterly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#retail-sales-with-seasonal-patterns">Retail Sales with Seasonal Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#monthly-data">Monthly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#monthly-sales-with-seasonal-adjustment-q-12">Monthly Sales with Seasonal Adjustment (Q=12)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#weekly-data">Weekly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#weekly-sales-with-seasonal-adjustment-q-52">Weekly Sales with Seasonal Adjustment (Q=52)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#control-variables">Control Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#including-baseline-characteristics">Including Baseline Characteristics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#cluster-robust-inference">Cluster-Robust Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#multi-level-data-structure">Multi-Level Data Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#randomization-inference">Randomization Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#non-parametric-testing">Non-Parametric Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#comparing-ri-methods">Comparing RI Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#diagnostic-checks">Diagnostic Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#testing-parallel-trends">Testing Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#sensitivity-analysis">Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#export-and-reporting">Export and Reporting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#creating-publication-tables">Creating Publication Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#staggered-did-castle-law">Staggered DiD: Castle Law</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#castle-doctrine-analysis">Castle Doctrine Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#complete-workflow-example">Complete Workflow Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/index.html#end-to-end-analysis">End-to-End Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#core-modules">Core Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/core.html">Core Module (core)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/core.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/core.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/core.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/results.html">Results Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/results.html#attributes-reference">Attributes Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/results.html#methods-reference">Methods Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/results.html#usage-by-design-type">Usage by Design Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/results.html#lwdidresults-class">LWDIDResults Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/results.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/results.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/staggered.html">Staggered DiD Module (staggered)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#key-concepts">Key Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#transformations">Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#control-groups">Control Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#estimation">Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#aggregation">Aggregation</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#ipw-estimator">IPW Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#ipwra-estimator">IPWRA Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#psm-estimator">PSM Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#inference-distribution-by-estimator">Inference Distribution by Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#randomization-inference">Randomization Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#pre-treatment-dynamics">Pre-treatment Dynamics</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/staggered.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/transformations.html">Transformations Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#available-transformations">Available Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#id1">Available Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#unit-level-functions">Unit-Level Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#internal-functions">Internal Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#transformation-selection-guide">Transformation Selection Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#staggered-adoption-transformations">Staggered Adoption Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/transformations.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/estimation.html">Estimation Module (estimation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#lwdid.estimation.prepare_controls"><code class="docutils literal notranslate"><span class="pre">prepare_controls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#lwdid.estimation.estimate_att"><code class="docutils literal notranslate"><span class="pre">estimate_att()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#lwdid.estimation.estimate_period_effects"><code class="docutils literal notranslate"><span class="pre">estimate_period_effects()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#estimation-functions">Estimation Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#variance-estimators">Variance Estimators</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#implementation-details">Implementation Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#technical-notes">Technical Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#large-sample-inference">Large-Sample Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#estimator-selection-for-large-samples">Estimator Selection for Large Samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/estimation.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#inference-and-diagnostics">Inference and Diagnostics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/inference.html">Inference Module (inference)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#wild-cluster-bootstrap">Wild Cluster Bootstrap</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#methodological-notes">Methodological Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#guidelines">Guidelines</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/clustering_diagnostics.html">Clustering Diagnostics Module (clustering_diagnostics)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#enums">Enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#data-classes">Data Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#main-functions">Main Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#guidelines">Guidelines</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/clustering_diagnostics.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/trend_diagnostics.html">Trend Diagnostics Module (trend_diagnostics)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.TrendTestMethod"><code class="docutils literal notranslate"><span class="pre">TrendTestMethod</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.TransformationMethod"><code class="docutils literal notranslate"><span class="pre">TransformationMethod</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.RecommendationConfidence"><code class="docutils literal notranslate"><span class="pre">RecommendationConfidence</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.PreTrendEstimate"><code class="docutils literal notranslate"><span class="pre">PreTrendEstimate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.CohortTrendEstimate"><code class="docutils literal notranslate"><span class="pre">CohortTrendEstimate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.TrendDifference"><code class="docutils literal notranslate"><span class="pre">TrendDifference</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.ParallelTrendsTestResult"><code class="docutils literal notranslate"><span class="pre">ParallelTrendsTestResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.HeterogeneousTrendsDiagnostics"><code class="docutils literal notranslate"><span class="pre">HeterogeneousTrendsDiagnostics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.TransformationRecommendation"><code class="docutils literal notranslate"><span class="pre">TransformationRecommendation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.test_parallel_trends"><code class="docutils literal notranslate"><span class="pre">test_parallel_trends()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.diagnose_heterogeneous_trends"><code class="docutils literal notranslate"><span class="pre">diagnose_heterogeneous_trends()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.recommend_transformation"><code class="docutils literal notranslate"><span class="pre">recommend_transformation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#lwdid.trend_diagnostics.plot_cohort_trends"><code class="docutils literal notranslate"><span class="pre">plot_cohort_trends()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#testing-functions">Testing Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#visualization">Visualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#result-classes">Result Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#supporting-data-classes">Supporting Data Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/trend_diagnostics.html#methodological-background">Methodological Background</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/selection_diagnostics.html">Selection Diagnostics Module (selection_diagnostics)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#enums">Enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#data-classes">Data Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#main-functions">Main Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#interpretation-guide">Interpretation Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/selection_diagnostics.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/sensitivity.html">Sensitivity Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/sensitivity.html#main-functions">Main Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sensitivity.html#result-classes">Result Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sensitivity.html#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sensitivity.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sensitivity.html#interpreting-results">Interpreting Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sensitivity.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#data-processing">Data Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/preprocessing.html">Preprocessing Module (preprocessing)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#key-functions">Key Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#key-classes">Key Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#main-functions">Main Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#result-classes">Result Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#methodological-notes">Methodological Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/preprocessing.html#data-requirements">Data Requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/validation.html">Validation Module (validation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.validate_and_prepare_data"><code class="docutils literal notranslate"><span class="pre">validate_and_prepare_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.validate_season_diversity"><code class="docutils literal notranslate"><span class="pre">validate_season_diversity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.validate_season_coverage"><code class="docutils literal notranslate"><span class="pre">validate_season_coverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.validate_quarter_diversity"><code class="docutils literal notranslate"><span class="pre">validate_quarter_diversity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.validate_quarter_coverage"><code class="docutils literal notranslate"><span class="pre">validate_quarter_coverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.get_cohort_mask"><code class="docutils literal notranslate"><span class="pre">get_cohort_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.is_never_treated"><code class="docutils literal notranslate"><span class="pre">is_never_treated()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.validate_staggered_data"><code class="docutils literal notranslate"><span class="pre">validate_staggered_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#lwdid.validation.detect_frequency"><code class="docutils literal notranslate"><span class="pre">detect_frequency()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#validation-checks">Validation Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#validation-functions">Validation Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#never-treated-unit-identification">Never-Treated Unit Identification</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#staggered-adoption-validation">Staggered Adoption Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#common-validation-errors-and-solutions">Common Validation Errors and Solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/validation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/randomization.html">Randomization Inference Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#resampling-methods">Resampling Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#returns">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#methodological-notes">Methodological Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/randomization.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/visualization.html">Visualization Module (visualization)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#lwdid.visualization.prepare_plot_data"><code class="docutils literal notranslate"><span class="pre">prepare_plot_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#lwdid.visualization.plot_results"><code class="docutils literal notranslate"><span class="pre">plot_results()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#plot-components">Plot Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#advanced-customization">Advanced Customization</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#staggered-adoption-visualization">Staggered Adoption Visualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#exporting-plots">Exporting Plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#plot-parameters-reference">Plot Parameters Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#examples-gallery">Examples Gallery</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/visualization.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/exceptions.html">Exceptions Module (exceptions)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.LWDIDError"><code class="docutils literal notranslate"><span class="pre">LWDIDError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InvalidParameterError"><code class="docutils literal notranslate"><span class="pre">InvalidParameterError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InvalidRollingMethodError"><code class="docutils literal notranslate"><span class="pre">InvalidRollingMethodError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InvalidVCETypeError"><code class="docutils literal notranslate"><span class="pre">InvalidVCETypeError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.UnbalancedPanelError"><code class="docutils literal notranslate"><span class="pre">UnbalancedPanelError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InsufficientDataError"><code class="docutils literal notranslate"><span class="pre">InsufficientDataError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.NoTreatedUnitsError"><code class="docutils literal notranslate"><span class="pre">NoTreatedUnitsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.NoControlUnitsError"><code class="docutils literal notranslate"><span class="pre">NoControlUnitsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InsufficientPrePeriodsError"><code class="docutils literal notranslate"><span class="pre">InsufficientPrePeriodsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InsufficientQuarterDiversityError"><code class="docutils literal notranslate"><span class="pre">InsufficientQuarterDiversityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.TimeDiscontinuityError"><code class="docutils literal notranslate"><span class="pre">TimeDiscontinuityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.MissingRequiredColumnError"><code class="docutils literal notranslate"><span class="pre">MissingRequiredColumnError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.RandomizationError"><code class="docutils literal notranslate"><span class="pre">RandomizationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.VisualizationError"><code class="docutils literal notranslate"><span class="pre">VisualizationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InvalidStaggeredDataError"><code class="docutils literal notranslate"><span class="pre">InvalidStaggeredDataError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.NoNeverTreatedError"><code class="docutils literal notranslate"><span class="pre">NoNeverTreatedError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.AggregationError"><code class="docutils literal notranslate"><span class="pre">AggregationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InvalidAggregationError"><code class="docutils literal notranslate"><span class="pre">InvalidAggregationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#lwdid.exceptions.InsufficientCellSizeError"><code class="docutils literal notranslate"><span class="pre">InsufficientCellSizeError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#exception-classes">Exception Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#error-handling-best-practices">Error Handling Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#common-error-scenarios">Common Error Scenarios</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/exceptions.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#quick-index">Quick Index</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Methodological Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-panel-to-cross-section-transformation">The Panel-to-Cross-Section Transformation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#core-principle">Core Principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demean-transformation-procedure-2-1">Demean Transformation (Procedure 2.1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detrend-transformation-procedure-3-1">Detrend Transformation (Procedure 3.1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#seasonal-transformations-demeanq-detrendq">Seasonal Transformations (demeanq/detrendq)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inference-under-clm-assumptions">Inference Under CLM Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#classical-linear-model-assumptions">Classical Linear Model Assumptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#degrees-of-freedom">Degrees of Freedom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#period-specific-effects">Period-Specific Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robust-inference">Robust Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#heteroskedasticity-robust-standard-errors">Heteroskedasticity-Robust Standard Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-robust-standard-errors">Cluster-Robust Standard Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#randomization-inference">Randomization Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clustering-at-higher-levels">Clustering at Higher Levels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#when-to-cluster-at-higher-levels">When to Cluster at Higher Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#minimum-cluster-requirements">Minimum Cluster Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Degrees of Freedom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diagnosing-clustering-structure">Diagnosing Clustering Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-a-clustering-recommendation">Getting a Clustering Recommendation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-clustering-consistency">Checking Clustering Consistency</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wild-cluster-bootstrap">Wild Cluster Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clustering-workflow">Clustering Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references-for-clustering">References for Clustering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#large-sample-asymptotic-inference">Large-Sample Asymptotic Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#asymptotic-theory">Asymptotic Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#doubly-robust-estimation">Doubly Robust Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efficiency-considerations">Efficiency Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#monte-carlo-simulation-evidence">Monte Carlo Simulation Evidence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#when-to-use-large-sample-methods">When to Use Large-Sample Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inference-distribution-by-estimator">Inference Distribution by Estimator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#identification-assumptions">Identification Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#no-anticipation">No Anticipation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parallel-trends">Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-treatment-timing-common-timing-mode">Common Treatment Timing (Common Timing Mode)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#treatment-persistence">Treatment Persistence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unbalanced-panels-and-selection-mechanism">Unbalanced Panels and Selection Mechanism</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#selection-mechanism-assumption">Selection Mechanism Assumption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#acceptable-missing-data-patterns">Acceptable Missing Data Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problematic-missing-data-patterns">Problematic Missing Data Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detrending-for-robustness">Detrending for Robustness</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diagnosing-selection-risk">Diagnosing Selection Risk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controlling-panel-balance">Controlling Panel Balance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#heterogeneous-trends-and-assumption-cht">Heterogeneous Trends and Assumption CHT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#assumption-cht">Assumption CHT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-difference-under-cht">First Difference Under CHT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choosing-between-demean-and-detrend">Choosing Between Demean and Detrend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#procedure-5-1-detrending-under-cht">Procedure 5.1: Detrending Under CHT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-parallel-trends">Testing Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diagnosing-heterogeneous-trends">Diagnosing Heterogeneous Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-a-transformation-recommendation">Getting a Transformation Recommendation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pre-treatment-period-dynamics">Pre-treatment Period Dynamics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rolling-transformation-for-pre-treatment-periods">Rolling Transformation for Pre-treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anchor-point-convention">Anchor Point Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-treatment-att-estimation">Pre-treatment ATT Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-group-for-pre-treatment-periods">Control Group for Pre-treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joint-test-for-parallel-trends">Joint Test for Parallel Trends</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comparison-with-other-did-methods">Comparison with Other DiD Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#two-way-fixed-effects-twfe">Two-Way Fixed Effects (TWFE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#callaway-and-sant-anna-2021">Callaway and Santâ€™Anna (2021)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-to-use-this-method">When to Use This Method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#practical-considerations">Practical Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sample-size-requirements">Sample Size Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-index-and-panel-structure">Time Index and Panel Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-treatment-periods">Pre-Treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-variables">Control Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computational-considerations">Computational Considerations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#staggered-adoption">Staggered Adoption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#identification">Identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transformation">Transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-group-strategies">Control Group Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#all-units-eventually-treated">All Units Eventually Treated</a></li>
<li class="toctree-l3"><a class="reference internal" href="#estimation-methods">Estimation Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Inference Distribution by Estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aggregation">Aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event-time-aggregation-watt">Event Time Aggregation (WATT)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robustness-to-pre-treatment-period-selection">Robustness to Pre-treatment Period Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sensitivity-ratio">Sensitivity Ratio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-robustness-pre-periods">Using robustness_pre_periods()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#no-anticipation-sensitivity">No-Anticipation Sensitivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-exclude-pre-periods-parameter">Using exclude_pre_periods Parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comprehensive-sensitivity-analysis">Comprehensive Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#how-to-contribute">How to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#code-standards">Code Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#reporting-issues">Reporting Issues</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lwdid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Methodological Notes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/methodological_notes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="methodological-notes">
<h1>Methodological Notes<a class="headerlink" href="#methodological-notes" title="Link to this heading">ïƒ</a></h1>
<p>This document provides the theoretical foundation and methodological details for the
Lee and Wooldridge difference-in-differences methods implemented in <code class="docutils literal notranslate"><span class="pre">lwdid</span></code>.</p>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id4">Overview</a></p></li>
<li><p><a class="reference internal" href="#the-panel-to-cross-section-transformation" id="id5">The Panel-to-Cross-Section Transformation</a></p>
<ul>
<li><p><a class="reference internal" href="#core-principle" id="id6">Core Principle</a></p></li>
<li><p><a class="reference internal" href="#demean-transformation-procedure-2-1" id="id7">Demean Transformation (Procedure 2.1)</a></p></li>
<li><p><a class="reference internal" href="#detrend-transformation-procedure-3-1" id="id8">Detrend Transformation (Procedure 3.1)</a></p></li>
<li><p><a class="reference internal" href="#seasonal-transformations-demeanq-detrendq" id="id9">Seasonal Transformations (demeanq/detrendq)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#inference-under-clm-assumptions" id="id10">Inference Under CLM Assumptions</a></p>
<ul>
<li><p><a class="reference internal" href="#classical-linear-model-assumptions" id="id11">Classical Linear Model Assumptions</a></p></li>
<li><p><a class="reference internal" href="#degrees-of-freedom" id="id12">Degrees of Freedom</a></p></li>
<li><p><a class="reference internal" href="#period-specific-effects" id="id13">Period-Specific Effects</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#robust-inference" id="id14">Robust Inference</a></p>
<ul>
<li><p><a class="reference internal" href="#heteroskedasticity-robust-standard-errors" id="id15">Heteroskedasticity-Robust Standard Errors</a></p></li>
<li><p><a class="reference internal" href="#cluster-robust-standard-errors" id="id16">Cluster-Robust Standard Errors</a></p></li>
<li><p><a class="reference internal" href="#randomization-inference" id="id17">Randomization Inference</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#clustering-at-higher-levels" id="id18">Clustering at Higher Levels</a></p>
<ul>
<li><p><a class="reference internal" href="#when-to-cluster-at-higher-levels" id="id19">When to Cluster at Higher Levels</a></p></li>
<li><p><a class="reference internal" href="#minimum-cluster-requirements" id="id20">Minimum Cluster Requirements</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id21">Degrees of Freedom</a></p></li>
<li><p><a class="reference internal" href="#diagnosing-clustering-structure" id="id22">Diagnosing Clustering Structure</a></p></li>
<li><p><a class="reference internal" href="#getting-a-clustering-recommendation" id="id23">Getting a Clustering Recommendation</a></p></li>
<li><p><a class="reference internal" href="#checking-clustering-consistency" id="id24">Checking Clustering Consistency</a></p></li>
<li><p><a class="reference internal" href="#wild-cluster-bootstrap" id="id25">Wild Cluster Bootstrap</a></p></li>
<li><p><a class="reference internal" href="#clustering-workflow" id="id26">Clustering Workflow</a></p></li>
<li><p><a class="reference internal" href="#references-for-clustering" id="id27">References for Clustering</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#large-sample-asymptotic-inference" id="id28">Large-Sample Asymptotic Inference</a></p>
<ul>
<li><p><a class="reference internal" href="#asymptotic-theory" id="id29">Asymptotic Theory</a></p></li>
<li><p><a class="reference internal" href="#doubly-robust-estimation" id="id30">Doubly Robust Estimation</a></p></li>
<li><p><a class="reference internal" href="#efficiency-considerations" id="id31">Efficiency Considerations</a></p></li>
<li><p><a class="reference internal" href="#when-to-use-large-sample-methods" id="id32">When to Use Large-Sample Methods</a></p></li>
<li><p><a class="reference internal" href="#inference-distribution-by-estimator" id="id33">Inference Distribution by Estimator</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#identification-assumptions" id="id34">Identification Assumptions</a></p>
<ul>
<li><p><a class="reference internal" href="#no-anticipation" id="id35">No Anticipation</a></p></li>
<li><p><a class="reference internal" href="#parallel-trends" id="id36">Parallel Trends</a></p></li>
<li><p><a class="reference internal" href="#common-treatment-timing-common-timing-mode" id="id37">Common Treatment Timing (Common Timing Mode)</a></p></li>
<li><p><a class="reference internal" href="#treatment-persistence" id="id38">Treatment Persistence</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#unbalanced-panels-and-selection-mechanism" id="id39">Unbalanced Panels and Selection Mechanism</a></p>
<ul>
<li><p><a class="reference internal" href="#selection-mechanism-assumption" id="id40">Selection Mechanism Assumption</a></p></li>
<li><p><a class="reference internal" href="#acceptable-missing-data-patterns" id="id41">Acceptable Missing Data Patterns</a></p></li>
<li><p><a class="reference internal" href="#problematic-missing-data-patterns" id="id42">Problematic Missing Data Patterns</a></p></li>
<li><p><a class="reference internal" href="#detrending-for-robustness" id="id43">Detrending for Robustness</a></p></li>
<li><p><a class="reference internal" href="#diagnosing-selection-risk" id="id44">Diagnosing Selection Risk</a></p></li>
<li><p><a class="reference internal" href="#controlling-panel-balance" id="id45">Controlling Panel Balance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#heterogeneous-trends-and-assumption-cht" id="id46">Heterogeneous Trends and Assumption CHT</a></p>
<ul>
<li><p><a class="reference internal" href="#assumption-cht" id="id47">Assumption CHT</a></p></li>
<li><p><a class="reference internal" href="#first-difference-under-cht" id="id48">First Difference Under CHT</a></p></li>
<li><p><a class="reference internal" href="#choosing-between-demean-and-detrend" id="id49">Choosing Between Demean and Detrend</a></p></li>
<li><p><a class="reference internal" href="#procedure-5-1-detrending-under-cht" id="id50">Procedure 5.1: Detrending Under CHT</a></p></li>
<li><p><a class="reference internal" href="#testing-parallel-trends" id="id51">Testing Parallel Trends</a></p></li>
<li><p><a class="reference internal" href="#diagnosing-heterogeneous-trends" id="id52">Diagnosing Heterogeneous Trends</a></p></li>
<li><p><a class="reference internal" href="#getting-a-transformation-recommendation" id="id53">Getting a Transformation Recommendation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pre-treatment-period-dynamics" id="id54">Pre-treatment Period Dynamics</a></p>
<ul>
<li><p><a class="reference internal" href="#motivation" id="id55">Motivation</a></p></li>
<li><p><a class="reference internal" href="#rolling-transformation-for-pre-treatment-periods" id="id56">Rolling Transformation for Pre-treatment Periods</a></p></li>
<li><p><a class="reference internal" href="#anchor-point-convention" id="id57">Anchor Point Convention</a></p></li>
<li><p><a class="reference internal" href="#pre-treatment-att-estimation" id="id58">Pre-treatment ATT Estimation</a></p></li>
<li><p><a class="reference internal" href="#control-group-for-pre-treatment-periods" id="id59">Control Group for Pre-treatment Periods</a></p></li>
<li><p><a class="reference internal" href="#joint-test-for-parallel-trends" id="id60">Joint Test for Parallel Trends</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#comparison-with-other-did-methods" id="id61">Comparison with Other DiD Methods</a></p>
<ul>
<li><p><a class="reference internal" href="#two-way-fixed-effects-twfe" id="id62">Two-Way Fixed Effects (TWFE)</a></p></li>
<li><p><a class="reference internal" href="#callaway-and-sant-anna-2021" id="id63">Callaway and Santâ€™Anna (2021)</a></p></li>
<li><p><a class="reference internal" href="#when-to-use-this-method" id="id64">When to Use This Method</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#practical-considerations" id="id65">Practical Considerations</a></p>
<ul>
<li><p><a class="reference internal" href="#sample-size-requirements" id="id66">Sample Size Requirements</a></p></li>
<li><p><a class="reference internal" href="#time-index-and-panel-structure" id="id67">Time Index and Panel Structure</a></p></li>
<li><p><a class="reference internal" href="#pre-treatment-periods" id="id68">Pre-Treatment Periods</a></p></li>
<li><p><a class="reference internal" href="#control-variables" id="id69">Control Variables</a></p></li>
<li><p><a class="reference internal" href="#computational-considerations" id="id70">Computational Considerations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#limitations" id="id71">Limitations</a></p></li>
<li><p><a class="reference internal" href="#staggered-adoption" id="id72">Staggered Adoption</a></p>
<ul>
<li><p><a class="reference internal" href="#identification" id="id73">Identification</a></p></li>
<li><p><a class="reference internal" href="#transformation" id="id74">Transformation</a></p></li>
<li><p><a class="reference internal" href="#control-group-strategies" id="id75">Control Group Strategies</a></p></li>
<li><p><a class="reference internal" href="#all-units-eventually-treated" id="id76">All Units Eventually Treated</a></p></li>
<li><p><a class="reference internal" href="#estimation-methods" id="id77">Estimation Methods</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id78">Inference Distribution by Estimator</a></p></li>
<li><p><a class="reference internal" href="#aggregation" id="id79">Aggregation</a></p></li>
<li><p><a class="reference internal" href="#event-time-aggregation-watt" id="id80">Event Time Aggregation (WATT)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#robustness-to-pre-treatment-period-selection" id="id81">Robustness to Pre-treatment Period Selection</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id82">Motivation</a></p></li>
<li><p><a class="reference internal" href="#sensitivity-ratio" id="id83">Sensitivity Ratio</a></p></li>
<li><p><a class="reference internal" href="#using-robustness-pre-periods" id="id84">Using robustness_pre_periods()</a></p></li>
<li><p><a class="reference internal" href="#no-anticipation-sensitivity" id="id85">No-Anticipation Sensitivity</a></p></li>
<li><p><a class="reference internal" href="#using-exclude-pre-periods-parameter" id="id86">Using exclude_pre_periods Parameter</a></p></li>
<li><p><a class="reference internal" href="#comprehensive-sensitivity-analysis" id="id87">Comprehensive Sensitivity Analysis</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id88">References</a></p></li>
<li><p><a class="reference internal" href="#further-reading" id="id89">Further Reading</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">ïƒ</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> package implements the Lee and Wooldridge methods for difference-in-
differences estimation with panel data, covering three scenarios:</p>
<ol class="arabic simple">
<li><p><strong>Small-sample common timing</strong> (Lee and Wooldridge, 2026): Exact t-based inference
under classical linear model assumptions when the number of cross-sectional units
is small.</p></li>
<li><p><strong>Large-sample common timing</strong> (Lee and Wooldridge, 2025): Rolling transformation
approach with asymptotic inference using robust standard errors.</p></li>
<li><p><strong>Staggered adoption</strong> (Lee and Wooldridge, 2025): Extension to settings where
units are treated at different times, with cohort-time specific effect estimation.</p></li>
</ol>
<p>The core method transforms panel data into cross-sectional form via unit-specific
time-series operations:</p>
<ol class="arabic simple">
<li><p>Transform panel data into cross-sectional form via unit-specific time-series operations</p></li>
<li><p>Estimate treatment effects from a cross-sectional regression on transformed data</p></li>
<li><p>Under classical linear model assumptions (including normality and homoskedasticity),
conduct exact t-based inference from the cross-sectional regression</p></li>
</ol>
<p>The method exploits an algebraic equivalence: by removing unit-specific pre-treatment
patterns (means or trends), the panel DiD estimator can be obtained from a cross-sectional
regression where exact finite-sample inference is available under the classical linear
model assumptions, particularly normality and homoskedasticity of the error term, when
homoskedastic OLS standard errors are used.</p>
</section>
<section id="the-panel-to-cross-section-transformation">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">The Panel-to-Cross-Section Transformation</a><a class="headerlink" href="#the-panel-to-cross-section-transformation" title="Link to this heading">ïƒ</a></h2>
<section id="core-principle">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Core Principle</a><a class="headerlink" href="#core-principle" title="Link to this heading">ïƒ</a></h3>
<p>The method removes unit-specific time-series patterns using only pre-treatment data,
then pools the transformed outcomes across units. This proceeds in two steps:</p>
<ol class="arabic simple">
<li><p><strong>Transformation step</strong>: Apply a unit-specific time-series transformation using
pre-treatment periods only</p></li>
<li><p><strong>Regression step</strong>: Estimate treatment effects from a cross-sectional regression
on the transformed outcomes</p></li>
</ol>
<p>The transformation uses only pre-treatment information, preserving the treatment
variation for estimation in the second step.</p>
</section>
<section id="demean-transformation-procedure-2-1">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Demean Transformation (Procedure 2.1)</a><a class="headerlink" href="#demean-transformation-procedure-2-1" title="Link to this heading">ïƒ</a></h3>
<p><strong>Setup</strong></p>
<p>Conceptually, unit <span class="math notranslate nohighlight">\(i\)</span> is observed over <span class="math notranslate nohighlight">\(T\)</span> periods
(<span class="math notranslate nohighlight">\(t = 1, \ldots, T\)</span>). Treatment begins at period <span class="math notranslate nohighlight">\(S\)</span>, where
<span class="math notranslate nohighlight">\(S \in \{2, \ldots, T\}\)</span>. Pre-treatment periods are
<span class="math notranslate nohighlight">\(t = 1, \ldots, S-1\)</span> (<span class="math notranslate nohighlight">\(T_0 = S-1\)</span> periods). Post-treatment periods
are <span class="math notranslate nohighlight">\(t = S, \ldots, T\)</span> (<span class="math notranslate nohighlight">\(T_1 = T-S+1\)</span> periods).</p>
<p>In the notation of Lee and Wooldridge (2026), this description uses a balanced-panel
setup where each unit is observed in all T periods. The <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> implementation also
accommodates unbalanced panels: units need not appear in every period. However, each
unit included in the data must have at least one pre-treatment observation so that its
pre-treatment mean can be computed. Units without any post-treatment observations
remain in the panel but do not contribute to the main ATT regression because their
post-treatment average is undefined.</p>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>Compute the pre-treatment mean for each unit i:</p>
<div class="math notranslate nohighlight">
\[\bar{Y}_{i,pre} = \frac{1}{S-1} \sum_{t=1}^{S-1} Y_{it}\]</div>
</li>
<li><p>Compute the post-treatment mean for each unit i:</p>
<div class="math notranslate nohighlight">
\[\bar{Y}_{i,post} = \frac{1}{T-S+1} \sum_{t=S}^{T} Y_{it}\]</div>
</li>
<li><p>Construct the transformed outcome:</p>
<div class="math notranslate nohighlight">
\[\Delta\bar{Y}_i = \bar{Y}_{i,post} - \bar{Y}_{i,pre}\]</div>
</li>
<li><p>Estimate the cross-sectional regression:</p>
<div class="math notranslate nohighlight">
\[\Delta\bar{Y}_i = \alpha + \tau D_i + U_i, \quad i = 1, \ldots, N\]</div>
<p>where <span class="math notranslate nohighlight">\(D_i = 1\)</span> for treated units and <span class="math notranslate nohighlight">\(D_i = 0\)</span> for control units.</p>
</li>
</ol>
<p><strong>Estimand</strong>: <span class="math notranslate nohighlight">\(\tau\)</span> is the average treatment effect on the treated (ATT).</p>
<p><strong>Equivalence</strong>: This transformation yields the same point estimate as the two-way
fixed effects (TWFE) DiD estimator. The cross-sectional representation enables
exact t-based inference under classical linear model assumptions.</p>
</section>
<section id="detrend-transformation-procedure-3-1">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Detrend Transformation (Procedure 3.1)</a><a class="headerlink" href="#detrend-transformation-procedure-3-1" title="Link to this heading">ïƒ</a></h3>
<p><strong>Motivation</strong>: When units exhibit heterogeneous linear trends in pre-treatment
periods, the standard parallel trends assumption (constant trends across units)
may be too restrictive. Detrending allows for unit-specific linear trends by
removing them before estimating treatment effects.</p>
<p><strong>Procedure</strong></p>
<ol class="arabic">
<li><p>For each unit i, estimate a linear trend using pre-treatment data:</p>
<div class="math notranslate nohighlight">
\[Y_{it} = A_i + B_i t + \varepsilon_{it} \quad \text{for } t = 1, \ldots, S-1\]</div>
<p>This requires at least two pre-treatment periods (<span class="math notranslate nohighlight">\(T_0 \geq 2\)</span>).</p>
</li>
<li><p>Compute predicted values for all periods using the estimated trend:</p>
<div class="math notranslate nohighlight">
\[\hat{Y}_{it} = \hat{A}_i + \hat{B}_i t \quad \text{for } t = 1, \ldots, T\]</div>
</li>
<li><p>For post-treatment periods, compute out-of-sample residuals:</p>
<div class="math notranslate nohighlight">
\[\ddot{Y}_{it} = Y_{it} - \hat{Y}_{it} \quad \text{for } t = S, \ldots, T\]</div>
</li>
<li><p>Average the residuals over post-treatment periods:</p>
<div class="math notranslate nohighlight">
\[\bar{\ddot{Y}}_i = \frac{1}{T-S+1} \sum_{t=S}^{T} \ddot{Y}_{it}\]</div>
</li>
<li><p>Estimate the cross-sectional regression:</p>
<div class="math notranslate nohighlight">
\[\bar{\ddot{Y}}_i = \alpha + \tau_{DT} D_i + U_i, \quad i = 1, \ldots, N\]</div>
</li>
</ol>
<p><strong>Estimand</strong>: <span class="math notranslate nohighlight">\(\tau_{DT}\)</span> is the ATT after removing unit-specific linear trends.</p>
<p><strong>Note</strong>: The trend is estimated using only pre-treatment data, so the treatment
variation remains available for estimation in the cross-sectional regression. As in
the demean case, the implementation allows unbalanced panels: units need not appear
in every period, but each unit included in the data must have at least two
pre-treatment observations so that its trend can be estimated. Units without any
post-treatment observations remain in the panel but do not contribute to the main
ATT regression because their post-treatment average is undefined.</p>
</section>
<section id="seasonal-transformations-demeanq-detrendq">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Seasonal Transformations (demeanq/detrendq)</a><a class="headerlink" href="#seasonal-transformations-demeanq-detrendq" title="Link to this heading">ïƒ</a></h3>
<p><strong>demeanq</strong>: Extends Procedure 2.1 to include seasonal fixed effects,
removing seasonal patterns in periodic data.</p>
<p><strong>detrendq</strong>: Extends Procedure 3.1 to include both linear trends and
seasonal fixed effects.</p>
<p>Both methods include seasonal dummies in the pre-treatment regression to remove
seasonal variation before computing post-treatment residuals.</p>
<p><strong>Generalized Q Parameter</strong></p>
<p>The seasonal transformations support arbitrary seasonal periods through the <code class="docutils literal notranslate"><span class="pre">Q</span></code>
parameter:</p>
<ul class="simple">
<li><p><strong>Q=4</strong> (default): Quarterly data with 4 seasons per year</p></li>
<li><p><strong>Q=12</strong>: Monthly data with 12 seasons per year</p></li>
<li><p><strong>Q=52</strong>: Weekly data with 52 seasons per year</p></li>
</ul>
<p>The mathematical formulation generalizes to Q seasons. For demeanq, the
pre-treatment regression for each unit i is:</p>
<div class="math notranslate nohighlight">
\[Y_{it} = \alpha_i + \sum_{q=2}^{Q} \gamma_q S_{itq} + \varepsilon_{it}\]</div>
<p>where <span class="math notranslate nohighlight">\(S_{itq}\)</span> is a dummy variable equal to 1 if observation t falls in
season q (with season 1 as the reference category).</p>
<p>For detrendq, the pre-treatment regression includes both trend and seasonal terms:</p>
<div class="math notranslate nohighlight">
\[Y_{it} = \alpha_i + \beta_i t + \sum_{q=2}^{Q} \gamma_q S_{itq} + \varepsilon_{it}\]</div>
<p><strong>Minimum Pre-Treatment Requirements</strong></p>
<p>The minimum number of pre-treatment observations per unit depends on Q:</p>
<ul class="simple">
<li><p><strong>demeanq</strong>: <span class="math notranslate nohighlight">\(n_{pre} \geq Q + 1\)</span> (to estimate intercept + Q-1 seasonal dummies)</p></li>
<li><p><strong>detrendq</strong>: <span class="math notranslate nohighlight">\(n_{pre} \geq Q + 2\)</span> (to estimate intercept + trend + Q-1 seasonal dummies)</p></li>
</ul>
<p>For monthly data (Q=12), this means at least 13 pre-treatment observations for
demeanq and 14 for detrendq. For weekly data (Q=52), at least 53 and 54
observations respectively.</p>
<p><strong>Season Coverage Requirement</strong></p>
<p>For each unit, every season that appears in the post-treatment period must also
appear in the pre-treatment period. This ensures that seasonal effects can be
properly removed from post-treatment observations.</p>
<p><strong>Numerical Stability</strong></p>
<p>For high-dimensional seasonal adjustments (especially Q=52), the implementation
includes numerical stability checks:</p>
<ul class="simple">
<li><p>Condition number monitoring for the design matrix</p></li>
<li><p>Warnings when the design matrix approaches singularity</p></li>
<li><p>Robust OLS estimation using QR decomposition</p></li>
</ul>
</section>
</section>
<section id="inference-under-clm-assumptions">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Inference Under CLM Assumptions</a><a class="headerlink" href="#inference-under-clm-assumptions" title="Link to this heading">ïƒ</a></h2>
<section id="classical-linear-model-assumptions">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Classical Linear Model Assumptions</a><a class="headerlink" href="#classical-linear-model-assumptions" title="Link to this heading">ïƒ</a></h3>
<p>When homoskedastic OLS standard errors are used (<code class="docutils literal notranslate"><span class="pre">vce=None</span></code> in <code class="docutils literal notranslate"><span class="pre">lwdid</span></code>),
exact finite-sample inference is available under the classical linear model (CLM)
assumptions for the cross-sectional regression. For the demean transformation,
the model is <span class="math notranslate nohighlight">\(\Delta\bar{Y}_i = \alpha + \tau D_i + U_i\)</span> (for detrending,
replace <span class="math notranslate nohighlight">\(\Delta\bar{Y}_i\)</span> with <span class="math notranslate nohighlight">\(\bar{\ddot{Y}}_i\)</span>). The CLM
assumptions are:</p>
<ol class="arabic simple">
<li><p><strong>Linearity</strong>: <span class="math notranslate nohighlight">\(E[U_i | D_i] = 0\)</span> (zero conditional mean)</p></li>
<li><p><strong>Random sampling</strong>: Units are independently sampled</p></li>
<li><p><strong>No perfect collinearity</strong>: Treatment indicator varies across units</p></li>
<li><p><strong>Homoskedasticity</strong>: <span class="math notranslate nohighlight">\(\text{Var}(U_i | D_i) = \sigma^2\)</span> (constant variance)</p></li>
<li><p><strong>Normality</strong>: <span class="math notranslate nohighlight">\(U_i | D_i \sim N(0, \sigma^2)\)</span> (conditional normality)</p></li>
</ol>
<p>Under these assumptions and with homoskedastic OLS standard errors, the
t-statistic <span class="math notranslate nohighlight">\((\hat{\tau} - \tau)/\text{se}(\hat{\tau})\)</span> follows an exact
t-distribution with residual degrees of freedom equal to <span class="math notranslate nohighlight">\(N - k\)</span>, where
<span class="math notranslate nohighlight">\(k\)</span> is the number of estimated parameters in the cross-sectional
regression (<span class="math notranslate nohighlight">\(k = 2\)</span> without controls: intercept and treatment indicator).
The normality and homoskedasticity assumptions are critical for exact inference.</p>
</section>
<section id="degrees-of-freedom">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Degrees of Freedom</a><a class="headerlink" href="#degrees-of-freedom" title="Link to this heading">ïƒ</a></h3>
<p><strong>Homoskedastic standard errors</strong>:</p>
<div class="math notranslate nohighlight">
\[df = N - k\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of cross-sectional units and <span class="math notranslate nohighlight">\(k\)</span> is the
number of parameters (<span class="math notranslate nohighlight">\(k = 2\)</span> without controls: intercept and treatment
indicator).</p>
<p><strong>Cluster-robust standard errors</strong>:</p>
<div class="math notranslate nohighlight">
\[df = G - 1\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the number of clusters.</p>
<p>The cross-sectional regression has <span class="math notranslate nohighlight">\(N\)</span> observations (one per unit), not
<span class="math notranslate nohighlight">\(N \times T\)</span>. With cluster-robust standard errors, degrees of freedom
equal the number of clusters minus one.</p>
</section>
<section id="period-specific-effects">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Period-Specific Effects</a><a class="headerlink" href="#period-specific-effects" title="Link to this heading">ïƒ</a></h3>
<p>In addition to an overall post-treatment average effect, the Lee and Wooldridge
framework allows estimation of period-specific treatment effects by running
separate cross-sectional regressions for each post-treatment period, using the
transformed outcome in that period as the dependent variable (see equation (2.20)
in Lee and Wooldridge (2026)). In <code class="docutils literal notranslate"><span class="pre">lwdid</span></code>, these regressions use the same
variance estimator (<code class="docutils literal notranslate"><span class="pre">vce</span></code>) and control-variable specification as the main ATT
regression.</p>
</section>
</section>
<section id="robust-inference">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Robust Inference</a><a class="headerlink" href="#robust-inference" title="Link to this heading">ïƒ</a></h2>
<section id="heteroskedasticity-robust-standard-errors">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Heteroskedasticity-Robust Standard Errors</a><a class="headerlink" href="#heteroskedasticity-robust-standard-errors" title="Link to this heading">ïƒ</a></h3>
<p>When homoskedasticity is violated, heteroskedasticity-robust standard errors
provide asymptotically valid inference. The <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> package supports the
following HC estimators:</p>
<ul class="simple">
<li><p><strong>HC0</strong>: Whiteâ€™s original heteroskedasticity-consistent estimator. Tends to
underestimate standard errors in small samples.</p></li>
<li><p><strong>HC1</strong>: Degrees-of-freedom adjusted version of HC0 (applies <span class="math notranslate nohighlight">\(n/(n-k)\)</span>
correction). Equivalent to <code class="docutils literal notranslate"><span class="pre">vce='robust'</span></code>.</p></li>
<li><p><strong>HC2</strong>: Leverage-adjusted estimator that divides squared residuals by
<span class="math notranslate nohighlight">\((1 - h_{ii})\)</span> where <span class="math notranslate nohighlight">\(h_{ii}\)</span> is the diagonal of the hat matrix.</p></li>
<li><p><strong>HC3</strong>: Small-sample adjusted version that divides squared residuals by
<span class="math notranslate nohighlight">\((1 - h_{ii})^2\)</span>. Recommended for small to moderate samples.</p></li>
<li><p><strong>HC4</strong>: High-leverage adjusted estimator with adaptive exponent based on
leverage. Use when data contains influential observations.</p></li>
</ul>
<p>Robust standard errors rely on asymptotic approximations and may be less accurate
in very small samples. Recent simulation evidence (Simonsohn 2021) suggests HC3
can perform reasonably well even with small sample sizes (e.g.,
<span class="math notranslate nohighlight">\(N_0 = 18\)</span>, <span class="math notranslate nohighlight">\(N_1 = 2\)</span> in the cited study), though caution is
warranted with very small samples.
Exact inference is not available under heteroskedasticity.</p>
</section>
<section id="cluster-robust-standard-errors">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Cluster-Robust Standard Errors</a><a class="headerlink" href="#cluster-robust-standard-errors" title="Link to this heading">ïƒ</a></h3>
<p>When errors are correlated within clusters, cluster-robust standard errors account
for within-cluster correlation.</p>
<p>These standard errors rely on large-sample approximations in the number of
clusters. Inference is more reliable when the number of clusters is not too
small; <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> issues a warning when the cluster count is very low.
Degrees of freedom for cluster-robust inference are taken as G - 1. The cluster
variable must be nested within the unit identifier (each unit belongs to exactly
one cluster across all time periods), reflecting the usual assumption that
clusters are independent.</p>
</section>
<section id="randomization-inference">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Randomization Inference</a><a class="headerlink" href="#randomization-inference" title="Link to this heading">ïƒ</a></h3>
<p>Randomization inference constructs a reference distribution for the test statistic
under the sharp null hypothesis without relying on normality or homoskedasticity
assumptions.</p>
<p><strong>Procedure</strong>:</p>
<ol class="arabic simple">
<li><p>Compute the observed test statistic. In <code class="docutils literal notranslate"><span class="pre">lwdid</span></code>, this is the ATT estimate
<span class="math notranslate nohighlight">\(\hat{\tau}\)</span> from the cross-sectional regression.</p></li>
<li><p>Randomly reassign treatment status across units</p></li>
<li><p>Re-estimate the model with reassigned treatment</p></li>
<li><p>Repeat steps 2-3 <span class="math notranslate nohighlight">\(R\)</span> times (e.g., <span class="math notranslate nohighlight">\(R = 1000\)</span>)</p></li>
<li><p>Compute the p-value as the proportion of replications with the test statistic
at least as extreme (in absolute value) as the observed value</p></li>
</ol>
<p><strong>Methods</strong>:</p>
<ul class="simple">
<li><p><strong>Bootstrap</strong> (with replacement): Treatment group size may vary across replications</p></li>
<li><p><strong>Permutation</strong> (without replacement): Fisher randomization inference; treatment
group size is fixed across permutations</p></li>
</ul>
<p>In <code class="docutils literal notranslate"><span class="pre">lwdid</span></code>, randomization inference always re-estimates the cross-sectional
regression by OLS (ignoring the <code class="docutils literal notranslate"><span class="pre">vce</span></code> option used for the main estimate).
The default <code class="docutils literal notranslate"><span class="pre">ri_method</span></code> is <code class="docutils literal notranslate"><span class="pre">'bootstrap'</span></code> for backward compatibility, while
<code class="docutils literal notranslate"><span class="pre">'permutation'</span></code> corresponds to the classical Fisher randomization approach and
is generally recommended for design-based randomization inference.</p>
<p><strong>Advantages</strong>:</p>
<ul class="simple">
<li><p>Does not rely on normality or homoskedasticity assumptions</p></li>
<li><p>Naturally accommodates heteroskedasticity and non-normality under the maintained
randomization scheme</p></li>
</ul>
<p><strong>Limitations</strong>:</p>
<ul class="simple">
<li><p>Computationally intensive for large numbers of replications</p></li>
<li><p>Tests only the sharp null hypothesis (zero treatment effect for all units)</p></li>
</ul>
</section>
</section>
<section id="clustering-at-higher-levels">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Clustering at Higher Levels</a><a class="headerlink" href="#clustering-at-higher-levels" title="Link to this heading">ïƒ</a></h2>
<p>When the policy or treatment varies at a level higher than the unit of observation,
cluster standard errors at the policy variation level (Lee and Wooldridge, 2026,
Section 8.2). This section provides guidance on choosing the appropriate clustering
level and tools for diagnosing clustering structure.</p>
<section id="when-to-cluster-at-higher-levels">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">When to Cluster at Higher Levels</a><a class="headerlink" href="#when-to-cluster-at-higher-levels" title="Link to this heading">ïƒ</a></h3>
<p><strong>Principle</strong>: Cluster at the level where treatment is assigned or varies.</p>
<p><strong>Example</strong>: If studying a state-level policy using county-level data, cluster at
the state level because the policy varies across states, not counties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span>
    <span class="n">vce</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">cluster_var</span><span class="o">=</span><span class="s1">&#39;state&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Rationale</strong>: When treatment is assigned at a higher level (e.g., state), errors
are likely correlated within that level. Clustering at the unit level (county)
would understate standard errors because it ignores this correlation.</p>
</section>
<section id="minimum-cluster-requirements">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Minimum Cluster Requirements</a><a class="headerlink" href="#minimum-cluster-requirements" title="Link to this heading">ïƒ</a></h3>
<p>The reliability of cluster-robust inference depends on the number of clusters:</p>
<ul class="simple">
<li><p><strong>Recommended</strong>: â‰¥ 20-30 clusters for reliable asymptotic inference</p></li>
<li><p><strong>Warning threshold</strong>: &lt; 10 clusters may produce unreliable inference</p></li>
<li><p><strong>Alternative</strong>: Use wild cluster bootstrap when clusters are few</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">lwdid</span></code> automatically warns when the number of clusters is small:</p>
<ul class="simple">
<li><p><strong>&lt; 10 clusters</strong>: Warning with recommendation to use wild cluster bootstrap</p></li>
<li><p><strong>10-19 clusters</strong>: Informational message suggesting wild cluster bootstrap</p></li>
<li><p><strong>Cluster size imbalance</strong> (CV &gt; 1.0): Warning about potential reliability issues</p></li>
</ul>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Degrees of Freedom</a><a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h3>
<p>With cluster-robust standard errors, degrees of freedom are:</p>
<div class="math notranslate nohighlight">
\[df = G - 1\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the number of clusters. This is more conservative than the
usual <span class="math notranslate nohighlight">\(N - k\)</span> degrees of freedom, reflecting the effective sample size
being the number of clusters rather than the number of observations.</p>
</section>
<section id="diagnosing-clustering-structure">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Diagnosing Clustering Structure</a><a class="headerlink" href="#diagnosing-clustering-structure" title="Link to this heading">ïƒ</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">diagnose_clustering()</span></code> to analyze potential clustering options and get
recommendations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnose_clustering</span>

<span class="n">diag</span> <span class="o">=</span> <span class="n">diagnose_clustering</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span>
    <span class="n">potential_cluster_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;county&#39;</span><span class="p">],</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diag</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
<p>The diagnostics include:</p>
<ul class="simple">
<li><p><strong>Cluster counts</strong>: Total, treated, and control clusters for each variable</p></li>
<li><p><strong>Cluster sizes</strong>: Min, max, mean, median, and coefficient of variation</p></li>
<li><p><strong>Level detection</strong>: Whether each variable is at a higher/same/lower level than unit</p></li>
<li><p><strong>Treatment variation</strong>: Whether treatment varies within clusters</p></li>
<li><p><strong>Recommendation</strong>: Suggested clustering variable with explanation</p></li>
</ul>
</section>
<section id="getting-a-clustering-recommendation">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Getting a Clustering Recommendation</a><a class="headerlink" href="#getting-a-clustering-recommendation" title="Link to this heading">ïƒ</a></h3>
<p>For a detailed recommendation with confidence scores and alternatives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">recommend_clustering_level</span>

<span class="n">rec</span> <span class="o">=</span> <span class="n">recommend_clustering_level</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">potential_cluster_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;county&#39;</span><span class="p">],</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span>
    <span class="n">min_clusters</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">use_wild_bootstrap</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider using wild_cluster_bootstrap() for inference&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The recommendation considers:</p>
<ul class="simple">
<li><p>Treatment variation level (cluster at this level when possible)</p></li>
<li><p>Number of clusters (more is better, â‰¥20 recommended)</p></li>
<li><p>Balance between treated and control clusters</p></li>
<li><p>Cluster size variation (lower CV is better)</p></li>
</ul>
</section>
<section id="checking-clustering-consistency">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Checking Clustering Consistency</a><a class="headerlink" href="#checking-clustering-consistency" title="Link to this heading">ïƒ</a></h3>
<p>Verify that your chosen clustering level is consistent with the treatment
assignment mechanism:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_clustering_consistency</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">check_clustering_consistency</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="n">cluster_var</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">is_consistent</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">recommendation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A clustering choice is consistent when:</p>
<ul class="simple">
<li><p>Treatment does not vary within clusters (or varies minimally, &lt; 5%)</p></li>
<li><p>Cluster level is at or above the treatment variation level</p></li>
</ul>
<p>If treatment varies within clusters, standard errors may be conservative
(too large), leading to under-rejection of the null hypothesis.</p>
</section>
<section id="wild-cluster-bootstrap">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Wild Cluster Bootstrap</a><a class="headerlink" href="#wild-cluster-bootstrap" title="Link to this heading">ïƒ</a></h3>
<p>When the number of clusters is small (&lt; 20), the wild cluster bootstrap provides
more reliable inference than asymptotic cluster-robust standard errors. This
method, developed by Cameron, Gelbach, and Miller (2008), constructs a bootstrap
distribution by:</p>
<ol class="arabic simple">
<li><p>Estimating the original model and obtaining residuals</p></li>
<li><p>Generating cluster-level random weights</p></li>
<li><p>Creating bootstrap residuals by multiplying original residuals by weights</p></li>
<li><p>Re-estimating the model with bootstrap outcomes</p></li>
<li><p>Computing the bootstrap distribution of t-statistics</p></li>
</ol>
<p><strong>Basic usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid.inference</span><span class="w"> </span><span class="kn">import</span> <span class="n">wild_cluster_bootstrap</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">wild_cluster_bootstrap</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y_transformed</span><span class="o">=</span><span class="s1">&#39;ydot&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d_&#39;</span><span class="p">,</span>
    <span class="n">cluster_var</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">999</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ATT: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">att</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bootstrap SE: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">se_bootstrap</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bootstrap p-value: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% CI: [</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">ci_lower</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">ci_upper</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Weight types</strong>:</p>
<ul class="simple">
<li><p><strong>rademacher</strong> (default): P(w=1) = P(w=-1) = 0.5. Simplest and most common.</p></li>
<li><p><strong>mammen</strong>: Two-point distribution matching first three moments. Better for
asymmetric error distributions.</p></li>
<li><p><strong>webb</strong>: Six-point distribution (Webb 2014). Recommended for very few clusters
(G &lt; 10).</p></li>
</ul>
<p><strong>Example with Webb weights for few clusters</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">wild_cluster_bootstrap</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y_transformed</span><span class="o">=</span><span class="s1">&#39;ydot&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d_&#39;</span><span class="p">,</span>
    <span class="n">cluster_var</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span>
    <span class="n">weight_type</span><span class="o">=</span><span class="s1">&#39;webb&#39;</span><span class="p">,</span>  <span class="c1"># Better for very few clusters</span>
    <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>  <span class="c1"># For reproducibility</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Null hypothesis imposition</strong>:</p>
<p>By default (<code class="docutils literal notranslate"><span class="pre">impose_null=True</span></code>), the bootstrap constructs samples under the
null hypothesis that the treatment effect is zero. This provides better size
control for hypothesis testing. Set <code class="docutils literal notranslate"><span class="pre">impose_null=False</span></code> for confidence interval
construction when the null may not hold.</p>
</section>
<section id="clustering-workflow">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Clustering Workflow</a><a class="headerlink" href="#clustering-workflow" title="Link to this heading">ïƒ</a></h3>
<p>A recommended workflow for choosing and validating clustering:</p>
<ol class="arabic simple">
<li><p><strong>Diagnose</strong>: Use <code class="docutils literal notranslate"><span class="pre">diagnose_clustering()</span></code> to understand the data structure</p></li>
<li><p><strong>Recommend</strong>: Use <code class="docutils literal notranslate"><span class="pre">recommend_clustering_level()</span></code> to get a recommendation</p></li>
<li><p><strong>Check</strong>: Use <code class="docutils literal notranslate"><span class="pre">check_clustering_consistency()</span></code> to validate the choice</p></li>
<li><p><strong>Estimate</strong>: Run <code class="docutils literal notranslate"><span class="pre">lwdid()</span></code> with the chosen <code class="docutils literal notranslate"><span class="pre">cluster_var</span></code></p></li>
<li><p><strong>Bootstrap</strong>: If clusters &lt; 20, use <code class="docutils literal notranslate"><span class="pre">wild_cluster_bootstrap()</span></code> for inference</p></li>
</ol>
<p><strong>Complete example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">lwdid</span><span class="p">,</span> <span class="n">diagnose_clustering</span><span class="p">,</span> <span class="n">recommend_clustering_level</span><span class="p">,</span>
    <span class="n">check_clustering_consistency</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lwdid.inference</span><span class="w"> </span><span class="kn">import</span> <span class="n">wild_cluster_bootstrap</span>

<span class="c1"># Step 1-2: Diagnose and get recommendation</span>
<span class="n">rec</span> <span class="o">=</span> <span class="n">recommend_clustering_level</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">potential_cluster_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">],</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>

<span class="c1"># Step 3: Check consistency</span>
<span class="n">consistency</span> <span class="o">=</span> <span class="n">check_clustering_consistency</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="n">cluster_var</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">recommended_var</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>

<span class="c1"># Step 4: Estimate with cluster-robust SE</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span>
    <span class="n">vce</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">cluster_var</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">recommended_var</span>
<span class="p">)</span>

<span class="c1"># Step 5: Wild bootstrap if few clusters</span>
<span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">use_wild_bootstrap</span><span class="p">:</span>
    <span class="n">boot_result</span> <span class="o">=</span> <span class="n">wild_cluster_bootstrap</span><span class="p">(</span>
        <span class="n">result</span><span class="o">.</span><span class="n">data_transformed</span><span class="p">,</span> <span class="n">y_transformed</span><span class="o">=</span><span class="s1">&#39;ydot&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d_&#39;</span><span class="p">,</span>
        <span class="n">cluster_var</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">recommended_var</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">999</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bootstrap p-value: </span><span class="si">{</span><span class="n">boot_result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="references-for-clustering">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">References for Clustering</a><a class="headerlink" href="#references-for-clustering" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Cameron, A.C. &amp; Miller, D.L. (2015). â€œA Practitionerâ€™s Guide to Cluster-Robust
Inference.â€ <em>Journal of Human Resources</em>, 50(2), 317-372.</p></li>
<li><p>Cameron, A.C., Gelbach, J.B., &amp; Miller, D.L. (2008). â€œBootstrap-based
improvements for inference with clustered errors.â€ <em>Review of Economics and
Statistics</em>, 90(3), 414-427.</p></li>
<li><p>Webb, M.D. (2014). â€œReworking wild bootstrap based inference for clustered
errors.â€ <em>Queenâ€™s Economics Department Working Paper No. 1315</em>.</p></li>
</ul>
</section>
</section>
<section id="large-sample-asymptotic-inference">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">Large-Sample Asymptotic Inference</a><a class="headerlink" href="#large-sample-asymptotic-inference" title="Link to this heading">ïƒ</a></h2>
<p>When the cross-sectional sample size N is moderately large, asymptotic inference
based on robust standard errors becomes appropriate. Lee and Wooldridge (2025)
develops the theoretical foundation for large-sample inference in the rolling
transformation framework.</p>
<section id="asymptotic-theory">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Asymptotic Theory</a><a class="headerlink" href="#asymptotic-theory" title="Link to this heading">ïƒ</a></h3>
<p>Under standard regularity conditions (independent sampling across units, finite
moments, and either correct specification of the outcome model or propensity
score model for doubly robust estimators), the ATT estimator is asymptotically
normal:</p>
<div class="math notranslate nohighlight">
\[\sqrt{N} (\hat{\tau} - \tau) \xrightarrow{d} N(0, V)\]</div>
<p>where <span class="math notranslate nohighlight">\(V\)</span> is the asymptotic variance. This justifies the use of
heteroskedasticity-robust standard errors (HC0-HC4) or cluster-robust standard
errors for constructing confidence intervals and hypothesis tests.</p>
<p>The key insight from Lee and Wooldridge (2025) is that the rolling transformation
converts the panel DiD problem into a cross-sectional treatment effects problem,
enabling application of standard large-sample theory from the treatment effects
literature.</p>
</section>
<section id="doubly-robust-estimation">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Doubly Robust Estimation</a><a class="headerlink" href="#doubly-robust-estimation" title="Link to this heading">ïƒ</a></h3>
<p>Lee and Wooldridge (2025) shows that the rolling transformation approach enables
application of doubly robust estimators, which provide consistent estimates when
either the outcome model or the propensity score model is correctly specified.</p>
<p><strong>IPWRA (Inverse Probability Weighted Regression Adjustment)</strong>:</p>
<p>The doubly robust IPWRA estimator combines regression adjustment and inverse
probability weighting. For cohort <span class="math notranslate nohighlight">\(g\)</span> in period <span class="math notranslate nohighlight">\(r\)</span>, the estimator
takes the form:</p>
<div class="math notranslate nohighlight">
\[\hat{\tau}_{IPWRA} = N_1^{-1} \sum_i D_i [\hat{Y}_{ir} - \hat{m}_0(X_i)]
- N_1^{-1} \sum_i (1-D_i) \frac{\hat{p}(X_i)}{1-\hat{p}(X_i)} [\hat{Y}_{ir} - \hat{m}_0(X_i)]\]</div>
<p>where <span class="math notranslate nohighlight">\(N_1\)</span> is the number of treated units, <span class="math notranslate nohighlight">\(\hat{m}_0(\cdot)\)</span> is the
estimated conditional mean for control units, and <span class="math notranslate nohighlight">\(\hat{p}(\cdot)\)</span> is the
estimated propensity score.</p>
<p><strong>Double robustness property</strong>: The IPWRA estimator is consistent if:</p>
<ol class="arabic simple">
<li><p>The outcome model <span class="math notranslate nohighlight">\(E[Y|D=0, X]\)</span> is correctly specified, OR</p></li>
<li><p>The propensity score <span class="math notranslate nohighlight">\(P(D=1|X)\)</span> is correctly specified</p></li>
</ol>
<p>This property makes IPWRA particularly attractive when functional form
assumptions are uncertain.</p>
<p><strong>IPW (Inverse Probability Weighting)</strong>:</p>
<p>The IPW estimator weights observations by the inverse of their propensity scores:</p>
<div class="math notranslate nohighlight">
\[\hat{\tau}_{IPW} = N_1^{-1} \sum_i D_i \hat{Y}_{ir}
- \frac{\sum_i (1-D_i)\hat{w}_i\hat{Y}_{ir}}{\sum_i (1-D_i)\hat{w}_i}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{w}_i = \hat{p}(X_i)/(1-\hat{p}(X_i))\)</span>. IPW is consistent when
the propensity score is correctly specified.</p>
<p><strong>PSM (Propensity Score Matching)</strong>:</p>
<p>Propensity score matching estimates treatment effects by matching treated units
to control units with similar propensity scores. Nearest-neighbor matching finds
the closest control unit(s) for each treated unit based on the estimated
propensity score.</p>
</section>
<section id="efficiency-considerations">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Efficiency Considerations</a><a class="headerlink" href="#efficiency-considerations" title="Link to this heading">ïƒ</a></h3>
<p>Under correct specification of all models, Lee and Wooldridge (2025) shows that:</p>
<ol class="arabic simple">
<li><p><strong>Regression adjustment (RA)</strong> is both best linear unbiased (BLUE) and
asymptotically efficient under standard assumptions</p></li>
<li><p><strong>IPWRA</strong> achieves efficiency close to RA while providing robustness to
model misspecification</p></li>
<li><p><strong>Long differencing methods</strong> (e.g., Callaway and Santâ€™Anna 2021) can be
considerably less efficient because they use only the period just prior to
intervention</p></li>
</ol>
<section id="monte-carlo-simulation-evidence">
<h4>Monte Carlo Simulation Evidence<a class="headerlink" href="#monte-carlo-simulation-evidence" title="Link to this heading">ïƒ</a></h4>
<p>The Monte Carlo simulations in Lee and Wooldridge (2025, Section 7) provide
quantitative evidence for these theoretical results. Key findings include:</p>
<p><strong>Efficiency comparison under correct specification</strong> (Tables 7.2-7.10):</p>
<ul class="simple">
<li><p><strong>RA/POLS</strong>: Relative SD = 1.00 (baseline), RMSE ratio to RA = 1.00. Best
linear unbiased estimator.</p></li>
<li><p><strong>IPWRA</strong>: Relative SD = 1.03-1.05, RMSE ratio to RA â‰ˆ 1.03. Doubly robust
property.</p></li>
<li><p><strong>IPW</strong>: Relative SD = 1.08-1.15, RMSE ratio to RA â‰ˆ 1.10. Propensity
score-based weighting.</p></li>
<li><p><strong>PSM</strong>: Relative SD = 1.25-1.40, RMSE ratio to RA â‰ˆ 1.30. Matching-based
estimator.</p></li>
<li><p><strong>CS(2021)</strong>: Relative SD = 1.25-1.40, RMSE ratio to RA â‰ˆ 1.30. Long
differencing approach.</p></li>
</ul>
<p><strong>Rolling vs. long differencing efficiency</strong>:</p>
<p>The rolling transformation uses all pre-treatment periods to estimate
unit-specific means or trends, whereas long differencing methods (e.g.,
Callaway and Santâ€™Anna, 2021) use only the period immediately prior to
treatment. This difference has substantial efficiency implications:</p>
<ul class="simple">
<li><p>Rolling transformation: Uses <span class="math notranslate nohighlight">\(T_0\)</span> pre-treatment periods per unit</p></li>
<li><p>Long differencing: Uses only 1 pre-treatment period per unit</p></li>
<li><p>Efficiency gain: Rolling achieves standard deviation approximately
<span class="math notranslate nohighlight">\(\sqrt{T_0}\)</span> times smaller than long differencing when
<span class="math notranslate nohighlight">\(T_0 &gt; 1\)</span>, under homoskedastic errors</p></li>
</ul>
<p>In the simulation designs with <span class="math notranslate nohighlight">\(T_0 = 4\)</span>, the rolling approach achieves
approximately 25-40% smaller standard deviations than long differencing
methods (CS 2021), translating to substantially more precise estimates.</p>
<p><strong>Robustness to misspecification</strong> (Tables 7.4-7.5, 7.9-7.10):</p>
<p>When outcome models are misspecified but propensity scores are correct:</p>
<ul class="simple">
<li><p>IPWRA maintains small bias due to double robustness property</p></li>
<li><p>RA may exhibit larger bias under outcome model misspecification</p></li>
<li><p>IPWRA RMSE becomes comparable to or smaller than RA RMSE</p></li>
</ul>
<p>These findings support using IPWRA as the primary estimator when functional
form assumptions are uncertain.</p>
</section>
</section>
<section id="when-to-use-large-sample-methods">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">When to Use Large-Sample Methods</a><a class="headerlink" href="#when-to-use-large-sample-methods" title="Link to this heading">ïƒ</a></h3>
<p>Large-sample asymptotic inference is appropriate when:</p>
<ul class="simple">
<li><p>The cross-sectional sample size <span class="math notranslate nohighlight">\(N\)</span> is moderately large (e.g.,
<span class="math notranslate nohighlight">\(N \geq 50\)</span>)</p></li>
<li><p>Homoskedasticity and normality assumptions may not hold</p></li>
<li><p>Doubly robust estimation is desired for robustness to model misspecification</p></li>
</ul>
<p>For small samples where CLM assumptions (normality and homoskedasticity) are
plausible, exact t-based inference with <code class="docutils literal notranslate"><span class="pre">vce=None</span></code> remains appropriate.</p>
</section>
<section id="inference-distribution-by-estimator">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Inference Distribution by Estimator</a><a class="headerlink" href="#inference-distribution-by-estimator" title="Link to this heading">ïƒ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> package uses different reference distributions for statistical
inference depending on the estimator and sample size considerations:</p>
<p><strong>Regression Adjustment (RA)</strong>:</p>
<ul class="simple">
<li><p>Uses the t-distribution with degrees of freedom <span class="math notranslate nohighlight">\(df = N - k\)</span>, where
<span class="math notranslate nohighlight">\(N\)</span> is the cross-sectional sample size and <span class="math notranslate nohighlight">\(k\)</span> is the number of
regression parameters</p></li>
<li><p>Under CLM assumptions (homoskedasticity and normality), this provides exact
finite-sample inference</p></li>
<li><p>With robust standard errors (HC0-HC4), inference is asymptotically valid</p></li>
</ul>
<p><strong>Inverse Probability Weighting (IPW)</strong>:</p>
<ul class="simple">
<li><p>Uses the normal distribution for asymptotic inference</p></li>
<li><p>This follows the standard inverse probability weighting framework</p></li>
<li><p>Valid for moderate to large samples where asymptotic approximations hold</p></li>
</ul>
<p><strong>Inverse Probability Weighted Regression Adjustment (IPWRA)</strong>:</p>
<ul class="simple">
<li><p>Uses the normal distribution for asymptotic inference</p></li>
<li><p>This is consistent with Lee and Wooldridge (2025), which develops the
asymptotic theory for doubly robust estimators in the rolling transformation
framework</p></li>
<li><p>For small samples, consider using RA with <code class="docutils literal notranslate"><span class="pre">vce=None</span></code> for exact t-based
inference instead</p></li>
</ul>
<p><strong>Propensity Score Matching (PSM)</strong>:</p>
<ul class="simple">
<li><p>Uses the normal distribution for asymptotic inference</p></li>
<li><p>Standard errors are computed analytically following Abadie and Imbens (2006)</p></li>
<li><p>PSM inference is generally valid for moderate to large samples</p></li>
</ul>
<p><strong>Practical Guidance</strong>:</p>
<ul class="simple">
<li><p><strong>Small samples</strong> (<span class="math notranslate nohighlight">\(N &lt; 50\)</span>): Use RA (<code class="docutils literal notranslate"><span class="pre">estimator='ra'</span></code>) with
<code class="docutils literal notranslate"><span class="pre">vce=None</span></code> for exact t-based inference under CLM assumptions, or use
randomization inference (<code class="docutils literal notranslate"><span class="pre">ri=True</span></code>) for assumption-free testing</p></li>
<li><p><strong>Moderate samples</strong> (<span class="math notranslate nohighlight">\(50 \leq N &lt; 200\)</span>): Use RA or IPWRA with HC3
standard errors (<code class="docutils literal notranslate"><span class="pre">vce='hc3'</span></code>)</p></li>
<li><p><strong>Large samples</strong> (<span class="math notranslate nohighlight">\(N \geq 200\)</span>): All estimators with asymptotic
inference are appropriate; IPWRA provides robustness to model misspecification</p></li>
</ul>
</section>
</section>
<section id="identification-assumptions">
<h2><a class="toc-backref" href="#id34" role="doc-backlink">Identification Assumptions</a><a class="headerlink" href="#identification-assumptions" title="Link to this heading">ïƒ</a></h2>
<section id="no-anticipation">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">No Anticipation</a><a class="headerlink" href="#no-anticipation" title="Link to this heading">ïƒ</a></h3>
<p>Units do not change behavior in anticipation of future treatment. Pre-treatment
outcomes are unaffected by future treatment status.</p>
<p>Example violation: Firms may alter behavior before a regulation takes effect.</p>
</section>
<section id="parallel-trends">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Parallel Trends</a><a class="headerlink" href="#parallel-trends" title="Link to this heading">ïƒ</a></h3>
<p><strong>Demean (Procedure 2.1)</strong>: In the absence of treatment, the average change in
outcomes from pre- to post-treatment periods would be the same for treated and
control units. Formally, <span class="math notranslate nohighlight">\(E[Y_{it}(0) - Y_{i1}(0) | D_i]\)</span> is constant
across treatment groups for all <span class="math notranslate nohighlight">\(t\)</span>. This is the standard parallel trends
assumption.</p>
<p><strong>Detrend (Procedure 3.1)</strong>: In the absence of treatment, the average change in
outcomes after removing unit-specific linear trends would be the same for treated
and control units. This allows for heterogeneous linear trends across units,
relaxing the standard parallel trends assumption.</p>
<p>The parallel trends assumption is not directly testable because the counterfactual
outcome (what would have happened to treated units without treatment) is unobserved.
Researchers can examine pre-treatment trends visually, conduct placebo tests on
pre-treatment periods, or use detrending when units exhibit different linear trends
in the pre-treatment period.</p>
</section>
<section id="common-treatment-timing-common-timing-mode">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">Common Treatment Timing (Common Timing Mode)</a><a class="headerlink" href="#common-treatment-timing-common-timing-mode" title="Link to this heading">ïƒ</a></h3>
<p>In common timing mode, all treated units begin treatment in the same period. This is
specified via the <code class="docutils literal notranslate"><span class="pre">post</span></code> parameter, which indicates post-treatment periods.</p>
<p>For staggered adoption settings where units are treated at different times, use the
<code class="docutils literal notranslate"><span class="pre">gvar</span></code> parameter instead of <code class="docutils literal notranslate"><span class="pre">post</span></code>. See the Staggered Adoption section below.</p>
</section>
<section id="treatment-persistence">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Treatment Persistence</a><a class="headerlink" href="#treatment-persistence" title="Link to this heading">ïƒ</a></h3>
<p>Once treated, units remain treated. At the implementation level, the post-treatment
indicator must be monotone non-decreasing in the time index (once <code class="docutils literal notranslate"><span class="pre">post</span></code> switches
from 0 to 1, it cannot revert to 0). Treatment reversals or temporary treatments
are therefore not permitted.</p>
</section>
</section>
<section id="unbalanced-panels-and-selection-mechanism">
<h2><a class="toc-backref" href="#id39" role="doc-backlink">Unbalanced Panels and Selection Mechanism</a><a class="headerlink" href="#unbalanced-panels-and-selection-mechanism" title="Link to this heading">ïƒ</a></h2>
<p>Lee and Wooldridge (2025, Section 4.4) addresses the treatment of unbalanced panels,
where not all units are observed in all time periods. This section describes the
selection mechanism assumption and guidance for working with incomplete panel data.</p>
<section id="selection-mechanism-assumption">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">Selection Mechanism Assumption</a><a class="headerlink" href="#selection-mechanism-assumption" title="Link to this heading">ïƒ</a></h3>
<p>The key assumption for unbalanced panels is that selection into the sample may depend
on unobserved time-invariant heterogeneity (which is removed by the transformation),
but cannot systematically depend on the shocks to <span class="math notranslate nohighlight">\(Y_{it}(\infty)\)</span>.</p>
<p>Formally, if <span class="math notranslate nohighlight">\(S_{it}\)</span> indicates whether unit <span class="math notranslate nohighlight">\(i\)</span> is observed at time <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[E[Y_{it}(\infty) | S_{it} = 1, D_i, X_i] = E[Y_{it}(\infty) | D_i, X_i]\]</div>
<p>This means that, conditional on treatment status and covariates, being observed does
not systematically predict the untreated potential outcome.</p>
<p><strong>Analogy to Fixed Effects</strong>: This assumption is analogous to the standard fixed effects
assumption where the error term may be correlated with time-invariant characteristics
but not with idiosyncratic shocks. The rolling transformation removes the time-invariant
component, so selection based on permanent characteristics does not cause bias.</p>
</section>
<section id="acceptable-missing-data-patterns">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">Acceptable Missing Data Patterns</a><a class="headerlink" href="#acceptable-missing-data-patterns" title="Link to this heading">ïƒ</a></h3>
<p>Missing data is acceptable when it depends on:</p>
<ol class="arabic simple">
<li><p><strong>Time-invariant characteristics</strong>: Units that are always high or low performers
may be more or less likely to remain in the sample</p></li>
<li><p><strong>Observable covariates</strong>: Missingness related to baseline characteristics that
are controlled for in the analysis</p></li>
<li><p><strong>Random factors</strong>: Missing completely at random (MCAR)</p></li>
<li><p><strong>Deterministic patterns</strong>: Units observed only in certain calendar time periods
due to sample design</p></li>
</ol>
<p><strong>Examples of acceptable patterns</strong>:</p>
<ul class="simple">
<li><p>A panel of firms where smaller firms are less likely to survive (selection on
time-invariant firm quality)</p></li>
<li><p>A survey where certain regions are only surveyed in specific years</p></li>
<li><p>Administrative data where units enter and exit based on observable eligibility</p></li>
</ul>
</section>
<section id="problematic-missing-data-patterns">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">Problematic Missing Data Patterns</a><a class="headerlink" href="#problematic-missing-data-patterns" title="Link to this heading">ïƒ</a></h3>
<p>Missing data is problematic when it depends on:</p>
<ol class="arabic simple">
<li><p><strong>Outcome shocks</strong>: Units experiencing negative shocks being more likely to
leave the sample</p></li>
<li><p><strong>Treatment anticipation</strong>: Units selecting out based on expected treatment
effects</p></li>
<li><p><strong>Unobserved time-varying factors</strong>: Missingness correlated with transitory
components of the outcome</p></li>
</ol>
<p><strong>Examples of problematic patterns</strong>:</p>
<ul class="simple">
<li><p>Firms exiting the sample after experiencing losses (selection on outcome shocks)</p></li>
<li><dl class="simple">
<dt>Workers leaving a survey after job loss, where job loss is correlated with</dt><dd><p>outcomes of interest</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Treatment group units dropping out more frequently than control units</dt><dd><p>in a pattern correlated with outcomes</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="detrending-for-robustness">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">Detrending for Robustness</a><a class="headerlink" href="#detrending-for-robustness" title="Link to this heading">ïƒ</a></h3>
<p>Lee and Wooldridge (2025, Section 5) notes that detrending provides additional
robustness to unbalanced panels:</p>
<blockquote>
<div><p>â€œRemoving unit-specific trends provides additional resiliency to unbalanced
panels, as we are now allowing for two sources of heterogeneityâ€”level and
trendâ€”to be correlated with selection into the sample.â€</p>
</div></blockquote>
<p>When selection may depend on both the level and growth rate of the outcome, detrending
removes both sources of heterogeneity, making the estimates more robust to selection
bias.</p>
<p><strong>Recommendation</strong>: When panel imbalance is substantial or selection mechanisms are
uncertain, consider using <code class="docutils literal notranslate"><span class="pre">rolling='detrend'</span></code> for additional robustness.</p>
</section>
<section id="diagnosing-selection-risk">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">Diagnosing Selection Risk</a><a class="headerlink" href="#diagnosing-selection-risk" title="Link to this heading">ïƒ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> package provides diagnostic tools for assessing selection risk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnose_selection_mechanism</span>

<span class="n">diagnostics</span> <span class="o">=</span> <span class="n">diagnose_selection_mechanism</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
<p>The diagnostics include:</p>
<ul class="simple">
<li><p><strong>Balance statistics</strong>: Panel balance ratio, observation counts</p></li>
<li><p><strong>Attrition analysis</strong>: Dropout rates by cohort and period</p></li>
<li><p><strong>Missing pattern classification</strong>: MCAR, MAR, or MNAR assessment</p></li>
<li><p><strong>Risk level</strong>: LOW, MEDIUM, or HIGH selection risk</p></li>
<li><p><strong>Recommendations</strong>: Suggested actions based on diagnostics</p></li>
</ul>
<p><strong>Interpreting risk levels</strong>:</p>
<ul class="simple">
<li><p><strong>LOW</strong>: Proceed with estimation; selection mechanism likely satisfied</p></li>
<li><p><strong>MEDIUM</strong>: Consider using detrending; perform sensitivity analysis</p></li>
<li><p><strong>HIGH</strong>: Results should be interpreted with caution; consider balanced subsample</p></li>
</ul>
</section>
<section id="controlling-panel-balance">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Controlling Panel Balance</a><a class="headerlink" href="#controlling-panel-balance" title="Link to this heading">ïƒ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">balanced_panel</span></code> parameter in <code class="docutils literal notranslate"><span class="pre">lwdid()</span></code> controls behavior when unbalanced
panels are detected:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">balanced_panel='warn'</span></code> (default): Issue warning and continue estimation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balanced_panel='error'</span></code>: Raise exception; require balanced panel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balanced_panel='ignore'</span></code>: Silently proceed with unbalanced panel</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Strict balanced panel requirement</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span>
    <span class="n">balanced_panel</span><span class="o">=</span><span class="s1">&#39;error&#39;</span>  <span class="c1"># Raises exception if unbalanced</span>
<span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="api/selection_diagnostics.html"><span class="doc">Selection Diagnostics Module (selection_diagnostics)</span></a> for detailed documentation of the diagnostic
functions.</p>
</section>
</section>
<section id="heterogeneous-trends-and-assumption-cht">
<h2><a class="toc-backref" href="#id46" role="doc-backlink">Heterogeneous Trends and Assumption CHT</a><a class="headerlink" href="#heterogeneous-trends-and-assumption-cht" title="Link to this heading">ïƒ</a></h2>
<p>Lee and Wooldridge (2025, Section 5) introduces Assumption CHT (Cohort-specific
Heterogeneous Trends), which relaxes the standard parallel trends assumption to
allow for cohort-specific linear trends.</p>
<section id="assumption-cht">
<h3><a class="toc-backref" href="#id47" role="doc-backlink">Assumption CHT</a><a class="headerlink" href="#assumption-cht" title="Link to this heading">ïƒ</a></h3>
<p>Under Assumption CHT, the potential outcome without treatment follows:</p>
<div class="math notranslate nohighlight">
\[E[Y_t(\infty)|D, X] = \eta_S(D_S \cdot t) + \cdots + \eta_T(D_T \cdot t) + q_\infty(X) + \sum_g D_g q_g(X) + m_t(X)\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\eta_g\)</span> is the cohort-specific linear trend for cohort <span class="math notranslate nohighlight">\(g\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(D_g = 1\)</span> indicates membership in cohort <span class="math notranslate nohighlight">\(g\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(q_\infty(X)\)</span> is the baseline level for never-treated units</p></li>
<li><p><span class="math notranslate nohighlight">\(q_g(X)\)</span> is the cohort-specific level shift</p></li>
<li><p><span class="math notranslate nohighlight">\(m_t(X)\)</span> is the common time effect</p></li>
</ul>
<p>The key implication is that different cohorts may have different pre-treatment
trends, violating the standard parallel trends assumption but still allowing
valid causal inference through detrending.</p>
</section>
<section id="first-difference-under-cht">
<h3><a class="toc-backref" href="#id48" role="doc-backlink">First Difference Under CHT</a><a class="headerlink" href="#first-difference-under-cht" title="Link to this heading">ïƒ</a></h3>
<p>Taking first differences under Assumption CHT:</p>
<div class="math notranslate nohighlight">
\[E[Y_t(\infty) - Y_{t-1}(\infty)|D, X] = \eta_g D_g + \cdots + [m_t(X) - m_{t-1}(X)]\]</div>
<p>The first difference depends on cohort membership through the <span class="math notranslate nohighlight">\(\eta_g\)</span> terms.
This means that if cohorts have different trends (<span class="math notranslate nohighlight">\(\eta_g \neq \eta_h\)</span>),
the standard parallel trends assumption fails, but detrending can remove these
cohort-specific trends.</p>
</section>
<section id="choosing-between-demean-and-detrend">
<h3><a class="toc-backref" href="#id49" role="doc-backlink">Choosing Between Demean and Detrend</a><a class="headerlink" href="#choosing-between-demean-and-detrend" title="Link to this heading">ïƒ</a></h3>
<p>The choice between <code class="docutils literal notranslate"><span class="pre">demean</span></code> and <code class="docutils literal notranslate"><span class="pre">detrend</span></code> depends on whether the parallel
trends assumption holds:</p>
<p><strong>Use demean when</strong>:</p>
<ul class="simple">
<li><p>Pre-treatment trends are parallel across treatment groups</p></li>
<li><p>The number of pre-treatment periods is limited (<span class="math notranslate nohighlight">\(T_0 &lt; 3\)</span>)</p></li>
<li><p>More efficient estimates are desired (demean is more efficient when PT holds)</p></li>
</ul>
<p><strong>Use detrend when</strong>:</p>
<ul class="simple">
<li><p>Pre-treatment trends differ across treatment groups</p></li>
<li><p>Sufficient pre-treatment periods are available (<span class="math notranslate nohighlight">\(T_0 \geq 2\)</span>, preferably <span class="math notranslate nohighlight">\(\geq 3\)</span>)</p></li>
<li><p>Visual inspection or formal tests suggest heterogeneous trends</p></li>
</ul>
<p><strong>Decision procedure</strong>:</p>
<ol class="arabic simple">
<li><p>Examine pre-treatment trends visually using <code class="docutils literal notranslate"><span class="pre">plot_cohort_trends()</span></code></p></li>
<li><p>Test parallel trends formally using <code class="docutils literal notranslate"><span class="pre">test_parallel_trends()</span></code></p></li>
<li><p>Diagnose trend heterogeneity using <code class="docutils literal notranslate"><span class="pre">diagnose_heterogeneous_trends()</span></code></p></li>
<li><p>Get a recommendation using <code class="docutils literal notranslate"><span class="pre">recommend_transformation()</span></code></p></li>
</ol>
</section>
<section id="procedure-5-1-detrending-under-cht">
<h3><a class="toc-backref" href="#id50" role="doc-backlink">Procedure 5.1: Detrending Under CHT</a><a class="headerlink" href="#procedure-5-1-detrending-under-cht" title="Link to this heading">ïƒ</a></h3>
<p>Lee and Wooldridge (2025, Procedure 5.1) describes the detrending procedure for
staggered adoption under Assumption CHT:</p>
<p><strong>Step 1</strong>: For each cohort <span class="math notranslate nohighlight">\(g \in \{S, \ldots, T\}\)</span>, run unit-specific
regressions using only pre-treatment periods:</p>
<div class="math notranslate nohighlight">
\[Y_{it} \text{ on } 1, t \quad \text{for } t = 1, \ldots, g-1\]</div>
<p>This estimates unit-specific intercept <span class="math notranslate nohighlight">\(\hat{A}_i\)</span> and slope <span class="math notranslate nohighlight">\(\hat{B}_i\)</span>.</p>
<p><strong>Step 2</strong>: For post-treatment periods <span class="math notranslate nohighlight">\(r \in \{g, \ldots, T\}\)</span>, compute
out-of-sample predictions:</p>
<div class="math notranslate nohighlight">
\[\hat{Y}_{irg} = \hat{A}_i + \hat{B}_i \cdot r\]</div>
<p><strong>Step 3</strong>: Compute detrended residuals:</p>
<div class="math notranslate nohighlight">
\[\ddot{Y}_{irg} = Y_{ir} - \hat{Y}_{irg}\]</div>
<p>The detrended outcome <span class="math notranslate nohighlight">\(\ddot{Y}_{irg}\)</span> removes the unit-specific linear
trend, allowing valid estimation of treatment effects even when cohorts have
different pre-treatment trends.</p>
</section>
<section id="testing-parallel-trends">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">Testing Parallel Trends</a><a class="headerlink" href="#testing-parallel-trends" title="Link to this heading">ïƒ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> package provides tools for testing the parallel trends assumption:</p>
<p><strong>Placebo test</strong>: Estimate treatment effects in pre-treatment periods. Under
parallel trends, these â€œplaceboâ€ effects should be zero:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid.trend_diagnostics</span><span class="w"> </span><span class="kn">import</span> <span class="n">test_parallel_trends</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">test_parallel_trends</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;placebo&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Interpretation</strong>:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">reject_null=False</span></code>: No evidence against parallel trends; <code class="docutils literal notranslate"><span class="pre">demean</span></code> is appropriate</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">reject_null=True</span></code>: Evidence of pre-treatment differences; consider <code class="docutils literal notranslate"><span class="pre">detrend</span></code></p></li>
</ul>
</section>
<section id="diagnosing-heterogeneous-trends">
<h3><a class="toc-backref" href="#id52" role="doc-backlink">Diagnosing Heterogeneous Trends</a><a class="headerlink" href="#diagnosing-heterogeneous-trends" title="Link to this heading">ïƒ</a></h3>
<p>To diagnose whether cohorts have different pre-treatment trends:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid.trend_diagnostics</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnose_heterogeneous_trends</span>

<span class="n">diag</span> <span class="o">=</span> <span class="n">diagnose_heterogeneous_trends</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diag</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
<p>The diagnostics include:</p>
<ul class="simple">
<li><p>Estimated trend slope for each cohort</p></li>
<li><p>F-test for trend heterogeneity across cohorts</p></li>
<li><p>Pairwise trend difference tests</p></li>
<li><p>Recommendation for transformation method</p></li>
</ul>
</section>
<section id="getting-a-transformation-recommendation">
<h3><a class="toc-backref" href="#id53" role="doc-backlink">Getting a Transformation Recommendation</a><a class="headerlink" href="#getting-a-transformation-recommendation" title="Link to this heading">ïƒ</a></h3>
<p>For an automated recommendation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid.trend_diagnostics</span><span class="w"> </span><span class="kn">import</span> <span class="n">recommend_transformation</span>

<span class="n">rec</span> <span class="o">=</span> <span class="n">recommend_transformation</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
<p>The recommendation considers:</p>
<ul class="simple">
<li><p>Parallel trends test results</p></li>
<li><p>Trend heterogeneity diagnostics</p></li>
<li><p>Number of pre-treatment periods</p></li>
<li><p>Panel balance</p></li>
<li><p>Seasonal patterns (for quarterly data)</p></li>
</ul>
</section>
</section>
<section id="pre-treatment-period-dynamics">
<h2><a class="toc-backref" href="#id54" role="doc-backlink">Pre-treatment Period Dynamics</a><a class="headerlink" href="#pre-treatment-period-dynamics" title="Link to this heading">ïƒ</a></h2>
<p>Lee and Wooldridge (2025) Appendix D develops a methodology for estimating treatment
effects in pre-treatment periods to assess the validity of the parallel trends
assumption. This section describes the theoretical foundation and implementation.</p>
<section id="motivation">
<h3><a class="toc-backref" href="#id55" role="doc-backlink">Motivation</a><a class="headerlink" href="#motivation" title="Link to this heading">ïƒ</a></h3>
<p>The parallel trends assumption is fundamental to difference-in-differences
identification but cannot be directly tested because it concerns counterfactual
outcomes. However, examining pre-treatment dynamics provides indirect evidence:</p>
<ul class="simple">
<li><p>Under parallel trends, the transformed outcome difference between treated and
control groups should be zero in all pre-treatment periods</p></li>
<li><p>Systematic non-zero pre-treatment effects suggest potential violations</p></li>
</ul>
</section>
<section id="rolling-transformation-for-pre-treatment-periods">
<h3><a class="toc-backref" href="#id56" role="doc-backlink">Rolling Transformation for Pre-treatment Periods</a><a class="headerlink" href="#rolling-transformation-for-pre-treatment-periods" title="Link to this heading">ïƒ</a></h3>
<p>For pre-treatment periods, the transformation uses future pre-treatment periods
rather than past periods. This ensures the transformation is well-defined for
all pre-treatment periods.</p>
<p><strong>Pre-treatment Demeaning (Formula D.1)</strong></p>
<p>For cohort <span class="math notranslate nohighlight">\(g\)</span> and pre-treatment period <span class="math notranslate nohighlight">\(t &lt; g\)</span>, the demeaned outcome is:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{itg} = Y_{it} - \frac{1}{g-1-t} \sum_{q=t+1}^{g-1} Y_{iq}\]</div>
<p>where the sum is over future pre-treatment periods <span class="math notranslate nohighlight">\(\{t+1, \ldots, g-1\}\)</span>.</p>
<p>Key properties:</p>
<ul class="simple">
<li><p>Uses only pre-treatment data (periods before <span class="math notranslate nohighlight">\(g\)</span>)</p></li>
<li><p>Rolling window looks forward, not backward</p></li>
<li><p>Window size decreases as <span class="math notranslate nohighlight">\(t\)</span> approaches <span class="math notranslate nohighlight">\(g-1\)</span></p></li>
</ul>
<p><strong>Pre-treatment Detrending (Formula D.2)</strong></p>
<p>For cohort <span class="math notranslate nohighlight">\(g\)</span> and pre-treatment period <span class="math notranslate nohighlight">\(t &lt; g\)</span>, fit an OLS regression:</p>
<div class="math notranslate nohighlight">
\[Y_{iq} = A + B \cdot q + \varepsilon_{iq} \quad \text{for } q \in \{t+1, \ldots, g-1\}\]</div>
<p>Then compute the detrended outcome:</p>
<div class="math notranslate nohighlight">
\[\ddot{Y}_{itg} = Y_{it} - (\hat{A} + \hat{B} \cdot t)\]</div>
<p>This requires at least 2 future pre-treatment periods for OLS estimation.</p>
</section>
<section id="anchor-point-convention">
<h3><a class="toc-backref" href="#id57" role="doc-backlink">Anchor Point Convention</a><a class="headerlink" href="#anchor-point-convention" title="Link to this heading">ïƒ</a></h3>
<p>The period immediately before treatment (<span class="math notranslate nohighlight">\(t = g-1\)</span>, event time <span class="math notranslate nohighlight">\(e = -1\)</span>)
serves as the anchor point:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{i,g-1,g} = 0 \quad \text{(by construction)}\]</div>
<p>This occurs because the rolling window <span class="math notranslate nohighlight">\(\{g, \ldots, g-1\}\)</span> is empty, and
by convention the transformation returns zero.</p>
<p>The anchor point provides:</p>
<ol class="arabic simple">
<li><p>A reference point for interpreting other pre-treatment effects</p></li>
<li><p>Normalization that facilitates comparison across cohorts</p></li>
<li><p>Consistency with event study visualization conventions</p></li>
</ol>
</section>
<section id="pre-treatment-att-estimation">
<h3><a class="toc-backref" href="#id58" role="doc-backlink">Pre-treatment ATT Estimation</a><a class="headerlink" href="#pre-treatment-att-estimation" title="Link to this heading">ïƒ</a></h3>
<p>For each cohort <span class="math notranslate nohighlight">\(g\)</span> and pre-treatment period <span class="math notranslate nohighlight">\(t &lt; g\)</span>, the pre-treatment
ATT is estimated by regressing the transformed outcome on treatment status:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{itg} = \alpha + \tau_{gt}^{pre} D_i + U_i\]</div>
<p>where <span class="math notranslate nohighlight">\(D_i = 1\)</span> for units in cohort <span class="math notranslate nohighlight">\(g\)</span> and <span class="math notranslate nohighlight">\(D_i = 0\)</span> for control
units (never-treated or not-yet-treated at time <span class="math notranslate nohighlight">\(t\)</span>).</p>
<p>Under parallel trends, <span class="math notranslate nohighlight">\(E[\tau_{gt}^{pre}] = 0\)</span> for all <span class="math notranslate nohighlight">\(t &lt; g\)</span>.</p>
</section>
<section id="control-group-for-pre-treatment-periods">
<h3><a class="toc-backref" href="#id59" role="doc-backlink">Control Group for Pre-treatment Periods</a><a class="headerlink" href="#control-group-for-pre-treatment-periods" title="Link to this heading">ïƒ</a></h3>
<p>For pre-treatment period <span class="math notranslate nohighlight">\(t &lt; g\)</span>, valid control units are:</p>
<ul class="simple">
<li><p><strong>Never-treated</strong>: Units with <span class="math notranslate nohighlight">\(D_\infty = 1\)</span></p></li>
<li><p><strong>Not-yet-treated at t</strong>: Units with first treatment after <span class="math notranslate nohighlight">\(t\)</span>
(cohorts <span class="math notranslate nohighlight">\(h &gt; t\)</span>)</p></li>
</ul>
<p>This differs from post-treatment control groups because units must be
untreated at time <span class="math notranslate nohighlight">\(t\)</span>, not just at time <span class="math notranslate nohighlight">\(r \geq g\)</span>.</p>
</section>
<section id="joint-test-for-parallel-trends">
<h3><a class="toc-backref" href="#id60" role="doc-backlink">Joint Test for Parallel Trends</a><a class="headerlink" href="#joint-test-for-parallel-trends" title="Link to this heading">ïƒ</a></h3>
<p>The parallel trends test performs a joint F-test of the null hypothesis:</p>
<div class="math notranslate nohighlight">
\[H_0: \tau_{gt}^{pre} = 0 \quad \text{for all } t &lt; g-1\]</div>
<p>The anchor point (<span class="math notranslate nohighlight">\(t = g-1\)</span>) is excluded because it is zero by construction.</p>
<p><strong>Test statistic</strong>:</p>
<div class="math notranslate nohighlight">
\[F = \frac{1}{K} \sum_{k=1}^{K} \left(\frac{\hat{\tau}_k}{\text{SE}(\hat{\tau}_k)}\right)^2\]</div>
<p>where <span class="math notranslate nohighlight">\(K\)</span> is the number of pre-treatment periods tested (excluding anchor).</p>
<p>Under <span class="math notranslate nohighlight">\(H_0\)</span>, the F-statistic follows an <span class="math notranslate nohighlight">\(F(K, \nu)\)</span> distribution,
where <span class="math notranslate nohighlight">\(\nu\)</span> is the degrees of freedom from the estimation.</p>
<p><strong>Interpretation</strong>:</p>
<ul class="simple">
<li><p>Rejection suggests evidence against parallel trends</p></li>
<li><p>Non-rejection does not prove parallel trends holds</p></li>
<li><p>Consider effect sizes, not just statistical significance</p></li>
</ul>
</section>
</section>
<section id="comparison-with-other-did-methods">
<h2><a class="toc-backref" href="#id61" role="doc-backlink">Comparison with Other DiD Methods</a><a class="headerlink" href="#comparison-with-other-did-methods" title="Link to this heading">ïƒ</a></h2>
<section id="two-way-fixed-effects-twfe">
<h3><a class="toc-backref" href="#id62" role="doc-backlink">Two-Way Fixed Effects (TWFE)</a><a class="headerlink" href="#two-way-fixed-effects-twfe" title="Link to this heading">ïƒ</a></h3>
<p>The demean transformation is algebraically equivalent to TWFE with unit and time
fixed effects. The Lee and Wooldridge method makes the cross-sectional structure
explicit, enabling exact t-based inference in small samples under the CLM
assumptions when homoskedastic OLS standard errors are used. In contrast, TWFE
inference is usually based on large-sample approximations with cluster-robust
standard errors.</p>
</section>
<section id="callaway-and-sant-anna-2021">
<h3><a class="toc-backref" href="#id63" role="doc-backlink">Callaway and Santâ€™Anna (2021)</a><a class="headerlink" href="#callaway-and-sant-anna-2021" title="Link to this heading">ïƒ</a></h3>
<p>Callaway and Santâ€™Anna (2021) develop DiD estimators for settings with staggered
adoption and group-time average treatment effects, with inference based on
large-sample approximations in panels with many groups and time periods.
Lee and Wooldridge (2025) extends the rolling transformation approach to
staggered adoption settings and develops large-sample asymptotic inference
using doubly robust estimators (IPWRA). Lee and Wooldridge (2026) focuses
on small cross-sectional sample sizes in common timing settings, showing
that exact t-based inference is available under classical linear model
assumptions (normality and homoskedasticity).</p>
</section>
<section id="when-to-use-this-method">
<h3><a class="toc-backref" href="#id64" role="doc-backlink">When to Use This Method</a><a class="headerlink" href="#when-to-use-this-method" title="Link to this heading">ïƒ</a></h3>
<p><strong>Small-sample exact inference</strong> (common timing with <code class="docutils literal notranslate"><span class="pre">vce=None</span></code>):</p>
<ul class="simple">
<li><p>Small numbers of treated and/or control units</p></li>
<li><p>Willingness to assume normality and homoskedasticity</p></li>
<li><p>Alternative: use randomization inference (<code class="docutils literal notranslate"><span class="pre">ri=True</span></code>)</p></li>
</ul>
<p><strong>Large-sample asymptotic inference</strong> (common timing or staggered):</p>
<ul class="simple">
<li><p>Moderately large cross-sectional samples</p></li>
<li><p>Use robust standard errors (<code class="docutils literal notranslate"><span class="pre">vce='robust'</span></code> or <code class="docutils literal notranslate"><span class="pre">vce='hc3'</span></code>)</p></li>
<li><p>For staggered designs, use <code class="docutils literal notranslate"><span class="pre">gvar</span></code> to specify first treatment period</p></li>
</ul>
<p><strong>Staggered adoption</strong>:</p>
<ul class="simple">
<li><p>Units treated at different times</p></li>
<li><p>Supports cohort-time specific effect estimation</p></li>
<li><p>Multiple aggregation options (none, cohort, overall)</p></li>
<li><p>Flexible control group strategies (never-treated or not-yet-treated)</p></li>
</ul>
<p><strong>This implementation does not cover</strong>:</p>
<ul class="simple">
<li><p>Treatment reversals or temporary treatments (violates persistence assumption)</p></li>
<li><p>Continuous treatment intensity (treatment must be binary)</p></li>
</ul>
</section>
</section>
<section id="practical-considerations">
<h2><a class="toc-backref" href="#id65" role="doc-backlink">Practical Considerations</a><a class="headerlink" href="#practical-considerations" title="Link to this heading">ïƒ</a></h2>
<section id="sample-size-requirements">
<h3><a class="toc-backref" href="#id66" role="doc-backlink">Sample Size Requirements</a><a class="headerlink" href="#sample-size-requirements" title="Link to this heading">ïƒ</a></h3>
<p><strong>Minimum (panel-level checks)</strong>: <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> requires at least <span class="math notranslate nohighlight">\(N \geq 3\)</span>
units in the panel, with at least one treated unit (<span class="math notranslate nohighlight">\(N_1 \geq 1\)</span>) and at
least one control unit (<span class="math notranslate nohighlight">\(N_0 \geq 1\)</span>).</p>
<p>In addition, the firstpost cross-sectional regression used for ATT estimation
must contain at least three units in total and at least one treated and one
control unit. If some units drop out of the panel before the post-treatment
period, the effective cross-sectional sample entering the main regression can be
smaller than the panel <span class="math notranslate nohighlight">\(N\)</span>; in such cases <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> raises an error rather
than reporting an ATT based on an under-identified regression.</p>
<p><strong>Practical considerations</strong>:</p>
<ul class="simple">
<li><p>Exact t-based inference under CLM assumptions is technically available at this
minimum, but in practice inference is more stable when the cross-sectional
sample is meaningfully larger than <span class="math notranslate nohighlight">\(N = 3\)</span>.</p></li>
<li><p>Cluster-robust standard errors rely on having a non-trivial number of clusters.
A commonly used rule of thumb in applied work is to have around
<span class="math notranslate nohighlight">\(G \geq 10\)</span> clusters for more reliable cluster-robust inference,
although there is no universal threshold.</p></li>
</ul>
</section>
<section id="time-index-and-panel-structure">
<h3><a class="toc-backref" href="#id67" role="doc-backlink">Time Index and Panel Structure</a><a class="headerlink" href="#time-index-and-panel-structure" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>The time index used internally by <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> must form a contiguous sequence
without gaps (e.g., years 2000, 2001, 2002, â€¦). If the original time
variables have gaps, the function raises an error rather than silently
interpolating.</p></li>
<li><p>The post-treatment indicator <code class="docutils literal notranslate"><span class="pre">post</span></code> must be a pure function of time (common
timing): at any given time period, all units are either pre-treatment or
post-treatment. This aligns with the common timing assumption described above.</p></li>
</ul>
</section>
<section id="pre-treatment-periods">
<h3><a class="toc-backref" href="#id68" role="doc-backlink">Pre-Treatment Periods</a><a class="headerlink" href="#pre-treatment-periods" title="Link to this heading">ïƒ</a></h3>
<p><strong>Minimum requirements in this implementation</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">demean</span></code>: At least one pre-treatment period overall (<span class="math notranslate nohighlight">\(T_0 \geq 1\)</span>),
and each unit must have at least one pre-treatment observation so that its
pre-treatment mean can be computed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">detrend</span></code>: At least two pre-treatment periods overall (<span class="math notranslate nohighlight">\(T_0 \geq 2\)</span>),
and each unit must have at least two pre-treatment observations so that a
unit-specific linear trend can be estimated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">demeanq</span></code> and <code class="docutils literal notranslate"><span class="pre">detrendq</span></code>: The minimum number of pre-treatment observations
depends on the seasonal period Q:</p>
<ul class="simple">
<li><p><strong>demeanq</strong>: <span class="math notranslate nohighlight">\(n_{pre} \geq Q + 1\)</span> per unit (e.g., 5 for quarterly, 13 for monthly, 53 for weekly)</p></li>
<li><p><strong>detrendq</strong>: <span class="math notranslate nohighlight">\(n_{pre} \geq Q + 2\)</span> per unit (e.g., 6 for quarterly, 14 for monthly, 54 for weekly)</p></li>
</ul>
<p>Additionally, for each unit, every season that appears in the post-treatment
period must also appear in the pre-treatment period; otherwise seasonal effects
for that season cannot be removed.</p>
</li>
</ul>
<p><strong>Practical recommendations</strong>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(T_0 \geq 3\)</span> for detrend/detrendq (more stable trend estimation)</p></li>
<li><p>More pre-treatment periods improve statistical power and facilitate visual
assessment of parallel trends</p></li>
</ul>
</section>
<section id="control-variables">
<h3><a class="toc-backref" href="#id69" role="doc-backlink">Control Variables</a><a class="headerlink" href="#control-variables" title="Link to this heading">ïƒ</a></h3>
<p>Time-invariant controls (e.g., baseline characteristics) are permitted.</p>
<p><strong>Effects</strong>:</p>
<ul class="simple">
<li><p>Reduces residual variance, increasing power</p></li>
<li><p>Reduces degrees of freedom</p></li>
<li><p>Does not affect the transformation step</p></li>
</ul>
<p>Including many controls relative to sample size can lead to overfitting and
unstable estimates. In this implementation, time-invariant controls are included
only when both groups are sufficiently large relative to the number of controls:
controls enter the regression if <span class="math notranslate nohighlight">\(N_1 &gt; K+1\)</span> and <span class="math notranslate nohighlight">\(N_0 &gt; K+1\)</span>, where
<span class="math notranslate nohighlight">\(K\)</span> is the number of control variables. Otherwise, <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> issues a
warning and estimates the model without controls to avoid under-identified or
extremely fragile regressions. When controls are included, observations with
missing values in any included control variable are dropped from the main
regression sample; <code class="docutils literal notranslate"><span class="pre">lwdid</span></code> reports how many observations were removed. If
dropping those observations would cause either group to violate the
<span class="math notranslate nohighlight">\(N_1 &gt; K+1\)</span> or <span class="math notranslate nohighlight">\(N_0 &gt; K+1\)</span> conditions, controls are omitted instead
and the full sample is retained.</p>
</section>
<section id="computational-considerations">
<h3><a class="toc-backref" href="#id70" role="doc-backlink">Computational Considerations</a><a class="headerlink" href="#computational-considerations" title="Link to this heading">ïƒ</a></h3>
<p><strong>Speed</strong>: The transformation and cross-sectional regression steps are
computationally efficient for typical panel datasets. Randomization inference
requires <span class="math notranslate nohighlight">\(R\)</span> replications and is more computationally intensive
(computation time scales linearly with <span class="math notranslate nohighlight">\(R\)</span>).</p>
<p><strong>Memory</strong>: Memory requirements are modest for typical panel datasets.
Randomization inference stores <span class="math notranslate nohighlight">\(R\)</span> test statistics for computing the
empirical p-value.</p>
</section>
</section>
<section id="limitations">
<h2><a class="toc-backref" href="#id71" role="doc-backlink">Limitations</a><a class="headerlink" href="#limitations" title="Link to this heading">ïƒ</a></h2>
<p>This implementation has the following limitations:</p>
<ol class="arabic simple">
<li><p><strong>Binary treatment</strong>: Treatment is either on or off (no continuous treatment intensity)</p></li>
<li><p><strong>Time-invariant controls</strong>: Controls must not vary over time</p></li>
<li><p><strong>Treatment persistence</strong>: Once treated, units must remain treated</p></li>
<li><p><strong>Seasonal methods data requirements</strong>: The <code class="docutils literal notranslate"><span class="pre">demeanq</span></code> and <code class="docutils literal notranslate"><span class="pre">detrendq</span></code>
transformations require sufficient pre-treatment observations for seasonal
parameter estimation. In staggered designs, early cohorts with limited
pre-treatment data may be excluded if they lack the required observations</p></li>
</ol>
</section>
<section id="staggered-adoption">
<h2><a class="toc-backref" href="#id72" role="doc-backlink">Staggered Adoption</a><a class="headerlink" href="#staggered-adoption" title="Link to this heading">ïƒ</a></h2>
<p>When units are treated at different times, the staggered adoption framework applies.
This is activated by specifying the <code class="docutils literal notranslate"><span class="pre">gvar</span></code> parameter (first treatment period for
each unit) instead of <code class="docutils literal notranslate"><span class="pre">post</span></code>.</p>
<section id="identification">
<h3><a class="toc-backref" href="#id73" role="doc-backlink">Identification</a><a class="headerlink" href="#identification" title="Link to this heading">ïƒ</a></h3>
<p>For treatment cohort <span class="math notranslate nohighlight">\(g\)</span> (units first treated in period <span class="math notranslate nohighlight">\(g\)</span>) and
calendar time <span class="math notranslate nohighlight">\(r \geq g\)</span>, the ATT is identified under:</p>
<ol class="arabic simple">
<li><p><strong>No anticipation</strong>: <span class="math notranslate nohighlight">\(E[Y_t(g) - Y_t(\infty) | D_g = 1] = 0\)</span> for
<span class="math notranslate nohighlight">\(t &lt; g\)</span></p></li>
<li><p><strong>Conditional parallel trends</strong>:
<span class="math notranslate nohighlight">\(E[Y_t(\infty) - Y_1(\infty) | D, X] = E[Y_t(\infty) - Y_1(\infty) | X]\)</span></p></li>
</ol>
<p>These assumptions ensure that never-treated and not-yet-treated units provide
valid counterfactuals for estimating treatment effects.</p>
</section>
<section id="transformation">
<h3><a class="toc-backref" href="#id74" role="doc-backlink">Transformation</a><a class="headerlink" href="#transformation" title="Link to this heading">ïƒ</a></h3>
<p>For each cohort <span class="math notranslate nohighlight">\(g\)</span> and period <span class="math notranslate nohighlight">\(r \geq g\)</span>, the transformed outcome
is:</p>
<p><strong>Demean</strong>:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{irg} = Y_{ir} - \frac{1}{g-1} \sum_{s=1}^{g-1} Y_{is}\]</div>
<p><strong>Detrend</strong>:</p>
<div class="math notranslate nohighlight">
\[\ddot{Y}_{irg} = Y_{ir} - \hat{A}_i - \hat{B}_i r\]</div>
<p>where the trend coefficients are estimated from pre-treatment periods
<span class="math notranslate nohighlight">\(\{1, \ldots, g-1\}\)</span>.</p>
</section>
<section id="control-group-strategies">
<h3><a class="toc-backref" href="#id75" role="doc-backlink">Control Group Strategies</a><a class="headerlink" href="#control-group-strategies" title="Link to this heading">ïƒ</a></h3>
<p>Lee and Wooldridge (2025, Section 4.1) establishes that, under the conditional
parallel trends assumption (CPTS), the cohort treatment indicators are
unconfounded with respect to the transformed potential outcome. This implies:</p>
<ul class="simple">
<li><p>For estimating <span class="math notranslate nohighlight">\(\tau_{gr}\)</span> (effect for cohort <span class="math notranslate nohighlight">\(g\)</span> at time
<span class="math notranslate nohighlight">\(r\)</span>), cohorts <span class="math notranslate nohighlight">\(h &gt; r\)</span> (not-yet-treated at time <span class="math notranslate nohighlight">\(r\)</span>) can
serve as valid controls in addition to never-treated units</p></li>
<li><p>Equation (4.8) in the paper shows:
<span class="math notranslate nohighlight">\(E[\dot{Y}_{rg}(\infty)|D_\infty=1, X] = E[\dot{Y}_{rg}(\infty)|D_h=1, X]\)</span>
for all <span class="math notranslate nohighlight">\(h\)</span>, meaning the conditional expectation is the same across all
cohorts</p></li>
<li><p>Equation (4.9) further shows that, by no anticipation,
<span class="math notranslate nohighlight">\(E[\dot{Y}_{rg}(\infty)|D_h=1, X] = E[\dot{Y}_{rg}(h)|D_h=1, X]\)</span> for
<span class="math notranslate nohighlight">\(h &gt; r\)</span>, so not-yet-treated units can substitute for never-treated units</p></li>
</ul>
<p><strong>Strategies</strong>:</p>
<ul class="simple">
<li><p><strong>never_treated</strong>: Only units with <span class="math notranslate nohighlight">\(D_\infty = 1\)</span> (never treated during
observation period)</p></li>
<li><p><strong>not_yet_treated</strong>: Never treated plus units with first treatment after
period <span class="math notranslate nohighlight">\(r\)</span> (i.e., cohorts <span class="math notranslate nohighlight">\(h \in \{r+1, \ldots, T, \infty\}\)</span>)</p></li>
</ul>
<p>The not-yet-treated strategy uses more control observations, potentially improving
efficiency, while the never-treated strategy may be more robust to violations of
no anticipation.</p>
</section>
<section id="all-units-eventually-treated">
<h3><a class="toc-backref" href="#id76" role="doc-backlink">All Units Eventually Treated</a><a class="headerlink" href="#all-units-eventually-treated" title="Link to this heading">ïƒ</a></h3>
<p>Lee and Wooldridge (2025, Section 4.2) addresses the case where no units remain
untreated through period <span class="math notranslate nohighlight">\(T\)</span> (no never-treated group). In this setting:</p>
<ol class="arabic simple">
<li><p>Treatment effects are defined relative to <span class="math notranslate nohighlight">\(Y_t(T)\)</span>, the state of being
treated only in the final period, rather than <span class="math notranslate nohighlight">\(Y_t(\infty)\)</span></p></li>
<li><p>Effects can only be estimated for cohorts <span class="math notranslate nohighlight">\(g \in \{S, \ldots, T-1\}\)</span>;
no effect can be estimated for the final cohort (<span class="math notranslate nohighlight">\(g = T\)</span>) because there
are no control units</p></li>
<li><p>By no anticipation, for <span class="math notranslate nohighlight">\(r &lt; T\)</span>:
<span class="math notranslate nohighlight">\(E[Y_r(g) - Y_r(T)|D_g = 1] = E[Y_r(g) - Y_r(\infty)|D_g = 1]\)</span>, so
except for the final period the ATTs have the same interpretation as when a
never-treated group exists</p></li>
<li><p>When <span class="math notranslate nohighlight">\(r = T\)</span>, the only available control is cohort <span class="math notranslate nohighlight">\(g = T\)</span> (units
first treated in the final period)</p></li>
</ol>
<p>The implementation handles this automatically: when aggregating to cohort or overall
effects, only cohorts with valid control groups are included.</p>
</section>
<section id="estimation-methods">
<h3><a class="toc-backref" href="#id77" role="doc-backlink">Estimation Methods</a><a class="headerlink" href="#estimation-methods" title="Link to this heading">ïƒ</a></h3>
<p>In staggered mode, multiple estimators are available:</p>
<ul class="simple">
<li><p><strong>ra</strong> (Regression Adjustment): OLS on transformed outcome</p></li>
<li><p><strong>ipw</strong> (Inverse Probability Weighting): Propensity score weighting</p></li>
<li><p><strong>ipwra</strong> (Doubly Robust): Combines regression and IPW</p></li>
<li><p><strong>psm</strong> (Propensity Score Matching): Nearest neighbor matching</p></li>
</ul>
<p>The doubly robust IPWRA estimator is consistent if either the outcome model or
propensity score model is correctly specified, making it particularly attractive
when functional form assumptions are uncertain.</p>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id78" role="doc-backlink">Inference Distribution by Estimator</a><a class="headerlink" href="#id2" title="Link to this heading">ïƒ</a></h3>
<p>Different estimators use different reference distributions for inference:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Estimator</p></th>
<th class="head"><p>Distribution</p></th>
<th class="head"><p>Rationale</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RA (OLS)</p></td>
<td><p>t-distribution</p></td>
<td><p>Exact inference under CLM assumptions; df = N - k</p></td>
</tr>
<tr class="row-odd"><td><p>IPW</p></td>
<td><p>Normal</p></td>
<td><p>Asymptotic inference based on influence functions</p></td>
</tr>
<tr class="row-even"><td><p>IPWRA</p></td>
<td><p>Normal</p></td>
<td><p>Asymptotic inference based on influence functions</p></td>
</tr>
<tr class="row-odd"><td><p>PSM</p></td>
<td><p>Normal</p></td>
<td><p>Asymptotic inference; SE based on Abadie-Imbens formula</p></td>
</tr>
</tbody>
</table>
<p><strong>Comparison with Stata</strong></p>
<p>This package follows the same inference approach as Stataâ€™s <code class="docutils literal notranslate"><span class="pre">teffects</span></code> commands:</p>
<ul class="simple">
<li><p><strong>RA</strong>: Uses t-distribution (exact under CLM assumptions)</p></li>
<li><p><strong>IPW</strong>: Uses normal distribution (asymptotic inference)</p></li>
<li><p><strong>IPWRA</strong>: Uses normal distribution (asymptotic inference)</p></li>
<li><p><strong>PSM</strong>: Uses normal distribution (asymptotic inference)</p></li>
</ul>
<p>The rationale for this design:</p>
<ol class="arabic simple">
<li><p><strong>RA</strong> uses t-distribution following Lee and Wooldridge (2026, Eq. 2.10),
which provides exact finite-sample inference under classical linear model
assumptions</p></li>
<li><p><strong>IPW, IPWRA, PSM</strong> use normal distribution because these estimators rely on
asymptotic theory (influence functions or matching-based variance estimators)
where t-distribution adjustments are not directly applicable</p></li>
<li><p>For large samples (N &gt; 50), the practical difference between t and normal
distributions is negligible in any case</p></li>
</ol>
</section>
<section id="aggregation">
<h3><a class="toc-backref" href="#id79" role="doc-backlink">Aggregation</a><a class="headerlink" href="#aggregation" title="Link to this heading">ïƒ</a></h3>
<p>Cohort-time specific effects <span class="math notranslate nohighlight">\(\tau_{gr}\)</span> can be aggregated:</p>
<ul>
<li><p><strong>none</strong>: Report <span class="math notranslate nohighlight">\((g,r)\)</span>-specific effects only</p></li>
<li><p><strong>cohort</strong>: Average effects within each cohort:</p>
<div class="math notranslate nohighlight">
\[\tau_g = \frac{1}{T-g+1} \sum_{r=g}^{T} \tau_{gr}\]</div>
</li>
<li><p><strong>overall</strong>: Cohort-share weighted average:</p>
<div class="math notranslate nohighlight">
\[\tau_\omega = \sum_g \omega_g \tau_g \quad \text{where } \omega_g = N_g/N_{treat}\]</div>
</li>
</ul>
</section>
<section id="event-time-aggregation-watt">
<h3><a class="toc-backref" href="#id80" role="doc-backlink">Event Time Aggregation (WATT)</a><a class="headerlink" href="#event-time-aggregation-watt" title="Link to this heading">ïƒ</a></h3>
<p>The weighted average treatment effect on the treated (WATT) by event time provides
an aggregation of cohort-time specific effects <span class="math notranslate nohighlight">\(\tau_{gr}\)</span> across cohorts
sharing the same relative time since treatment onset. This follows Lee and
Wooldridge (2025, Section 6.2).</p>
<p>For event time <span class="math notranslate nohighlight">\(e = r - g\)</span> (relative time since treatment), the WATT is:</p>
<div class="math notranslate nohighlight">
\[\text{WATT}(e) = \sum_{g \in G_e} w(g,e) \cdot \tau_{g, g+e}\]</div>
<p>where <span class="math notranslate nohighlight">\(G_e\)</span> is the set of cohorts with a valid ATT estimate at event time
<span class="math notranslate nohighlight">\(e\)</span>, and the weights are cohort-size proportions:</p>
<div class="math notranslate nohighlight">
\[w(g,e) = \frac{N_g}{\sum_{g' \in G_e} N_{g'}}\]</div>
<p><strong>Standard Error Computation</strong></p>
<p>The standard error for the WATT at event time <span class="math notranslate nohighlight">\(e\)</span> is computed as:</p>
<div class="math notranslate nohighlight">
\[SE(\text{WATT}(e)) = \sqrt{\sum_{g \in G_e} [w(g,e)]^2 \cdot [SE(\tau_{g,g+e})]^2}\]</div>
<p>This formula assumes independence across cohorts and uses the normalized weights.</p>
<p><strong>Degrees of Freedom</strong></p>
<p>For t-distribution inference on event-time aggregated effects, the degrees of
freedom are chosen conservatively as the minimum across contributing cohorts:</p>
<div class="math notranslate nohighlight">
\[df(e) = \min_{g \in G_e} df_g\]</div>
<p>This provides conservative coverage that accounts for finite-sample uncertainty.</p>
<p><strong>Event Study Visualization</strong></p>
<p>Event time aggregation is particularly useful for event study plots, which display
treatment effects as a function of relative time. The pre-treatment effects
(negative event times) serve as placebo tests for the parallel trends assumption,
while post-treatment effects reveal the dynamic treatment response.</p>
<p>The anchor point at event time <span class="math notranslate nohighlight">\(e = -1\)</span> is set to zero by convention,
serving as the reference baseline for interpreting other effects.</p>
</section>
</section>
<section id="robustness-to-pre-treatment-period-selection">
<h2><a class="toc-backref" href="#id81" role="doc-backlink">Robustness to Pre-treatment Period Selection</a><a class="headerlink" href="#robustness-to-pre-treatment-period-selection" title="Link to this heading">ïƒ</a></h2>
<p>Lee and Wooldridge (2026) Section 8.1 recommends studying the robustness of DiD
estimates by varying the number of pre-treatment periods used in the transformation.
This section describes the sensitivity analysis tools implemented in <code class="docutils literal notranslate"><span class="pre">lwdid</span></code>.</p>
<section id="id3">
<h3><a class="toc-backref" href="#id82" role="doc-backlink">Motivation</a><a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h3>
<p>The rolling transformation approach uses pre-treatment periods to estimate
unit-specific means or trends. The choice of how many pre-treatment periods to
include can affect the estimates:</p>
<ul class="simple">
<li><p><strong>Too few periods</strong>: May not adequately capture unit-specific patterns</p></li>
<li><p><strong>Too many periods</strong>: May include periods where parallel trends do not hold</p></li>
</ul>
<p>From Lee and Wooldridge (2026):</p>
<blockquote>
<div><p>â€œWith synthetic control-type approaches and the approaches we suggest here,
one can study the robustness of the findings by adjusting the number of
pre-treatment time periods.â€</p>
</div></blockquote>
</section>
<section id="sensitivity-ratio">
<h3><a class="toc-backref" href="#id83" role="doc-backlink">Sensitivity Ratio</a><a class="headerlink" href="#sensitivity-ratio" title="Link to this heading">ïƒ</a></h3>
<p>The sensitivity ratio measures how much ATT estimates vary across specifications
with different numbers of pre-treatment periods:</p>
<div class="math notranslate nohighlight">
\[\text{Sensitivity Ratio} = \frac{\max_k \hat{\tau}_k - \min_k \hat{\tau}_k}{|\hat{\tau}_{\text{baseline}}|}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\tau}_k\)</span> is the ATT estimate using <span class="math notranslate nohighlight">\(k\)</span> pre-treatment periods,
and <span class="math notranslate nohighlight">\(\hat{\tau}_{\text{baseline}}\)</span> is the estimate using all available
pre-treatment periods.</p>
<p><strong>Interpretation</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 25.0%" />
<col style="width: 55.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sensitivity Ratio</p></th>
<th class="head"><p>Robustness Level</p></th>
<th class="head"><p>Interpretation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>&lt; 10%</p></td>
<td><p>Highly Robust</p></td>
<td><p>Estimates stable across specifications</p></td>
</tr>
<tr class="row-odd"><td><p>10-25%</p></td>
<td><p>Moderately Robust</p></td>
<td><p>Some sensitivity, generally acceptable</p></td>
</tr>
<tr class="row-even"><td><p>25-50%</p></td>
<td><p>Sensitive</p></td>
<td><p>Interpret with caution</p></td>
</tr>
<tr class="row-odd"><td><p>â‰¥ 50%</p></td>
<td><p>Highly Sensitive</p></td>
<td><p>Results depend heavily on specification</p></td>
</tr>
</tbody>
</table>
</section>
<section id="using-robustness-pre-periods">
<h3><a class="toc-backref" href="#id84" role="doc-backlink">Using robustness_pre_periods()</a><a class="headerlink" href="#using-robustness-pre-periods" title="Link to this heading">ïƒ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">robustness_pre_periods()</span></code> function implements this sensitivity analysis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">robustness_pre_periods</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">robustness_pre_periods</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;detrend&#39;</span><span class="p">,</span>
    <span class="n">pre_period_range</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>The function:</p>
<ol class="arabic simple">
<li><p>Estimates ATT using different numbers of pre-treatment periods</p></li>
<li><p>Computes the sensitivity ratio</p></li>
<li><p>Assesses robustness level</p></li>
<li><p>Generates recommendations</p></li>
</ol>
</section>
<section id="no-anticipation-sensitivity">
<h3><a class="toc-backref" href="#id85" role="doc-backlink">No-Anticipation Sensitivity</a><a class="headerlink" href="#no-anticipation-sensitivity" title="Link to this heading">ïƒ</a></h3>
<p>When policy is announced before implementation, units may adjust behavior in
anticipation. The <code class="docutils literal notranslate"><span class="pre">sensitivity_no_anticipation()</span></code> function tests robustness
by excluding periods immediately before treatment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">sensitivity_no_anticipation</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">sensitivity_no_anticipation</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span> <span class="n">max_anticipation</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">anticipation_detected</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consider excluding </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">recommended_exclusion</span><span class="si">}</span><span class="s2"> periods&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The function:</p>
<ol class="arabic simple">
<li><p>Estimates ATT excluding 0, 1, 2, â€¦ periods before treatment</p></li>
<li><p>Detects significant changes in estimates</p></li>
<li><p>Recommends how many periods to exclude</p></li>
</ol>
</section>
<section id="using-exclude-pre-periods-parameter">
<h3><a class="toc-backref" href="#id86" role="doc-backlink">Using exclude_pre_periods Parameter</a><a class="headerlink" href="#using-exclude-pre-periods-parameter" title="Link to this heading">ïƒ</a></h3>
<p>Based on sensitivity analysis results, periods can be excluded in the main
estimation using the <code class="docutils literal notranslate"><span class="pre">exclude_pre_periods</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">lwdid</span>

<span class="c1"># Exclude 2 periods immediately before treatment</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span>
    <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;demean&#39;</span><span class="p">,</span> <span class="n">exclude_pre_periods</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This parameter:</p>
<ul class="simple">
<li><p>Excludes the specified number of pre-treatment periods from transformation</p></li>
<li><p>Addresses potential anticipation effects</p></li>
<li><p>Implements the robustness check from Lee and Wooldridge (2026) Section 8.1</p></li>
</ul>
</section>
<section id="comprehensive-sensitivity-analysis">
<h3><a class="toc-backref" href="#id87" role="doc-backlink">Comprehensive Sensitivity Analysis</a><a class="headerlink" href="#comprehensive-sensitivity-analysis" title="Link to this heading">ïƒ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sensitivity_analysis()</span></code> function provides a comprehensive assessment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">sensitivity_analysis</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">sensitivity_analysis</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat&#39;</span><span class="p">,</span>
    <span class="n">analyses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pre_periods&#39;</span><span class="p">,</span> <span class="s1">&#39;anticipation&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="n">result</span><span class="o">.</span><span class="n">plot_all</span><span class="p">()</span>
</pre></div>
</div>
<p>This function combines multiple sensitivity analyses and provides an overall
assessment of estimate robustness.</p>
</section>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id88" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading">ïƒ</a></h2>
<p>Lee, S. J., and Wooldridge, J. M. (2026). Simple Approaches to Inference with
Difference-in-Differences Estimators with Small Cross-Sectional Sample Sizes.
<em>Available at SSRN 5325686</em>.</p>
<p>Lee, S. J., and Wooldridge, J. M. (2025). A Simple Transformation Approach to
Difference-in-Differences Estimation for Panel Data.
<em>Available at SSRN 4516518</em>.</p>
</section>
<section id="further-reading">
<h2><a class="toc-backref" href="#id89" role="doc-backlink">Further Reading</a><a class="headerlink" href="#further-reading" title="Link to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="user_guide.html"><span class="doc">User Guide</span></a> - Comprehensive usage guide</p></li>
<li><p><a class="reference internal" href="quickstart.html"><span class="doc">Quick Start</span></a> - Quick start tutorial</p></li>
<li><p><a class="reference internal" href="api/index.html"><span class="doc">API Reference</span></a> - Complete API reference</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api/exceptions.html" class="btn btn-neutral float-left" title="Exceptions Module (exceptions)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Xuanyu Cai, Wenli Xu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>