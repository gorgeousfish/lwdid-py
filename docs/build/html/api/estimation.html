

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estimation Module (estimation) &mdash; lwdid 0.2.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Validation Module (validation)" href="validation.html" />
    <link rel="prev" title="Transformations Module" href="transformations.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            lwdid
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#system-requirements">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation-methods">Installation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#install-via-pip-recommended">Install via pip (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#install-from-source">Install from Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#common-issues">Common Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#numpy-version-conflicts">numpy Version Conflicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#statsmodels-installation-failure">statsmodels Installation Failure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#basic-example">Basic Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#simplest-usage">Simplest Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#key-parameters">Key Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#required-parameters">Required Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#common-options">Common Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#small-sample-exact-inference">Small-Sample Exact Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#large-sample-inference">Large-Sample Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#doubly-robust-estimation">Doubly Robust Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#randomization-inference">Randomization Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#adding-control-variables">Adding Control Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#quarterly-data">Quarterly Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#results-object">Results Object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#core-attributes">Core Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#sample-information">Sample Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#period-specific-effects">Period-Specific Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#methods">Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#data-format-requirements">Data Format Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#panel-data-structure">Panel Data Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#key-requirements">Key Requirements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#staggered-adoption">Staggered Adoption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#staggered-results">Staggered Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#key-staggered-parameters">Key Staggered Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#scenario-selection-guide">Scenario Selection Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#quick-reference">Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#transformation-methods">Transformation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#demean-standard-did-with-unit-fixed-effects">demean: Standard DiD with Unit Fixed Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#detrend-did-with-unit-specific-linear-trends">detrend: DiD with Unit-Specific Linear Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#demeanq-quarterly-data-with-seasonal-fixed-effects">demeanq: Quarterly Data with Seasonal Fixed Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#detrendq-quarterly-data-with-trends-and-seasonal-effects">detrendq: Quarterly Data with Trends and Seasonal Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#variance-estimation">Variance Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#ols-homoskedastic">OLS (Homoskedastic)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc0-white-s-heteroskedasticity-consistent">HC0 (White’s Heteroskedasticity-Consistent)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc1-heteroskedasticity-robust">HC1 (Heteroskedasticity-Robust)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc2-leverage-adjusted">HC2 (Leverage-Adjusted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc3-small-sample-adjusted-robust">HC3 (Small-Sample Adjusted Robust)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc4-high-leverage-adjusted">HC4 (High-Leverage Adjusted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#cluster-robust">Cluster-Robust</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#randomization-inference">Randomization Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#ri-methods">RI Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#accessing-ri-results">Accessing RI Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#control-variables">Control Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#id1">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#effect-on-inference">Effect on Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#working-with-results">Working with Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#core-estimates">Core Estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#period-specific-effects">Period-Specific Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#sample-information">Sample Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#export-results">Export Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#print-summary">Print Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#data-requirements-and-validation">Data Requirements and Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#panel-structure">Panel Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#treatment-structure">Treatment Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#treatment-indicator">Treatment Indicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#missing-data">Missing Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#choosing-transformation-method">Choosing Transformation Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#choosing-variance-estimator">Choosing Variance Estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#sample-size-considerations">Sample Size Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#estimator-selection-large-sample-common-timing">Estimator Selection (Large-Sample Common Timing)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#diagnostic-checks">Diagnostic Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#common-errors">Common Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#performance-tips">Performance Tips</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#staggered-adoption-design">Staggered Adoption Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#id2">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#staggered-specific-parameters">Staggered-Specific Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#accessing-staggered-results">Accessing Staggered Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#control-group-strategies">Control Group Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#estimator-selection">Estimator Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#staggered-example">Staggered Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#basic-did-estimation">Basic DiD Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#california-smoking-restriction">California Smoking Restriction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#robustness-checks">Robustness Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#quarterly-data">Quarterly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#retail-sales-with-seasonal-patterns">Retail Sales with Seasonal Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#control-variables">Control Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#including-baseline-characteristics">Including Baseline Characteristics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#cluster-robust-inference">Cluster-Robust Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#multi-level-data-structure">Multi-Level Data Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#randomization-inference">Randomization Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#non-parametric-testing">Non-Parametric Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#comparing-ri-methods">Comparing RI Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#diagnostic-checks">Diagnostic Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#testing-parallel-trends">Testing Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#sensitivity-analysis">Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#export-and-reporting">Export and Reporting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#creating-publication-tables">Creating Publication Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#staggered-did-castle-law">Staggered DiD: Castle Law</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#castle-doctrine-analysis">Castle Doctrine Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#complete-workflow-example">Complete Workflow Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#end-to-end-analysis">End-to-End Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#core-modules">Core Modules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="core.html">Core Module (core)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="core.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="results.html">Results Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="results.html#attributes-reference">Attributes Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#methods-reference">Methods Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#usage-by-design-type">Usage by Design Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#lwdidresults-class">LWDIDResults Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="staggered.html">Staggered DiD Module (staggered)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#key-concepts">Key Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#transformations">Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#control-groups">Control Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#estimation">Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#aggregation">Aggregation</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#ipw-estimator">IPW Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#ipwra-estimator">IPWRA Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#psm-estimator">PSM Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#randomization-inference">Randomization Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="transformations.html">Transformations Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#available-transformations">Available Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#id1">Available Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#unit-level-functions">Unit-Level Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#internal-functions">Internal Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#transformation-selection-guide">Transformation Selection Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#staggered-adoption-transformations">Staggered Adoption Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="transformations.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Estimation Module (estimation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lwdid.estimation.prepare_controls"><code class="docutils literal notranslate"><span class="pre">prepare_controls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#lwdid.estimation.estimate_att"><code class="docutils literal notranslate"><span class="pre">estimate_att()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#lwdid.estimation.estimate_period_effects"><code class="docutils literal notranslate"><span class="pre">estimate_period_effects()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#estimation-functions">Estimation Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variance-estimators">Variance Estimators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-details">Implementation Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#technical-notes">Technical Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#large-sample-inference">Large-Sample Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#estimator-selection-for-large-samples">Estimator Selection for Large Samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Validation Module (validation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_and_prepare_data"><code class="docutils literal notranslate"><span class="pre">validate_and_prepare_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_quarter_diversity"><code class="docutils literal notranslate"><span class="pre">validate_quarter_diversity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_quarter_coverage"><code class="docutils literal notranslate"><span class="pre">validate_quarter_coverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.get_cohort_mask"><code class="docutils literal notranslate"><span class="pre">get_cohort_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.is_never_treated"><code class="docutils literal notranslate"><span class="pre">is_never_treated()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_staggered_data"><code class="docutils literal notranslate"><span class="pre">validate_staggered_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#validation-checks">Validation Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#validation-functions">Validation Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#staggered-adoption-validation">Staggered Adoption Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#common-validation-errors-and-solutions">Common Validation Errors and Solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="randomization.html">Randomization Inference Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#resampling-methods">Resampling Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#returns">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#methodological-notes">Methodological Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html">Visualization Module (visualization)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#lwdid.visualization.prepare_plot_data"><code class="docutils literal notranslate"><span class="pre">prepare_plot_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#lwdid.visualization.plot_results"><code class="docutils literal notranslate"><span class="pre">plot_results()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#plot-components">Plot Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#advanced-customization">Advanced Customization</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#staggered-adoption-visualization">Staggered Adoption Visualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#exporting-plots">Exporting Plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#plot-parameters-reference">Plot Parameters Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#examples-gallery">Examples Gallery</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html">Exceptions Module (exceptions)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.LWDIDError"><code class="docutils literal notranslate"><span class="pre">LWDIDError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidParameterError"><code class="docutils literal notranslate"><span class="pre">InvalidParameterError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidRollingMethodError"><code class="docutils literal notranslate"><span class="pre">InvalidRollingMethodError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidVCETypeError"><code class="docutils literal notranslate"><span class="pre">InvalidVCETypeError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientDataError"><code class="docutils literal notranslate"><span class="pre">InsufficientDataError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.NoTreatedUnitsError"><code class="docutils literal notranslate"><span class="pre">NoTreatedUnitsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.NoControlUnitsError"><code class="docutils literal notranslate"><span class="pre">NoControlUnitsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientPrePeriodsError"><code class="docutils literal notranslate"><span class="pre">InsufficientPrePeriodsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientQuarterDiversityError"><code class="docutils literal notranslate"><span class="pre">InsufficientQuarterDiversityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.TimeDiscontinuityError"><code class="docutils literal notranslate"><span class="pre">TimeDiscontinuityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.MissingRequiredColumnError"><code class="docutils literal notranslate"><span class="pre">MissingRequiredColumnError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.RandomizationError"><code class="docutils literal notranslate"><span class="pre">RandomizationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.VisualizationError"><code class="docutils literal notranslate"><span class="pre">VisualizationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidStaggeredDataError"><code class="docutils literal notranslate"><span class="pre">InvalidStaggeredDataError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.NoNeverTreatedError"><code class="docutils literal notranslate"><span class="pre">NoNeverTreatedError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-classes">Exception Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-handling-best-practices">Error Handling Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#common-error-scenarios">Common Error Scenarios</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quick-index">Quick Index</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methodological_notes.html">Methodological Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#the-panel-to-cross-section-transformation">The Panel-to-Cross-Section Transformation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#core-principle">Core Principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#demean-transformation-procedure-2-1">Demean Transformation (Procedure 2.1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#detrend-transformation-procedure-3-1">Detrend Transformation (Procedure 3.1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#quarterly-transformations">Quarterly Transformations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#inference-under-clm-assumptions">Inference Under CLM Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#classical-linear-model-assumptions">Classical Linear Model Assumptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#degrees-of-freedom">Degrees of Freedom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#period-specific-effects">Period-Specific Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#robust-inference">Robust Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#heteroskedasticity-robust-standard-errors">Heteroskedasticity-Robust Standard Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#cluster-robust-standard-errors">Cluster-Robust Standard Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#randomization-inference">Randomization Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#large-sample-asymptotic-inference">Large-Sample Asymptotic Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#asymptotic-theory">Asymptotic Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#doubly-robust-estimation">Doubly Robust Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#efficiency-considerations">Efficiency Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../methodological_notes.html#monte-carlo-simulation-evidence">Monte Carlo Simulation Evidence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#when-to-use-large-sample-methods">When to Use Large-Sample Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#identification-assumptions">Identification Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#no-anticipation">No Anticipation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#parallel-trends">Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#common-treatment-timing-common-timing-mode">Common Treatment Timing (Common Timing Mode)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#treatment-persistence">Treatment Persistence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#comparison-with-other-did-methods">Comparison with Other DiD Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#two-way-fixed-effects-twfe">Two-Way Fixed Effects (TWFE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#callaway-and-sant-anna-2021">Callaway and Sant’Anna (2021)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#when-to-use-this-method">When to Use This Method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#practical-considerations">Practical Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#sample-size-requirements">Sample Size Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#time-index-and-panel-structure">Time Index and Panel Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#pre-treatment-periods">Pre-Treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#control-variables">Control Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#computational-considerations">Computational Considerations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#staggered-adoption">Staggered Adoption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#identification">Identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#transformation">Transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#control-group-strategies">Control Group Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#all-units-eventually-treated">All Units Eventually Treated</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#estimation-methods">Estimation Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#aggregation">Aggregation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#how-to-contribute">How to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#code-standards">Code Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#reporting-issues">Reporting Issues</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lwdid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">API Reference</a></li>
      <li class="breadcrumb-item active">Estimation Module (estimation)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/estimation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="estimation-module-estimation">
<h1>Estimation Module (estimation)<a class="headerlink" href="#estimation-module-estimation" title="Link to this heading"></a></h1>
<p>The estimation module implements the core regression and inference procedures
for the Lee and Wooldridge difference-in-differences methods.</p>
<p id="module-lwdid.estimation">Cross-sectional OLS estimation for difference-in-differences analysis.</p>
<p>This module implements OLS regression on transformed outcome variables for
estimating average treatment effects on the treated (ATT) in common timing
difference-in-differences designs. After unit-specific time-series
transformations remove pre-treatment patterns, the estimation problem
reduces to standard cross-sectional regression.</p>
<p>The module provides three main functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prepare_controls</span></code> : Constructs centered controls and interaction terms
for regression adjustment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">estimate_att</span></code> : Estimates the ATT using cross-sectional OLS on the
first post-treatment period.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">estimate_period_effects</span></code> : Estimates period-specific ATTs via
independent cross-sectional regressions for each post-treatment period.</p></li>
</ul>
<p>Supported variance-covariance estimators include homoskedastic OLS,
heteroskedasticity-robust (HC1, HC3), and cluster-robust standard errors.</p>
<p class="rubric">Notes</p>
<p>The transformation-based approach converts the panel data DiD problem into
a cross-sectional treatment effects problem. Under no anticipation and
parallel trends assumptions, the ATT is identified as the coefficient on
the treatment indicator in OLS regression of the transformed outcome.</p>
<p>For small samples, homoskedastic standard errors with t-distribution
critical values provide exact inference under normality. HC3 standard
errors offer improved finite-sample performance over HC1 when sample sizes
are moderate but asymptotic theory may not apply.</p>
<p>Cluster-robust inference uses G-1 degrees of freedom (where G is the number
of clusters) rather than the residual degrees of freedom, which provides
more conservative inference when the number of clusters is small.</p>
<dl class="py function">
<dt class="sig sig-object py" id="lwdid.estimation.prepare_controls">
<span class="sig-prename descclassname"><span class="pre">lwdid.estimation.</span></span><span class="sig-name descname"><span class="pre">prepare_controls</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ivar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_treated</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_control</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/estimation.html#prepare_controls"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.estimation.prepare_controls" title="Link to this definition"></a></dt>
<dd><p>Construct centered controls and interactions for regression adjustment.</p>
<p>Verifies that sample sizes satisfy N_treated &gt; K+1 and N_control &gt; K+1,
where K is the number of control variables. If conditions are met,
computes the mean of control variables for the treated group, centers
the controls by subtracting these means, and creates interaction terms
between the treatment indicator and the centered controls.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Transformed panel data containing control variables and treatment
indicators.</p></li>
<li><p><strong>d</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the treatment indicator column.</p></li>
<li><p><strong>ivar</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the unit identifier column.</p></li>
<li><p><strong>controls</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>]</em>) – List of control variable names. Must be numeric and time-invariant.</p></li>
<li><p><strong>N_treated</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a>) – Number of treated units in the regression sample.</p></li>
<li><p><strong>N_control</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a>) – Number of control units in the regression sample.</p></li>
<li><p><strong>data_sample</strong> (<em>pd.DataFrame</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Specific sample to use for computing means (e.g., first-post-treatment
cross-section). If None, uses the full <code class="docutils literal notranslate"><span class="pre">data</span></code> filtered by treatment
status.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A dictionary containing:</p>
<ul class="simple">
<li><dl class="simple">
<dt>’include’<span class="classifier">bool</span></dt><dd><p>Whether controls can be included in regression.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’X_centered’<span class="classifier">pd.DataFrame or None</span></dt><dd><p>Centered control variables (X - X_mean_treated).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’interactions’<span class="classifier">pd.DataFrame or None</span></dt><dd><p>Interaction terms (D * X_centered).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’X_mean_treated’<span class="classifier">dict</span></dt><dd><p>Means of controls for the treated group.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’RHS_varnames’<span class="classifier">list of str</span></dt><dd><p>Names of all right-hand side control variables.</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)">dict</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)">str</a>, Any]</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.estimation.estimate_att" title="lwdid.estimation.estimate_att"><code class="xref py py-obj docutils literal notranslate"><span class="pre">estimate_att</span></code></a></dt><dd><p>Uses prepared controls for ATT estimation.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.estimation.estimate_period_effects" title="lwdid.estimation.estimate_period_effects"><code class="xref py py-obj docutils literal notranslate"><span class="pre">estimate_period_effects</span></code></a></dt><dd><p>Uses prepared controls for period-specific ATTs.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>Centering controls at the treated-group mean ensures that the coefficient
on the treatment indicator directly estimates the ATT at the mean covariate
values of the treated group. The regression model is:</p>
<div class="math notranslate nohighlight">
\[\hat{Y}_i = \alpha + \tau D_i + X_i \beta +
D_i (X_i - \bar{X}_1) \delta + U_i\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{X}_1 = N_1^{-1} \sum_{i: D_i=1} X_i\)</span> is the
treated-group mean of covariates.</p>
<p>The sample size conditions (N_treated &gt; K+1 and N_control &gt; K+1) ensure
that both treated and control subsamples have sufficient degrees of
freedom for separate slope estimation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lwdid.estimation.estimate_att">
<span class="sig-prename descclassname"><span class="pre">lwdid.estimation.</span></span><span class="sig-name descname"><span class="pre">estimate_att</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_transformed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ivar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vce</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_filter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/estimation.html#estimate_att"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.estimation.estimate_att" title="Link to this definition"></a></dt>
<dd><p>Estimate Average Treatment Effect on the Treated (ATT) via cross-sectional OLS.</p>
<p>Performs an OLS regression on the specified cross-section (typically the
first post-treatment period) using the transformed outcome variable.
Supports homoskedastic, heteroskedasticity-robust (HC1, HC3), and
cluster-robust standard errors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Transformed panel data containing the dependent variable and
regressors.</p></li>
<li><p><strong>y_transformed</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the transformed dependent variable (e.g., ‘ydot_postavg’).</p></li>
<li><p><strong>d</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the treatment indicator column (typically <code class="docutils literal notranslate"><span class="pre">d_</span></code>).</p></li>
<li><p><strong>ivar</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the unit identifier column.</p></li>
<li><p><strong>controls</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>] </em><em>| </em><em>None</em>) – List of time-invariant control variables. Controls are included only
if sample size conditions (N_1 &gt; K+1 and N_0 &gt; K+1) are met.</p></li>
<li><p><strong>vce</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em> | </em><em>None</em>) – <p>Type of variance-covariance estimator:</p>
<ul>
<li><p>None : Homoskedastic standard errors (OLS).</p></li>
<li><p>’robust’ or ‘hc1’ : Heteroskedasticity-robust (HC1).</p></li>
<li><p>’hc3’ : Heteroskedasticity-robust (HC3), better for small samples.</p></li>
<li><p>’cluster’ : Cluster-robust. Requires <code class="docutils literal notranslate"><span class="pre">cluster_var</span></code>.</p></li>
</ul>
</p></li>
<li><p><strong>cluster_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em> | </em><em>None</em>) – Name of the variable to use for clustering. Required if
<code class="docutils literal notranslate"><span class="pre">vce='cluster'</span></code>.</p></li>
<li><p><strong>sample_filter</strong> (<em>pd.Series</em>) – Boolean mask indicating the regression sample (e.g., first
post-treatment period).</p></li>
<li><p><strong>alpha</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><em>float</em></a><em>, </em><em>default=0.05</em>) – Significance level for confidence intervals (0.05 gives 95% CI).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A dictionary containing estimation results:</p>
<ul class="simple">
<li><dl class="simple">
<dt>’att’<span class="classifier">float</span></dt><dd><p>Estimated ATT.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’se_att’<span class="classifier">float</span></dt><dd><p>Standard error of the ATT.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’t_stat’<span class="classifier">float</span></dt><dd><p>t-statistic for H0: ATT = 0.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’pvalue’<span class="classifier">float</span></dt><dd><p>Two-sided p-value.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’ci_lower’, ‘ci_upper’<span class="classifier">float</span></dt><dd><p>Confidence interval bounds.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’params’<span class="classifier">pd.Series</span></dt><dd><p>All regression coefficients.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’bse’<span class="classifier">pd.Series</span></dt><dd><p>Standard errors of all coefficients.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’vcov’<span class="classifier">pd.DataFrame</span></dt><dd><p>Variance-covariance matrix.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’resid’<span class="classifier">np.ndarray</span></dt><dd><p>Residuals.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’nobs’<span class="classifier">int</span></dt><dd><p>Number of observations.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’df_resid’<span class="classifier">int</span></dt><dd><p>Residual degrees of freedom.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’df_inference’<span class="classifier">int</span></dt><dd><p>Degrees of freedom used for inference.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’vce_type’<span class="classifier">str</span></dt><dd><p>Type of VCE used.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’cluster_var’<span class="classifier">str or None</span></dt><dd><p>Clustering variable if used.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’n_clusters’<span class="classifier">int or None</span></dt><dd><p>Number of clusters if clustered.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’controls_used’<span class="classifier">bool</span></dt><dd><p>Whether controls were included.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’controls’<span class="classifier">list of str</span></dt><dd><p>Controls used in regression.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’controls_spec’<span class="classifier">dict</span></dt><dd><p>Details of control preparation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’n_treated_sample’, ‘n_control_sample’<span class="classifier">int</span></dt><dd><p>Sample sizes by treatment status.</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)">dict</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)">str</a>, Any]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientDataError" title="lwdid.exceptions.InsufficientDataError"><strong>InsufficientDataError</strong></a> – If sample size is less than 3, or if no treated or control units
    exist in the regression sample.</p></li>
<li><p><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidParameterError" title="lwdid.exceptions.InvalidParameterError"><strong>InvalidParameterError</strong></a> – If cluster_var is missing when vce=’cluster’, or if cluster variable
    is not nested within units.</p></li>
<li><p><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidVCETypeError" title="lwdid.exceptions.InvalidVCETypeError"><strong>InvalidVCETypeError</strong></a> – If an unrecognized vce type is specified.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.estimation.prepare_controls" title="lwdid.estimation.prepare_controls"><code class="xref py py-obj docutils literal notranslate"><span class="pre">prepare_controls</span></code></a></dt><dd><p>Prepares centered controls for regression adjustment.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.estimation.estimate_period_effects" title="lwdid.estimation.estimate_period_effects"><code class="xref py py-obj docutils literal notranslate"><span class="pre">estimate_period_effects</span></code></a></dt><dd><p>Estimates period-specific ATTs.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>The ATT is estimated as the coefficient on the treatment indicator D in
the OLS regression:</p>
<div class="math notranslate nohighlight">
\[\hat{Y}_i = \alpha + \tau D_i + X_i \beta +
D_i (X_i - \bar{X}_1) \delta + U_i\]</div>
<p>Confidence intervals use t-distribution critical values:</p>
<div class="math notranslate nohighlight">
\[CI = \hat{\tau} \pm t_{df, 1-\alpha/2} \cdot SE(\hat{\tau})\]</div>
<p>Degrees of freedom selection:</p>
<ul class="simple">
<li><p>For non-clustered standard errors: df = n - k (residual df).</p></li>
<li><p>For cluster-robust standard errors: df = G - 1, where G is the number
of clusters. This provides more conservative inference when the number
of clusters is small.</p></li>
</ul>
<p>Under homoskedasticity and normality, the t-statistic has an exact
t-distribution, enabling valid inference even with small samples. HC3
is recommended over HC1 for moderate sample sizes as it provides better
finite-sample performance.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lwdid.estimation.estimate_period_effects">
<span class="sig-prename descclassname"><span class="pre">lwdid.estimation.</span></span><span class="sig-name descname"><span class="pre">estimate_period_effects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ydot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tindex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpost1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Tmax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controls_spec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vce</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">period_labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/estimation.html#estimate_period_effects"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.estimation.estimate_period_effects" title="Link to this definition"></a></dt>
<dd><p>Estimate period-specific ATTs via independent cross-sectional regressions.</p>
<p>Iterates through post-treatment periods and estimates the treatment effect
for each period using the residualized outcome variable. Each period is
estimated via a separate OLS regression, enabling examination of treatment
effect dynamics over time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Transformed panel data containing the outcome variable.</p></li>
<li><p><strong>ydot</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the residualized outcome variable.</p></li>
<li><p><strong>d</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the treatment indicator column.</p></li>
<li><p><strong>tindex</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Name of the time index column.</p></li>
<li><p><strong>tpost1</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a>) – First post-treatment period index.</p></li>
<li><p><strong>Tmax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a>) – Last period index.</p></li>
<li><p><strong>controls_spec</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>Any</em><em>] </em><em>| </em><em>None</em>) – Control variable specification dictionary returned by
<code class="docutils literal notranslate"><span class="pre">prepare_controls</span></code>. If None or if ‘include’ is False, regression
includes only the treatment indicator.</p></li>
<li><p><strong>vce</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em> | </em><em>None</em>) – Type of variance-covariance estimator. Same options as
<code class="docutils literal notranslate"><span class="pre">estimate_att</span></code>: None (homoskedastic), ‘robust’/’hc1’, ‘hc3’,
or ‘cluster’.</p></li>
<li><p><strong>cluster_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em> | </em><em>None</em>) – Name of the clustering variable. Required if <code class="docutils literal notranslate"><span class="pre">vce='cluster'</span></code>.</p></li>
<li><p><strong>period_labels</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>]</em>) – Mapping from time index to human-readable period labels for output.</p></li>
<li><p><strong>alpha</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><em>float</em></a><em>, </em><em>default=0.05</em>) – Significance level for confidence intervals.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A DataFrame with one row per post-treatment period. Columns:</p>
<ul class="simple">
<li><dl class="simple">
<dt>’period’<span class="classifier">str</span></dt><dd><p>Human-readable period label.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’tindex’<span class="classifier">int</span></dt><dd><p>Time index value.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’beta’<span class="classifier">float</span></dt><dd><p>Estimated ATT for the period.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’se’<span class="classifier">float</span></dt><dd><p>Standard error.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’ci_lower’, ‘ci_upper’<span class="classifier">float</span></dt><dd><p>Confidence interval bounds.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’tstat’<span class="classifier">float</span></dt><dd><p>t-statistic for H0: ATT = 0.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’pval’<span class="classifier">float</span></dt><dd><p>Two-sided p-value.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>’N’<span class="classifier">int</span></dt><dd><p>Number of observations in the period.</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.estimation.estimate_att" title="lwdid.estimation.estimate_att"><code class="xref py py-obj docutils literal notranslate"><span class="pre">estimate_att</span></code></a></dt><dd><p>Estimates average ATT across post-treatment periods.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.estimation.prepare_controls" title="lwdid.estimation.prepare_controls"><code class="xref py py-obj docutils literal notranslate"><span class="pre">prepare_controls</span></code></a></dt><dd><p>Prepares control specification for regression.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>Each period is estimated independently via cross-sectional OLS:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = \alpha_t + \tau_t D_i + X_i \beta_t +
D_i (X_i - \bar{X}_1) \delta_t + U_{it}\]</div>
<p>where <span class="math notranslate nohighlight">\(\dot{Y}_{it}\)</span> is the transformed outcome and
<span class="math notranslate nohighlight">\(\tau_t\)</span> is the period-specific ATT.</p>
<p>The estimators are consistent under no anticipation and parallel trends.
Period-specific estimates allow examination of treatment effect dynamics,
which is useful for detecting delayed effects or effect decay over time.</p>
<p>Periods with insufficient variation in the treatment indicator (all
treated or all control) produce NaN estimates with a warning. This can
occur due to panel attrition or unbalanced designs.</p>
</dd></dl>

<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This module provides two main estimation functions:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">estimate_att</span></code>: Estimates the average treatment effect on the treated (ATT)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">estimate_period_effects</span></code>: Estimates period-specific treatment effects</p></li>
</ol>
<p>Both functions run OLS regressions on transformed data and compute standard
errors using various variance estimators.</p>
</section>
<section id="estimation-functions">
<h2>Estimation Functions<a class="headerlink" href="#estimation-functions" title="Link to this heading"></a></h2>
<section id="estimate-att">
<h3>estimate_att()<a class="headerlink" href="#estimate-att" title="Link to this heading"></a></h3>
<p><strong>Purpose:</strong> Estimate the overall average treatment effect on the treated (ATT)
from the cross-sectional representation of the Lee and Wooldridge
estimator.</p>
<p><strong>Regression specification (conceptual):</strong></p>
<div class="math notranslate nohighlight">
\[Y_i = \alpha + \tau D_i + Z_i'\beta + \varepsilon_i\]</div>
<p>where:</p>
<ul class="simple">
<li><p>y_i: Transformed outcome for unit i (typically the post-treatment
average of the residualized outcome constructed by the transformation
module)</p></li>
<li><p>D_i: Treatment indicator (1 = treated, 0 = control)</p></li>
<li><p>Z_i: Optional time-invariant controls and their interactions constructed
following Lee and Wooldridge (2026, Section 2.2)</p></li>
<li><p>ε_i: Regression error term</p></li>
</ul>
<p><strong>Estimand:</strong> <span class="math notranslate nohighlight">\(\tau\)</span> is the ATT.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ATT estimate</p></li>
<li><p>Standard error</p></li>
<li><p>t-statistic</p></li>
<li><p>p-value</p></li>
<li><p>Confidence interval</p></li>
<li><p>Degrees of freedom</p></li>
</ul>
</section>
<section id="estimate-period-effects">
<h3>estimate_period_effects()<a class="headerlink" href="#estimate-period-effects" title="Link to this heading"></a></h3>
<p><strong>Purpose:</strong> Estimate treatment effects separately for each post-treatment
period using cross-sectional regressions.</p>
<p><strong>Regression specification (for each post-treatment period t):</strong></p>
<div class="math notranslate nohighlight">
\[Y_{it} = \alpha_t + \tau_t D_i + Z_i'\beta_t + \varepsilon_{it}\]</div>
<p>where:</p>
<ul class="simple">
<li><p>y_it: Transformed outcome for unit i in period t</p></li>
<li><p>D_i: Treatment indicator (1 = treated, 0 = control)</p></li>
<li><p>Z_i: Optional time-invariant controls (and their interactions) re-used
from the main regression</p></li>
<li><p><span class="math notranslate nohighlight">\(\tau_t\)</span>: Treatment effect in period <span class="math notranslate nohighlight">\(t\)</span> (period-specific ATT)</p></li>
</ul>
<p><strong>Returns:</strong> DataFrame with period-specific estimates, standard errors,
t-statistics, p-values, and confidence intervals.</p>
</section>
</section>
<section id="variance-estimators">
<h2>Variance Estimators<a class="headerlink" href="#variance-estimators" title="Link to this heading"></a></h2>
<p>The module supports multiple variance estimators for different assumptions
about the error structure.</p>
<section id="ols-homoskedastic">
<h3>OLS (Homoskedastic)<a class="headerlink" href="#ols-homoskedastic" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors are homoskedastic and normally distributed.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = \hat{\sigma}^2 (X'X)^{-1}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\sigma}^2 = RSS / (n - k)\)</span>.</p>
<p><strong>Degrees of freedom:</strong></p>
<ul class="simple">
<li><p>Non-clustered: <span class="math notranslate nohighlight">\(df = n - k\)</span></p></li>
</ul>
<p><strong>When to use:</strong> When homoskedasticity and normality are plausible and exact
t-based inference is desired.</p>
</section>
<section id="hc0-white-s-original-estimator">
<h3>HC0 (White’s Original Estimator)<a class="headerlink" href="#hc0-white-s-original-estimator" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors may be heteroskedastic.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = (X'X)^{-1} \left(\sum_i x_i x_i' \hat{\varepsilon}_i^2\right) (X'X)^{-1}\]</div>
<p><strong>Degrees of freedom:</strong> Same as OLS.</p>
<p><strong>When to use:</strong> Large samples with suspected heteroskedasticity. This is the
original White (1980) heteroskedasticity-consistent estimator without
finite-sample corrections. Tends to underestimate standard errors in small
samples.</p>
</section>
<section id="hc1-heteroskedasticity-robust">
<h3>HC1 (Heteroskedasticity-Robust)<a class="headerlink" href="#hc1-heteroskedasticity-robust" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors may be heteroskedastic.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = (X'X)^{-1} \left(\sum_i x_i x_i' \hat{\varepsilon}_i^2\right) (X'X)^{-1} \times \frac{n}{n-k}\]</div>
<p><strong>Degrees of freedom:</strong> Same as OLS.</p>
<p><strong>When to use:</strong> Medium to large samples with suspected heteroskedasticity.
HC1 applies a degrees-of-freedom correction to HC0.</p>
</section>
<section id="hc2-leverage-adjusted">
<h3>HC2 (Leverage-Adjusted)<a class="headerlink" href="#hc2-leverage-adjusted" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors may be heteroskedastic.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = (X'X)^{-1} \left(\sum_i \frac{x_i x_i' \hat{\varepsilon}_i^2}{1-h_{ii}}\right) (X'X)^{-1}\]</div>
<p>where <span class="math notranslate nohighlight">\(h_{ii}\)</span> is the i-th diagonal element of the hat matrix
<span class="math notranslate nohighlight">\(H = X(X'X)^{-1}X'\)</span>.</p>
<p><strong>Degrees of freedom:</strong> Same as OLS.</p>
<p><strong>When to use:</strong> Small to moderate samples with suspected heteroskedasticity
and varying leverage across observations.</p>
</section>
<section id="hc3-small-sample-adjusted">
<h3>HC3 (Small-Sample Adjusted)<a class="headerlink" href="#hc3-small-sample-adjusted" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors may be heteroskedastic.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = (X'X)^{-1} \left(\sum_i \frac{x_i x_i' \hat{\varepsilon}_i^2}{(1-h_{ii})^2}\right) (X'X)^{-1}\]</div>
<p>where <span class="math notranslate nohighlight">\(h_{ii}\)</span> is the i-th diagonal element of the hat matrix.</p>
<p><strong>Degrees of freedom:</strong> Same as OLS.</p>
<p><strong>When to use:</strong> Small or moderate samples with suspected heteroskedasticity.
Simulation evidence suggests HC3 can perform reasonably well in some
small-sample designs, but results can still be sensitive when the number of
treated or control units is very small. See <a class="reference internal" href="../methodological_notes.html"><span class="doc">Methodological Notes</span></a>
for further discussion.</p>
</section>
<section id="hc4-high-leverage-adjusted">
<h3>HC4 (High-Leverage Adjusted)<a class="headerlink" href="#hc4-high-leverage-adjusted" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors may be heteroskedastic.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = (X'X)^{-1} \left(\sum_i \frac{x_i x_i' \hat{\varepsilon}_i^2}{(1-h_{ii})^{\delta_i}}\right) (X'X)^{-1}\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta_i = \min(4, n h_{ii}/\sum_j h_{jj})\)</span> is an adaptive exponent
based on leverage.</p>
<p><strong>Degrees of freedom:</strong> Same as OLS.</p>
<p><strong>When to use:</strong> When data contains high-leverage observations. HC4 provides
adaptive adjustment that increases for observations with high leverage.</p>
</section>
<section id="variance-estimator-selection-guide">
<h3>Variance Estimator Selection Guide<a class="headerlink" href="#variance-estimator-selection-guide" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>OLS</strong>: Sample size: Any. Assumes homoskedasticity and normality. Use for
exact t-inference under CLM assumptions.</p></li>
<li><p><strong>HC0</strong>: Sample size: Large (N &gt; 100). Assumes heteroskedasticity. Use for
large samples only; understates SE in small samples.</p></li>
<li><p><strong>HC1</strong>: Sample size: Moderate-Large (N &gt; 50). Assumes heteroskedasticity.
General robust SE; df-corrected HC0.</p></li>
<li><p><strong>HC2</strong>: Sample size: Small-Moderate (N = 20-100). Assumes heteroskedasticity
with varying leverage. Use when leverage varies across observations.</p></li>
<li><p><strong>HC3</strong>: Sample size: Small-Moderate (N = 10-50). Assumes heteroskedasticity.
Default for small samples with suspected heteroskedasticity.</p></li>
<li><p><strong>HC4</strong>: Sample size: Any. Assumes heteroskedasticity with influential points.
Use when high-leverage points are present in data.</p></li>
<li><p><strong>Cluster</strong>: Sample size: G &gt; 30 clusters. Assumes within-cluster correlation.
Use for clustered data (states, schools).</p></li>
</ul>
<p><strong>Selection guidelines:</strong></p>
<ol class="arabic simple">
<li><p><strong>CLM assumptions plausible + exact inference needed</strong>: Use OLS (<code class="docutils literal notranslate"><span class="pre">vce=None</span></code>)</p></li>
<li><p><strong>Heteroskedasticity suspected + small sample</strong>: Use HC3 (<code class="docutils literal notranslate"><span class="pre">vce='hc3'</span></code>)</p></li>
<li><p><strong>Heteroskedasticity suspected + moderate/large sample</strong>: Use HC1 (<code class="docutils literal notranslate"><span class="pre">vce='hc1'</span></code>)</p></li>
<li><p><strong>High-leverage observations present</strong>: Use HC4 (<code class="docutils literal notranslate"><span class="pre">vce='hc4'</span></code>)</p></li>
<li><p><strong>Clustered errors</strong>: Use cluster-robust (<code class="docutils literal notranslate"><span class="pre">vce='cluster'</span></code>)</p></li>
</ol>
</section>
<section id="cluster-robust">
<h3>Cluster-Robust<a class="headerlink" href="#cluster-robust" title="Link to this heading"></a></h3>
<p><strong>Assumption:</strong> Errors are correlated within clusters but independent across
clusters.</p>
<p><strong>Formula:</strong></p>
<div class="math notranslate nohighlight">
\[\text{Var}(\hat{\beta}) = (X'X)^{-1} \left(\sum_g X_g' \hat{\varepsilon}_g \hat{\varepsilon}_g' X_g\right) (X'X)^{-1}\]</div>
<p>where <span class="math notranslate nohighlight">\(g\)</span> indexes clusters.</p>
<p><strong>Degrees of freedom:</strong> G - 1 (number of clusters minus 1).</p>
<p><strong>When to use:</strong> Errors are clustered (e.g., students within schools).</p>
</section>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading"></a></h2>
<section id="regression-procedure">
<h3>Regression Procedure<a class="headerlink" href="#regression-procedure" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Prepare design matrix:</strong> For the main regression, construct a
cross-sectional design matrix with an intercept, the treatment
indicator, and (when applicable) time-invariant controls and their
interactions with treatment as in Lee and Wooldridge (2026, Section 2.2).
The same control specification is reused for period-by-period
regressions.</p></li>
<li><p><strong>Run OLS:</strong> Compute <span class="math notranslate nohighlight">\(\hat{\beta} = (X'X)^{-1} X'y\)</span></p></li>
<li><p><strong>Compute residuals:</strong> <span class="math notranslate nohighlight">\(\hat{\varepsilon} = y - X\hat{\beta}\)</span></p></li>
<li><p><strong>Compute variance:</strong> Use appropriate variance estimator</p></li>
<li><p><strong>Inference:</strong> Compute t-statistics and p-values using t-distribution</p></li>
</ol>
</section>
<section id="degrees-of-freedom">
<h3>Degrees of Freedom<a class="headerlink" href="#degrees-of-freedom" title="Link to this heading"></a></h3>
<p><strong>Non-clustered:</strong></p>
<p>df = n - k</p>
<p>where:</p>
<ul class="simple">
<li><p>n: Number of observations</p></li>
<li><p>k: Number of parameters (intercept + regressors)</p></li>
</ul>
<p><strong>Clustered:</strong></p>
<p>df = G - 1</p>
<p>where G is the number of clusters.</p>
<p><strong>Rationale:</strong> With cluster-robust SEs, the effective sample size is the
number of clusters, not observations.</p>
</section>
<section id="confidence-intervals">
<h3>Confidence Intervals<a class="headerlink" href="#confidence-intervals" title="Link to this heading"></a></h3>
<p>95% confidence intervals are computed as:</p>
<div class="math notranslate nohighlight">
\[CI = \hat{\beta} \pm t_{\alpha/2, df} \times SE(\hat{\beta})\]</div>
<p>where <span class="math notranslate nohighlight">\(t_{\alpha/2, df}\)</span> is the critical value from the t-distribution
with <span class="math notranslate nohighlight">\(df\)</span> degrees of freedom.</p>
</section>
</section>
<section id="technical-notes">
<h2>Technical Notes<a class="headerlink" href="#technical-notes" title="Link to this heading"></a></h2>
<section id="numerical-stability">
<h3>Numerical Stability<a class="headerlink" href="#numerical-stability" title="Link to this heading"></a></h3>
<p>The module relies on the numerically stable OLS implementation in <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>:</p>
<ul class="simple">
<li><p>OLS estimation and variance–covariance computation are delegated to <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code></p></li>
<li><p>Robust variance estimators with small-sample adjustments (HC0-HC4)</p></li>
<li><p>Singular or ill-conditioned designs raise errors or warnings rather than failing silently</p></li>
</ul>
</section>
<section id="missing-data">
<h3>Missing Data<a class="headerlink" href="#missing-data" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Observations with missing values in required variables (outcome,
treatment indicator, unit identifier, time variables, post indicator)
are dropped during validation.</p></li>
<li><p>For control variables, missing values are handled at the estimation
stage: if dropping observations with missing controls still leaves
enough treated and control units to satisfy the <span class="math notranslate nohighlight">\(N_1 &gt; K+1\)</span> and
<span class="math notranslate nohighlight">\(N_0 &gt; K+1\)</span> conditions, those observations are removed and controls
are included; otherwise, controls are omitted and the full regression
sample is retained. In both cases, informative warnings are issued.</p></li>
<li><p>The effective sample size (n) reported in the results corresponds to
the cross-sectional regression sample used for ATT estimation (the
<code class="docutils literal notranslate"><span class="pre">firstpost</span></code> cross-section).</p></li>
</ul>
</section>
<section id="perfect-collinearity">
<h3>Perfect Collinearity<a class="headerlink" href="#perfect-collinearity" title="Link to this heading"></a></h3>
<p>Regressors must not be perfectly collinear for the OLS problem to be
identified. Common sources of exact collinearity include:</p>
<ul class="simple">
<li><p>Including both a variable and its exact linear transformation</p></li>
<li><p>Including dummy variables for all categories (no omitted category)</p></li>
<li><p>Including controls that are exact linear combinations of other regressors</p></li>
</ul>
</section>
</section>
<section id="example-usage">
<h2>Example Usage<a class="headerlink" href="#example-usage" title="Link to this heading"></a></h2>
<p>These functions are used internally by <a class="reference internal" href="core.html#lwdid.lwdid" title="lwdid.lwdid"><code class="xref py py-func docutils literal notranslate"><span class="pre">lwdid.lwdid()</span></code></a> after the
transformation step has constructed the transformed outcomes and main
regression sample. They are not part of the typical user-facing API. For
most applications, you should call <a class="reference internal" href="core.html#lwdid.lwdid" title="lwdid.lwdid"><code class="xref py py-func docutils literal notranslate"><span class="pre">lwdid.lwdid()</span></code></a> directly and rely on
its high-level interface. Advanced users who need low-level access can
consult the docstrings and source code in <a class="reference internal" href="#module-lwdid.estimation" title="lwdid.estimation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lwdid.estimation</span></code></a> to see the
exact function signatures and required inputs.</p>
</section>
<section id="large-sample-inference">
<h2>Large-Sample Inference<a class="headerlink" href="#large-sample-inference" title="Link to this heading"></a></h2>
<p>For large cross-sectional samples, asymptotic inference using robust standard
errors is appropriate:</p>
<p><strong>HC0-HC4 Standard Errors</strong></p>
<ul class="simple">
<li><p>HC1 provides heteroskedasticity-consistent standard errors with a degrees-of-
freedom correction (n/(n-k))</p></li>
<li><p>HC3 adds leverage-based adjustments suitable for smaller samples</p></li>
</ul>
<p><strong>Cluster-Robust Standard Errors</strong></p>
<p>When errors are correlated within clusters (e.g., states, regions), cluster-
robust standard errors account for this correlation. Inference relies on
asymptotic approximations that improve with the number of clusters G.</p>
<p><strong>Variance Estimator Recommendation</strong></p>
<ul class="simple">
<li><p>Small samples with CLM assumptions: Use <code class="docutils literal notranslate"><span class="pre">vce=None</span></code> for exact t-based inference</p></li>
<li><p>Small to moderate samples with heteroskedasticity: Use <code class="docutils literal notranslate"><span class="pre">vce='hc3'</span></code></p></li>
<li><p>Moderate to large samples: Use <code class="docutils literal notranslate"><span class="pre">vce='hc1'</span></code> or <code class="docutils literal notranslate"><span class="pre">vce='robust'</span></code></p></li>
<li><p>Clustered data with many clusters: Use <code class="docutils literal notranslate"><span class="pre">vce='cluster'</span></code></p></li>
</ul>
</section>
<section id="estimator-selection-for-large-samples">
<h2>Estimator Selection for Large Samples<a class="headerlink" href="#estimator-selection-for-large-samples" title="Link to this heading"></a></h2>
<p>Lee and Wooldridge (2025) establishes theoretical and simulation evidence for
choosing among estimators when sample sizes are large enough for asymptotic
inference. The key results from the Monte Carlo simulations (Sections 7.1-7.2)
inform the following recommendations.</p>
<p><strong>Available Estimators</strong></p>
<ul class="simple">
<li><p><strong>RA (Regression Adjustment)</strong>: Default estimator. Under correct specification
of the outcome model, RA is both best linear unbiased (BLUE) and asymptotically
efficient. Equivalent to POLS/ETWFE in the common timing case.</p></li>
<li><p><strong>IPW (Inverse Probability Weighting)</strong>: Consistent when the propensity score
model is correctly specified. May be less efficient than RA under correct
outcome model specification.</p></li>
<li><p><strong>IPWRA (Doubly Robust)</strong>: Combines regression adjustment with propensity score
weighting. Consistent if either the outcome model or propensity score model is
correctly specified (double robustness property).</p></li>
</ul>
<p><strong>Doubly Robust ATT Estimator (Mathematical Formulation)</strong></p>
<p>The influence function representation of the doubly robust ATT estimator is:</p>
<div class="math notranslate nohighlight">
\[\psi_i^{DR} = \frac{D_i}{\pi} \left[ Y_i - m_0(X_i) \right]
- \frac{(1-D_i) p(X_i)}{\pi (1-p(X_i))} \left[ Y_i - m_0(X_i) \right]
- \tau_{ATT}\]</div>
<p>where <span class="math notranslate nohighlight">\(\pi = P(D=1)\)</span> is the unconditional treatment probability,
<span class="math notranslate nohighlight">\(p(X_i) = P(D=1|X_i)\)</span> is the propensity score, and
<span class="math notranslate nohighlight">\(m_0(X_i) = E[Y|D=0, X_i]\)</span> is the conditional mean for controls.</p>
<p><strong>Double robustness property</strong>:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(m_0(X)\)</span> is correctly specified: ATT is identified via regression
adjustment regardless of propensity score specification</p></li>
<li><p>If <span class="math notranslate nohighlight">\(p(X)\)</span> is correctly specified: IPW component corrects for outcome
model misspecification</p></li>
<li><p>Both correct: achieves semiparametric efficiency bound</p></li>
<li><p><strong>PSM (Propensity Score Matching)</strong>: Matches treated to control units based on
estimated propensity scores. Generally less efficient than RA and IPWRA.</p></li>
</ul>
<p><strong>Efficiency Comparison</strong> (from Lee and Wooldridge (2025), Tables 7.2-7.10)</p>
<p>Under correct specification of all models:</p>
<ol class="arabic simple">
<li><p>RA/POLS has the smallest standard deviation and RMSE</p></li>
<li><p>IPWRA performs close to RA (within 3-5% higher SD in most scenarios)</p></li>
<li><p>PSM and CS(2021) have notably larger standard deviations (25-40% higher)</p></li>
</ol>
<p>Under model misspecification:</p>
<ol class="arabic simple">
<li><p>When outcome model is misspecified but propensity score is correct:
IPWRA has smallest RMSE due to its double robustness</p></li>
<li><p>When both models are misspecified: IPWRA still tends to have smaller
bias than RA while maintaining reasonable precision</p></li>
</ol>
<p><strong>Estimator Selection Guidelines</strong></p>
<ol class="arabic simple">
<li><p><strong>Start with RA</strong> when N is moderate and functional form assumptions are
plausible. RA is efficient and computationally simple.</p></li>
<li><p><strong>Use IPWRA</strong> as primary estimator when:</p>
<ul class="simple">
<li><p>Functional form assumptions are uncertain</p></li>
<li><p>Robustness to model misspecification is desired</p></li>
<li><p>Controls are available for both outcome and propensity score models</p></li>
</ul>
</li>
<li><p><strong>Use IPW/PSM</strong> when:</p>
<ul class="simple">
<li><p>Propensity score weighting or matching is preferred for substantive reasons</p></li>
<li><p>Comparison with other treatment effects literature is desired</p></li>
</ul>
</li>
<li><p><strong>Report multiple estimators</strong> for robustness: If RA and IPWRA give similar
results, this provides evidence that findings are not sensitive to functional
form assumptions.</p></li>
</ol>
<p><strong>Relationship to Callaway and Sant’Anna (2021)</strong></p>
<p>The long-differencing approach of Callaway and Sant’Anna (2021) uses only the
period just prior to intervention, discarding information from earlier
pre-treatment periods. Lee and Wooldridge (2025) shows that this can result in
substantial efficiency loss. The rolling transformation approach uses all
suitable pre-treatment periods, achieving efficiency close to POLS while
permitting application of doubly robust estimators.</p>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="core.html#lwdid.lwdid" title="lwdid.lwdid"><code class="xref py py-func docutils literal notranslate"><span class="pre">lwdid.lwdid()</span></code></a> - Main function that calls these estimation functions</p></li>
<li><p><a class="reference internal" href="transformations.html"><span class="doc">Transformations Module</span></a> - Transformation functions applied before estimation</p></li>
<li><p><a class="reference internal" href="../methodological_notes.html"><span class="doc">Methodological Notes</span></a> - Theoretical background on inference</p></li>
<li><p><a class="reference internal" href="../user_guide.html"><span class="doc">User Guide</span></a> - Comprehensive usage guide</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="transformations.html" class="btn btn-neutral float-left" title="Transformations Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="validation.html" class="btn btn-neutral float-right" title="Validation Module (validation)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Xuanyu Cai, Wenli Xu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>