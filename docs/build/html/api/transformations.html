

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transformations Module &mdash; lwdid 0.2.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Estimation Module (estimation)" href="estimation.html" />
    <link rel="prev" title="Staggered DiD Module (staggered)" href="staggered.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            lwdid
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#system-requirements">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation-methods">Installation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#install-via-pip-recommended">Install via pip (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#install-from-source">Install from Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#common-issues">Common Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#numpy-version-conflicts">numpy Version Conflicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#statsmodels-installation-failure">statsmodels Installation Failure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#basic-example">Basic Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#simplest-usage">Simplest Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#key-parameters">Key Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#required-parameters">Required Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#common-options">Common Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#small-sample-exact-inference">Small-Sample Exact Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#large-sample-inference">Large-Sample Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#doubly-robust-estimation">Doubly Robust Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#randomization-inference">Randomization Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#adding-control-variables">Adding Control Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#quarterly-data">Quarterly Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#results-object">Results Object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#core-attributes">Core Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#sample-information">Sample Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#period-specific-effects">Period-Specific Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#methods">Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#data-format-requirements">Data Format Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#panel-data-structure">Panel Data Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#key-requirements">Key Requirements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#staggered-adoption">Staggered Adoption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#staggered-results">Staggered Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html#key-staggered-parameters">Key Staggered Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#scenario-selection-guide">Scenario Selection Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#quick-reference">Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#transformation-methods">Transformation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#demean-standard-did-with-unit-fixed-effects">demean: Standard DiD with Unit Fixed Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#detrend-did-with-unit-specific-linear-trends">detrend: DiD with Unit-Specific Linear Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#demeanq-seasonal-data-with-seasonal-fixed-effects">demeanq: Seasonal Data with Seasonal Fixed Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#detrendq-seasonal-data-with-trends-and-seasonal-effects">detrendq: Seasonal Data with Trends and Seasonal Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#variance-estimation">Variance Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#ols-homoskedastic">OLS (Homoskedastic)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc0-white-s-heteroskedasticity-consistent">HC0 (White’s Heteroskedasticity-Consistent)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc1-heteroskedasticity-robust">HC1 (Heteroskedasticity-Robust)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc2-leverage-adjusted">HC2 (Leverage-Adjusted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc3-small-sample-adjusted-robust">HC3 (Small-Sample Adjusted Robust)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#hc4-high-leverage-adjusted">HC4 (High-Leverage Adjusted)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#cluster-robust">Cluster-Robust</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#randomization-inference">Randomization Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#ri-methods">RI Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#accessing-ri-results">Accessing RI Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#control-variables">Control Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#id1">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#effect-on-inference">Effect on Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#working-with-results">Working with Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#core-estimates">Core Estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#period-specific-effects">Period-Specific Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#sample-information">Sample Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#export-results">Export Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#print-summary">Print Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#data-requirements-and-validation">Data Requirements and Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#panel-structure">Panel Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#treatment-structure">Treatment Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#treatment-indicator">Treatment Indicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#missing-data">Missing Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#never-treated-unit-data-preparation">Never-Treated Unit Data Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#valid-never-treated-encodings">Valid Never-Treated Encodings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#converting-from-stata-data">Converting from Stata Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#checking-never-treated-status">Checking Never-Treated Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#common-issues-and-solutions">Common Issues and Solutions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#choosing-transformation-method">Choosing Transformation Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#choosing-variance-estimator">Choosing Variance Estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#sample-size-considerations">Sample Size Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#sample-size-and-inference-method-selection-matrix">Sample Size and Inference Method Selection Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#estimator-selection-large-sample-common-timing">Estimator Selection (Large-Sample Common Timing)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#diagnostic-checks">Diagnostic Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#common-errors">Common Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#performance-tips">Performance Tips</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#staggered-adoption-design">Staggered Adoption Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#id2">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#staggered-specific-parameters">Staggered-Specific Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#robustness-to-no-anticipation-violations">Robustness to No-Anticipation Violations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#accessing-staggered-results">Accessing Staggered Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#control-group-strategies">Control Group Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#estimator-selection">Estimator Selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#staggered-example">Staggered Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#pre-treatment-dynamics-and-parallel-trends-testing">Pre-treatment Dynamics and Parallel Trends Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#why-pre-treatment-dynamics-matter">Why Pre-treatment Dynamics Matter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#id3">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#accessing-pre-treatment-results">Accessing Pre-treatment Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#interpreting-the-parallel-trends-test">Interpreting the Parallel Trends Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#event-study-visualization-with-pre-treatment">Event Study Visualization with Pre-treatment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#complete-workflow-example">Complete Workflow Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#transformation-methods-for-pre-treatment">Transformation Methods for Pre-treatment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#basic-did-estimation">Basic DiD Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#california-smoking-restriction">California Smoking Restriction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#robustness-checks">Robustness Checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#quarterly-data">Quarterly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#retail-sales-with-seasonal-patterns">Retail Sales with Seasonal Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#monthly-data">Monthly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#monthly-sales-with-seasonal-adjustment-q-12">Monthly Sales with Seasonal Adjustment (Q=12)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#weekly-data">Weekly Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#weekly-sales-with-seasonal-adjustment-q-52">Weekly Sales with Seasonal Adjustment (Q=52)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#control-variables">Control Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#including-baseline-characteristics">Including Baseline Characteristics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#cluster-robust-inference">Cluster-Robust Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#multi-level-data-structure">Multi-Level Data Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#randomization-inference">Randomization Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#non-parametric-testing">Non-Parametric Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#comparing-ri-methods">Comparing RI Methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#diagnostic-checks">Diagnostic Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#testing-parallel-trends">Testing Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#sensitivity-analysis">Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#export-and-reporting">Export and Reporting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#creating-publication-tables">Creating Publication Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#staggered-did-castle-law">Staggered DiD: Castle Law</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#castle-doctrine-analysis">Castle Doctrine Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#complete-workflow-example">Complete Workflow Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/index.html#end-to-end-analysis">End-to-End Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#core-modules">Core Modules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="core.html">Core Module (core)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="core.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="results.html">Results Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="results.html#attributes-reference">Attributes Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#methods-reference">Methods Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#usage-by-design-type">Usage by Design Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#lwdidresults-class">LWDIDResults Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="results.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sensitivity.html">Sensitivity Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sensitivity.html#main-functions">Main Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensitivity.html#result-classes">Result Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensitivity.html#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensitivity.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensitivity.html#interpreting-results">Interpreting Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="sensitivity.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="staggered.html">Staggered DiD Module (staggered)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#key-concepts">Key Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#transformations">Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#control-groups">Control Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#estimation">Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#aggregation">Aggregation</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#ipw-estimator">IPW Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#ipwra-estimator">IPWRA Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#psm-estimator">PSM Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#inference-distribution-by-estimator">Inference Distribution by Estimator</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#randomization-inference">Randomization Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#pre-treatment-dynamics">Pre-treatment Dynamics</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="staggered.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Transformations Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#available-transformations">Available Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Available Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unit-level-functions">Unit-Level Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-functions">Internal Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transformation-selection-guide">Transformation Selection Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="#staggered-adoption-transformations">Staggered Adoption Transformations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="estimation.html">Estimation Module (estimation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#lwdid.estimation.prepare_controls"><code class="docutils literal notranslate"><span class="pre">prepare_controls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#lwdid.estimation.estimate_att"><code class="docutils literal notranslate"><span class="pre">estimate_att()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#lwdid.estimation.estimate_period_effects"><code class="docutils literal notranslate"><span class="pre">estimate_period_effects()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#estimation-functions">Estimation Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#variance-estimators">Variance Estimators</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#implementation-details">Implementation Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#technical-notes">Technical Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#large-sample-inference">Large-Sample Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#estimator-selection-for-large-samples">Estimator Selection for Large Samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="estimation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Validation Module (validation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_and_prepare_data"><code class="docutils literal notranslate"><span class="pre">validate_and_prepare_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_season_diversity"><code class="docutils literal notranslate"><span class="pre">validate_season_diversity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_season_coverage"><code class="docutils literal notranslate"><span class="pre">validate_season_coverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_quarter_diversity"><code class="docutils literal notranslate"><span class="pre">validate_quarter_diversity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_quarter_coverage"><code class="docutils literal notranslate"><span class="pre">validate_quarter_coverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.get_cohort_mask"><code class="docutils literal notranslate"><span class="pre">get_cohort_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.is_never_treated"><code class="docutils literal notranslate"><span class="pre">is_never_treated()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.validate_staggered_data"><code class="docutils literal notranslate"><span class="pre">validate_staggered_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#lwdid.validation.detect_frequency"><code class="docutils literal notranslate"><span class="pre">detect_frequency()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#validation-checks">Validation Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#validation-functions">Validation Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#never-treated-unit-identification">Never-Treated Unit Identification</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#staggered-adoption-validation">Staggered Adoption Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#common-validation-errors-and-solutions">Common Validation Errors and Solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="validation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="randomization.html">Randomization Inference Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#main-function">Main Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#resampling-methods">Resampling Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#returns">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#example-usage">Example Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#methodological-notes">Methodological Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="randomization.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html">Visualization Module (visualization)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#lwdid.visualization.prepare_plot_data"><code class="docutils literal notranslate"><span class="pre">prepare_plot_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#lwdid.visualization.plot_results"><code class="docutils literal notranslate"><span class="pre">plot_results()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#plot-components">Plot Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#advanced-customization">Advanced Customization</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#staggered-adoption-visualization">Staggered Adoption Visualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#exporting-plots">Exporting Plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#plot-parameters-reference">Plot Parameters Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#examples-gallery">Examples Gallery</a></li>
<li class="toctree-l4"><a class="reference internal" href="visualization.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html">Exceptions Module (exceptions)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.LWDIDError"><code class="docutils literal notranslate"><span class="pre">LWDIDError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidParameterError"><code class="docutils literal notranslate"><span class="pre">InvalidParameterError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidRollingMethodError"><code class="docutils literal notranslate"><span class="pre">InvalidRollingMethodError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidVCETypeError"><code class="docutils literal notranslate"><span class="pre">InvalidVCETypeError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.UnbalancedPanelError"><code class="docutils literal notranslate"><span class="pre">UnbalancedPanelError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientDataError"><code class="docutils literal notranslate"><span class="pre">InsufficientDataError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.NoTreatedUnitsError"><code class="docutils literal notranslate"><span class="pre">NoTreatedUnitsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.NoControlUnitsError"><code class="docutils literal notranslate"><span class="pre">NoControlUnitsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientPrePeriodsError"><code class="docutils literal notranslate"><span class="pre">InsufficientPrePeriodsError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientQuarterDiversityError"><code class="docutils literal notranslate"><span class="pre">InsufficientQuarterDiversityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.TimeDiscontinuityError"><code class="docutils literal notranslate"><span class="pre">TimeDiscontinuityError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.MissingRequiredColumnError"><code class="docutils literal notranslate"><span class="pre">MissingRequiredColumnError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.RandomizationError"><code class="docutils literal notranslate"><span class="pre">RandomizationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.VisualizationError"><code class="docutils literal notranslate"><span class="pre">VisualizationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidStaggeredDataError"><code class="docutils literal notranslate"><span class="pre">InvalidStaggeredDataError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.NoNeverTreatedError"><code class="docutils literal notranslate"><span class="pre">NoNeverTreatedError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.AggregationError"><code class="docutils literal notranslate"><span class="pre">AggregationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InvalidAggregationError"><code class="docutils literal notranslate"><span class="pre">InvalidAggregationError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientCellSizeError"><code class="docutils literal notranslate"><span class="pre">InsufficientCellSizeError</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-classes">Exception Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-handling-best-practices">Error Handling Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#common-error-scenarios">Common Error Scenarios</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quick-index">Quick Index</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methodological_notes.html">Methodological Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#the-panel-to-cross-section-transformation">The Panel-to-Cross-Section Transformation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#core-principle">Core Principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#demean-transformation-procedure-2-1">Demean Transformation (Procedure 2.1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#detrend-transformation-procedure-3-1">Detrend Transformation (Procedure 3.1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#seasonal-transformations-demeanq-detrendq">Seasonal Transformations (demeanq/detrendq)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#inference-under-clm-assumptions">Inference Under CLM Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#classical-linear-model-assumptions">Classical Linear Model Assumptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#degrees-of-freedom">Degrees of Freedom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#period-specific-effects">Period-Specific Effects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#robust-inference">Robust Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#heteroskedasticity-robust-standard-errors">Heteroskedasticity-Robust Standard Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#cluster-robust-standard-errors">Cluster-Robust Standard Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#randomization-inference">Randomization Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#clustering-at-higher-levels">Clustering at Higher Levels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#when-to-cluster-at-higher-levels">When to Cluster at Higher Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#minimum-cluster-requirements">Minimum Cluster Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#id1">Degrees of Freedom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#diagnosing-clustering-structure">Diagnosing Clustering Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#getting-a-clustering-recommendation">Getting a Clustering Recommendation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#checking-clustering-consistency">Checking Clustering Consistency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#wild-cluster-bootstrap">Wild Cluster Bootstrap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#clustering-workflow">Clustering Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#references-for-clustering">References for Clustering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#large-sample-asymptotic-inference">Large-Sample Asymptotic Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#asymptotic-theory">Asymptotic Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#doubly-robust-estimation">Doubly Robust Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#efficiency-considerations">Efficiency Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../methodological_notes.html#monte-carlo-simulation-evidence">Monte Carlo Simulation Evidence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#when-to-use-large-sample-methods">When to Use Large-Sample Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#inference-distribution-by-estimator">Inference Distribution by Estimator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#identification-assumptions">Identification Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#no-anticipation">No Anticipation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#parallel-trends">Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#common-treatment-timing-common-timing-mode">Common Treatment Timing (Common Timing Mode)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#treatment-persistence">Treatment Persistence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#heterogeneous-trends-and-assumption-cht">Heterogeneous Trends and Assumption CHT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#assumption-cht">Assumption CHT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#first-difference-under-cht">First Difference Under CHT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#choosing-between-demean-and-detrend">Choosing Between Demean and Detrend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#procedure-5-1-detrending-under-cht">Procedure 5.1: Detrending Under CHT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#testing-parallel-trends">Testing Parallel Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#diagnosing-heterogeneous-trends">Diagnosing Heterogeneous Trends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#getting-a-transformation-recommendation">Getting a Transformation Recommendation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#comparison-with-other-did-methods">Comparison with Other DiD Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#pre-treatment-period-dynamics">Pre-treatment Period Dynamics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#rolling-transformation-for-pre-treatment-periods">Rolling Transformation for Pre-treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#anchor-point-convention">Anchor Point Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#pre-treatment-att-estimation">Pre-treatment ATT Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#control-group-for-pre-treatment-periods">Control Group for Pre-treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#joint-test-for-parallel-trends">Joint Test for Parallel Trends</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#id2">Comparison with Other DiD Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#two-way-fixed-effects-twfe">Two-Way Fixed Effects (TWFE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#callaway-and-sant-anna-2021">Callaway and Sant’Anna (2021)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#when-to-use-this-method">When to Use This Method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#practical-considerations">Practical Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#sample-size-requirements">Sample Size Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#time-index-and-panel-structure">Time Index and Panel Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#pre-treatment-periods">Pre-Treatment Periods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#control-variables">Control Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#computational-considerations">Computational Considerations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#staggered-adoption">Staggered Adoption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#identification">Identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#transformation">Transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#control-group-strategies">Control Group Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#all-units-eventually-treated">All Units Eventually Treated</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#estimation-methods">Estimation Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#id3">Inference Distribution by Estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#aggregation">Aggregation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#robustness-to-pre-treatment-period-selection">Robustness to Pre-treatment Period Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#id4">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#sensitivity-ratio">Sensitivity Ratio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#using-robustness-pre-periods">Using robustness_pre_periods()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#no-anticipation-sensitivity">No-Anticipation Sensitivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#using-exclude-pre-periods-parameter">Using exclude_pre_periods Parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../methodological_notes.html#comprehensive-sensitivity-analysis">Comprehensive Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodological_notes.html#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#how-to-contribute">How to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#code-standards">Code Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#reporting-issues">Reporting Issues</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lwdid</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">API Reference</a></li>
      <li class="breadcrumb-item active">Transformations Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/transformations.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="transformations-module">
<h1>Transformations Module<a class="headerlink" href="#transformations-module" title="Link to this heading"></a></h1>
<p>Unit-specific panel data transformations for difference-in-differences.</p>
<p>This module implements unit-specific outcome transformations that remove
pre-treatment heterogeneity from panel data. Transformation parameters are
estimated using only pre-treatment observations, then applied out-of-sample
to all periods including post-treatment.</p>
<p>The transformations convert panel difference-in-differences estimation into
cross-sectional treatment effects problems, enabling the application of various
estimators (regression adjustment, inverse probability weighting, doubly robust,
matching) to the transformed outcomes.</p>
<p id="module-lwdid.transformations">Unit-specific panel data transformations for difference-in-differences.</p>
<p>This module implements unit-specific outcome transformations that remove
pre-treatment heterogeneity from panel data. Transformation parameters are
estimated using only pre-treatment observations, then applied out-of-sample
to all periods including post-treatment.</p>
<p>The transformations convert panel difference-in-differences estimation into
cross-sectional treatment effects problems. Under no anticipation and parallel
trends assumptions, standard treatment effect estimators (regression adjustment,
inverse probability weighting, doubly robust, matching) can be applied to the
transformed outcomes.</p>
<section id="available-transformations">
<h2>Available Transformations<a class="headerlink" href="#available-transformations" title="Link to this heading"></a></h2>
<dl>
<dt>demean</dt><dd><p>Removes unit-specific pre-treatment mean:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \bar{Y}_{i,pre}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{Y}_{i,pre} = T_0^{-1} \sum_{s&lt;g} Y_{is}\)</span>.
Requires at least 1 pre-treatment period per unit.</p>
</dd>
<dt>detrend</dt><dd><p>Removes unit-specific linear time trend:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\alpha}_i - \hat{\beta}_i t\]</div>
<p>where <span class="math notranslate nohighlight">\((\hat{\alpha}_i, \hat{\beta}_i)\)</span> are OLS estimates from
pre-treatment data. Requires at least 2 pre-treatment periods per unit.</p>
</dd>
<dt>demeanq</dt><dd><p>Removes unit-specific mean with quarterly seasonal fixed effects:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\mu}_i - \sum_{q=2}^{4} \hat{\gamma}_q D_q\]</div>
<p>where <span class="math notranslate nohighlight">\(D_q\)</span> are quarter dummies with the smallest observed quarter
as reference category. Requires <span class="math notranslate nohighlight">\(n_{pre} \geq Q + 1\)</span> per unit.</p>
</dd>
<dt>detrendq</dt><dd><p>Removes unit-specific linear trend with quarterly seasonal effects:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\alpha}_i - \hat{\beta}_i t
                - \sum_{q=2}^{4} \hat{\gamma}_q D_q\]</div>
<p>Requires <span class="math notranslate nohighlight">\(n_{pre} \geq Q + 2\)</span> per unit.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The transformations eliminate unit-specific level differences or trends that
may be correlated with treatment assignment. By removing these pre-treatment
patterns, the parallel trends assumption becomes an assumption about the
transformed outcomes rather than the original levels.</p>
<p>Time centering is applied in detrending methods to improve numerical stability
of OLS estimation. This reduces the condition number of the design matrix
without affecting the final residuals, as centering is an affine transformation
that preserves predicted values.</p>
</section>
<section id="id1">
<h2>Available Transformations<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<section id="demean">
<h3>demean<a class="headerlink" href="#demean" title="Link to this heading"></a></h3>
<p>Removes unit-specific pre-treatment mean:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \bar{Y}_{i,pre}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{Y}_{i,pre} = T_0^{-1} \sum_{s&lt;g} Y_{is}\)</span>.</p>
<p><strong>Requirements</strong>: At least 1 pre-treatment period per unit.</p>
<p><strong>Use case</strong>: Standard parallel trends assumption where treatment and control
groups have parallel outcome paths in levels.</p>
</section>
<section id="detrend">
<h3>detrend<a class="headerlink" href="#detrend" title="Link to this heading"></a></h3>
<p>Removes unit-specific linear time trend:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\alpha}_i - \hat{\beta}_i t\]</div>
<p>where <span class="math notranslate nohighlight">\((\hat{\alpha}_i, \hat{\beta}_i)\)</span> are OLS estimates from
pre-treatment data.</p>
<p><strong>Requirements</strong>: At least 2 pre-treatment periods per unit.</p>
<p><strong>Use case</strong>: Heterogeneous linear trends where treatment and control units
may follow different linear growth paths.</p>
</section>
<section id="demeanq">
<h3>demeanq<a class="headerlink" href="#demeanq" title="Link to this heading"></a></h3>
<p>Removes unit-specific mean with quarterly seasonal fixed effects:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\mu}_i - \sum_{q=2}^{4} \hat{\gamma}_q D_q\]</div>
<p>where <span class="math notranslate nohighlight">\(D_q\)</span> are quarter dummies with the smallest observed quarter
as reference category.</p>
<p><strong>Requirements</strong>: Quarterly data with quarter values in {1, 2, 3, 4}. Each
unit needs sufficient pre-treatment observations for seasonal pattern estimation.</p>
<p><strong>Use case</strong>: Quarterly data with seasonal patterns.</p>
</section>
<section id="detrendq">
<h3>detrendq<a class="headerlink" href="#detrendq" title="Link to this heading"></a></h3>
<p>Removes unit-specific linear trend with quarterly seasonal effects:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\alpha}_i - \hat{\beta}_i t
               - \sum_{q=2}^{4} \hat{\gamma}_q D_q\]</div>
<p><strong>Requirements</strong>: At least 2 pre-treatment periods per unit plus adequate
quarter diversity for seasonal estimation.</p>
<p><strong>Use case</strong>: Quarterly data with both trends and seasonal patterns.</p>
</section>
</section>
<section id="main-function">
<h2>Main Function<a class="headerlink" href="#main-function" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lwdid.transformations.apply_rolling_transform">
<span class="sig-prename descclassname"><span class="pre">lwdid.transformations.</span></span><span class="sig-name descname"><span class="pre">apply_rolling_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ivar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tindex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tpost1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quarter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season_var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Q</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_pre_periods</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/transformations.html#apply_rolling_transform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.transformations.apply_rolling_transform" title="Link to this definition"></a></dt>
<dd><p>Apply unit-specific transformation to panel data.</p>
<p>Dispatches to the appropriate transformation method (demean, detrend,
demeanq, or detrendq), computes post-treatment averages, and marks the
cross-sectional regression sample.</p>
<p>Transformation parameters are estimated from pre-treatment data only, then
applied out-of-sample to all observations to obtain residualized outcomes.
This out-of-sample application is essential for valid causal inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Panel data in long format with one row per unit-period observation.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of outcome variable.</p></li>
<li><p><strong>ivar</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of unit identifier.</p></li>
<li><p><strong>tindex</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of integer-valued time index.</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of binary post-treatment indicator (0=pre, 1=post).</p></li>
<li><p><strong>rolling</strong> (<em>{'demean'</em><em>, </em><em>'detrend'</em><em>, </em><em>'demeanq'</em><em>, </em><em>'detrendq'}</em>) – Transformation method to apply.</p></li>
<li><p><strong>tpost1</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a>) – First post-treatment period index. Identifies the cross-sectional
regression sample (firstpost=True for observations at tindex==tpost1).</p></li>
<li><p><strong>quarter</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) – Column name of quarter indicator (values in {1, 2, 3, 4}).
Required for quarterly methods (demeanq, detrendq) when Q=4.
Deprecated: use season_var instead for non-quarterly data.</p></li>
<li><p><strong>season_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) – Column name of seasonal indicator variable. Values should be integers
from 1 to Q. This is the preferred parameter for seasonal methods.
If both quarter and season_var are provided, season_var takes precedence.</p></li>
<li><p><strong>Q</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 4</em>) – Number of seasonal periods per cycle. Common values:
- 4: Quarterly data (default)
- 12: Monthly data
- 52: Weekly data</p></li>
<li><p><strong>exclude_pre_periods</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 0</em>) – Number of pre-treatment periods to exclude immediately before treatment.
Used to address potential anticipation effects. When &gt; 0, the last
<code class="docutils literal notranslate"><span class="pre">exclude_pre_periods</span></code> pre-treatment periods are excluded from the
sample used for estimating transformation parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Copy of input data with added columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ydot</span></code>: Transformed (residualized) outcome for each observation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ydot_postavg</span></code>: Post-treatment average of ydot per unit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firstpost</span></code>: Boolean indicator for cross-sectional regression sample.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientPrePeriodsError" title="lwdid.exceptions.InsufficientPrePeriodsError"><strong>InsufficientPrePeriodsError</strong></a> – If any unit has insufficient pre-treatment observations for the
    chosen transformation method.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If rolling method is invalid or seasonal method lacks season_var/quarter.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.transformations._demean_transform" title="lwdid.transformations._demean_transform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_demean_transform</span></code></a></dt><dd><p>Unit-specific demeaning implementation.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.transformations._detrend_transform" title="lwdid.transformations._detrend_transform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_detrend_transform</span></code></a></dt><dd><p>Unit-specific detrending implementation.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.transformations.demeanq_unit" title="lwdid.transformations.demeanq_unit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">demeanq_unit</span></code></a></dt><dd><p>Seasonal demeaning for a single unit.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.transformations.detrendq_unit" title="lwdid.transformations.detrendq_unit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detrendq_unit</span></code></a></dt><dd><p>Seasonal detrending for a single unit.</p>
</dd>
</dl>
</div>
</dd></dl>

</section>
<section id="unit-level-functions">
<h2>Unit-Level Functions<a class="headerlink" href="#unit-level-functions" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lwdid.transformations.detrend_unit">
<span class="sig-prename descclassname"><span class="pre">lwdid.transformations.</span></span><span class="sig-name descname"><span class="pre">detrend_unit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unit_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tindex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/transformations.html#detrend_unit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.transformations.detrend_unit" title="Link to this definition"></a></dt>
<dd><p>Remove unit-specific linear time trend for a single unit.</p>
<p>Estimates <span class="math notranslate nohighlight">\(Y_{it} = \alpha + \beta t + \varepsilon\)</span> via OLS using
pre-treatment observations only, then computes out-of-sample residuals
for all periods:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\alpha} - \hat{\beta} t\]</div>
<p>This transformation removes unit-specific linear trends that may violate
the parallel trends assumption in levels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unit_data</strong> (<em>pd.DataFrame</em>) – Data for a single unit containing all time periods.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of outcome variable.</p></li>
<li><p><strong>tindex</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of time index.</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of binary post-treatment indicator (0=pre, 1=post).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>[<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>yhat_all</strong> (<em>ndarray</em>) – Fitted values <span class="math notranslate nohighlight">\(\hat{\alpha} + \hat{\beta} t\)</span> for all periods.
Returns NaN array if estimation fails.</p></li>
<li><p><strong>ydot</strong> (<em>ndarray</em>) – Detrended outcomes for all periods. Returns NaN array if estimation
fails due to numerical issues.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Time centering at the pre-treatment mean improves numerical stability by
reducing the condition number of <span class="math notranslate nohighlight">\(X'X\)</span>. Centering is an affine
transformation that preserves predicted values.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.transformations._detrend_transform" title="lwdid.transformations._detrend_transform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_detrend_transform</span></code></a></dt><dd><p>Apply detrending to all units in panel data.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lwdid.transformations.demeanq_unit">
<span class="sig-prename descclassname"><span class="pre">lwdid.transformations.</span></span><span class="sig-name descname"><span class="pre">demeanq_unit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unit_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season_var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Q</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/transformations.html#demeanq_unit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.transformations.demeanq_unit" title="Link to this definition"></a></dt>
<dd><p>Remove unit-specific mean with seasonal fixed effects.</p>
<p>Estimates a seasonal mean model using pre-treatment observations:</p>
<div class="math notranslate nohighlight">
\[Y_{it} = \mu + \sum_{q=2}^{Q} \gamma_q D_q + \varepsilon_{it}\]</div>
<p>where <span class="math notranslate nohighlight">\(D_q\)</span> are seasonal dummies. The smallest observed season serves
as the reference category for identification.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unit_data</strong> (<em>pd.DataFrame</em>) – Data for a single unit containing all time periods.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of outcome variable.</p></li>
<li><p><strong>season_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of seasonal indicator variable. Values should be integers
from 1 to Q representing seasonal periods (e.g., quarters 1-4, months
1-12, or weeks 1-52).</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of binary post-treatment indicator (0=pre, 1=post).</p></li>
<li><p><strong>Q</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 4</em>) – Number of seasonal periods per cycle. Common values:
- 4: Quarterly data (default)
- 12: Monthly data
- 52: Weekly data</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>[<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>yhat_all</strong> (<em>ndarray</em>) – Fitted values <span class="math notranslate nohighlight">\(\hat{\mu} + \sum_q \hat{\gamma}_q D_q\)</span> for
all periods. Returns NaN array if estimation fails.</p></li>
<li><p><strong>ydot</strong> (<em>ndarray</em>) – Seasonally-adjusted demeaned outcomes for all periods. Returns NaN
array if estimation fails due to numerical issues.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Using observed seasons rather than all Q seasons as categories
prevents rank-deficient design matrices when some seasons are absent
from pre-treatment data.</p>
<p>The minimum required pre-treatment observations is Q + 1 to ensure
at least one residual degree of freedom for OLS estimation.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.transformations.detrendq_unit" title="lwdid.transformations.detrendq_unit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detrendq_unit</span></code></a></dt><dd><p>Combines seasonal adjustment with linear trend removal.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lwdid.transformations.detrendq_unit">
<span class="sig-prename descclassname"><span class="pre">lwdid.transformations.</span></span><span class="sig-name descname"><span class="pre">detrendq_unit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unit_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tindex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season_var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Q</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/transformations.html#detrendq_unit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.transformations.detrendq_unit" title="Link to this definition"></a></dt>
<dd><p>Remove unit-specific linear trend with seasonal fixed effects.</p>
<p>Estimates a combined trend and seasonal model using pre-treatment data:</p>
<div class="math notranslate nohighlight">
\[Y_{it} = \alpha + \beta t + \sum_{q=2}^{Q} \gamma_q D_q + \varepsilon_{it}\]</div>
<p>The smallest observed season serves as the reference category. Time is
centered at its pre-treatment mean for numerical stability.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unit_data</strong> (<em>pd.DataFrame</em>) – Data for a single unit containing all time periods.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of outcome variable.</p></li>
<li><p><strong>tindex</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of time index.</p></li>
<li><p><strong>season_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of seasonal indicator variable. Values should be integers
from 1 to Q representing seasonal periods (e.g., quarters 1-4, months
1-12, or weeks 1-52).</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of binary post-treatment indicator (0=pre, 1=post).</p></li>
<li><p><strong>Q</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 4</em>) – Number of seasonal periods per cycle. Common values:
- 4: Quarterly data (default)
- 12: Monthly data
- 52: Weekly data</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>[<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>yhat_all</strong> (<em>ndarray</em>) – Fitted values for all periods. Returns NaN array if estimation fails.</p></li>
<li><p><strong>ydot</strong> (<em>ndarray</em>) – Seasonally-adjusted detrended outcomes for all periods. Returns NaN
array if estimation fails due to numerical issues.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This transformation combines trend removal and seasonal adjustment,
accounting for both unit-specific growth patterns and seasonal cycles.
Time centering reduces the condition number of the design matrix without
affecting predicted values.</p>
<p>The minimum required pre-treatment observations is Q + 2 to ensure
at least one residual degree of freedom for OLS estimation (intercept +
slope + Q-1 seasonal dummies = Q+1 parameters).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.transformations.demeanq_unit" title="lwdid.transformations.demeanq_unit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">demeanq_unit</span></code></a></dt><dd><p>Seasonal adjustment without trend removal.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.transformations.detrend_unit" title="lwdid.transformations.detrend_unit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detrend_unit</span></code></a></dt><dd><p>Linear trend removal without seasonal adjustment.</p>
</dd>
</dl>
</div>
</dd></dl>

</section>
<section id="internal-functions">
<h2>Internal Functions<a class="headerlink" href="#internal-functions" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lwdid.transformations._demean_transform">
<span class="sig-prename descclassname"><span class="pre">lwdid.transformations.</span></span><span class="sig-name descname"><span class="pre">_demean_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ivar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/transformations.html#_demean_transform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.transformations._demean_transform" title="Link to this definition"></a></dt>
<dd><p>Apply unit-specific demeaning transformation to all units.</p>
<p>Computes <span class="math notranslate nohighlight">\(\dot{Y}_{it} = Y_{it} - \bar{Y}_{i,pre}\)</span> for all
observations, where <span class="math notranslate nohighlight">\(\bar{Y}_{i,pre}\)</span> is the pre-treatment mean:</p>
<div class="math notranslate nohighlight">
\[\bar{Y}_{i,pre} = T_{0i}^{-1} \sum_{t: \text{post}=0} Y_{it}\]</div>
<p>This transformation removes unit-specific level heterogeneity that may
be correlated with treatment assignment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Panel data containing outcome and post indicator columns.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of outcome variable.</p></li>
<li><p><strong>ivar</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of unit identifier.</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of binary post-treatment indicator (0=pre, 1=post).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Input data with <code class="docutils literal notranslate"><span class="pre">ydot</span></code> column containing demeaned outcomes.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientPrePeriodsError" title="lwdid.exceptions.InsufficientPrePeriodsError"><strong>InsufficientPrePeriodsError</strong></a> – If any unit has no pre-treatment observations.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.transformations._detrend_transform" title="lwdid.transformations._detrend_transform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_detrend_transform</span></code></a></dt><dd><p>Removes unit-specific linear trends.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lwdid.transformations._detrend_transform">
<span class="sig-prename descclassname"><span class="pre">lwdid.transformations.</span></span><span class="sig-name descname"><span class="pre">_detrend_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ivar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tindex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/lwdid/transformations.html#_detrend_transform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lwdid.transformations._detrend_transform" title="Link to this definition"></a></dt>
<dd><p>Apply unit-specific linear detrending transformation to all units.</p>
<p>For each unit i, estimates a linear trend from pre-treatment data and
computes out-of-sample residuals:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{it} = Y_{it} - \hat{\alpha}_i - \hat{\beta}_i t\]</div>
<p>This transformation removes unit-specific linear trends that may violate
the parallel trends assumption when trends differ across treatment groups.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – Panel data containing outcome, time index, and post indicator columns.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of outcome variable.</p></li>
<li><p><strong>ivar</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of unit identifier.</p></li>
<li><p><strong>tindex</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of integer-valued time index.</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Column name of binary post-treatment indicator (0=pre, 1=post).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Input data with <code class="docutils literal notranslate"><span class="pre">ydot</span></code> column containing detrended outcomes.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#lwdid.exceptions.InsufficientPrePeriodsError" title="lwdid.exceptions.InsufficientPrePeriodsError"><strong>InsufficientPrePeriodsError</strong></a> – If any unit has fewer than 2 pre-treatment observations.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#lwdid.transformations.detrend_unit" title="lwdid.transformations.detrend_unit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detrend_unit</span></code></a></dt><dd><p>Detrending implementation for a single unit.</p>
</dd>
<dt><a class="reference internal" href="#lwdid.transformations._demean_transform" title="lwdid.transformations._demean_transform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_demean_transform</span></code></a></dt><dd><p>Removes unit-specific means instead of trends.</p>
</dd>
</dl>
</div>
</dd></dl>

</section>
<section id="example-usage">
<h2>Example Usage<a class="headerlink" href="#example-usage" title="Link to this heading"></a></h2>
<p>The transformation is automatically applied by the main <code class="docutils literal notranslate"><span class="pre">lwdid()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">lwdid</span>

<span class="c1"># Standard demeaning (parallel trends in levels)</span>
<span class="n">results_dm</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
                   <span class="n">post</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;demean&#39;</span><span class="p">)</span>

<span class="c1"># Detrending (allows heterogeneous linear trends)</span>
<span class="n">results_dt</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
                   <span class="n">post</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;detrend&#39;</span><span class="p">)</span>

<span class="c1"># Quarterly demeaning with seasonality</span>
<span class="n">results_dmq</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
                    <span class="n">tvar</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;quarter&#39;</span><span class="p">],</span>  <span class="c1"># Composite time variable</span>
                    <span class="n">post</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;demeanq&#39;</span><span class="p">)</span>

<span class="c1"># Quarterly detrending with seasonality</span>
<span class="n">results_dtq</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
                    <span class="n">tvar</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;quarter&#39;</span><span class="p">],</span>  <span class="c1"># Composite time variable</span>
                    <span class="n">post</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;detrendq&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="transformation-selection-guide">
<h2>Transformation Selection Guide<a class="headerlink" href="#transformation-selection-guide" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>demean</strong>: Pre-periods required &gt;= 1. No seasonal support. Assumes parallel
levels (common trends).</p></li>
<li><p><strong>detrend</strong>: Pre-periods required &gt;= 2. No seasonal support. Allows
heterogeneous linear trends.</p></li>
<li><p><strong>demeanq</strong>: Pre-periods required &gt;= 1. Quarterly seasonal support. Assumes
parallel levels (common trends).</p></li>
<li><p><strong>detrendq</strong>: Pre-periods required &gt;= 2. Quarterly seasonal support. Allows
heterogeneous linear trends.</p></li>
</ul>
</section>
<section id="staggered-adoption-transformations">
<h2>Staggered Adoption Transformations<a class="headerlink" href="#staggered-adoption-transformations" title="Link to this heading"></a></h2>
<p>For staggered adoption designs, transformations are applied separately for each
treatment cohort <span class="math notranslate nohighlight">\(g\)</span>, using cohort-specific pre-treatment periods. This
approach follows Lee and Wooldridge (2025, Section 4).</p>
<section id="cohort-specific-demeaning">
<h3>Cohort-Specific Demeaning<a class="headerlink" href="#cohort-specific-demeaning" title="Link to this heading"></a></h3>
<p>For cohort <span class="math notranslate nohighlight">\(g\)</span> (units first treated in period <span class="math notranslate nohighlight">\(g\)</span>) and calendar
time <span class="math notranslate nohighlight">\(r \geq g\)</span>, the transformed outcome is computed as:</p>
<div class="math notranslate nohighlight">
\[\dot{Y}_{irg} = Y_{ir} - \bar{Y}_{i,pre(g)}\]</div>
<p>where the cohort-specific pre-treatment mean is:</p>
<div class="math notranslate nohighlight">
\[\bar{Y}_{i,pre(g)} = \frac{1}{g-1} \sum_{s=1}^{g-1} Y_{is}\]</div>
<p>The key difference from common timing demeaning is that the pre-treatment
average uses only periods <span class="math notranslate nohighlight">\(\{1, 2, \ldots, g-1\}\)</span> specific to each
cohort, rather than a fixed set of pre-treatment periods for all units.</p>
<p><strong>Requirements</strong>: For each cohort <span class="math notranslate nohighlight">\(g\)</span>, at least <span class="math notranslate nohighlight">\(g - 1 \geq 1\)</span>
pre-treatment periods must exist. Early cohorts (e.g., <span class="math notranslate nohighlight">\(g = 2\)</span>) may
have limited pre-treatment data.</p>
</section>
<section id="cohort-specific-detrending">
<h3>Cohort-Specific Detrending<a class="headerlink" href="#cohort-specific-detrending" title="Link to this heading"></a></h3>
<p>For cohort <span class="math notranslate nohighlight">\(g\)</span> and calendar time <span class="math notranslate nohighlight">\(r \geq g\)</span>, the detrended outcome
is:</p>
<div class="math notranslate nohighlight">
\[\ddot{Y}_{irg} = Y_{ir} - \hat{A}_{ig} - \hat{B}_{ig} \cdot r\]</div>
<p>where <span class="math notranslate nohighlight">\((\hat{A}_{ig}, \hat{B}_{ig})\)</span> are estimated from the unit-specific
regression using only pre-treatment periods for cohort <span class="math notranslate nohighlight">\(g\)</span>:</p>
<div class="math notranslate nohighlight">
\[Y_{it} = A_i + B_i \cdot t + \varepsilon_{it}, \quad t \in \{1, 2, \ldots, g-1\}\]</div>
<p>This removes both unit-specific levels and unit-specific linear trends,
allowing for heterogeneous trend paths across units while preserving the
treatment variation for estimation.</p>
<p><strong>Requirements</strong>: For each cohort <span class="math notranslate nohighlight">\(g\)</span>, at least <span class="math notranslate nohighlight">\(g - 1 \geq 2\)</span>
pre-treatment periods must exist to estimate both intercept and slope.</p>
</section>
<section id="staggered-transformation-usage">
<h3>Staggered Transformation Usage<a class="headerlink" href="#staggered-transformation-usage" title="Link to this heading"></a></h3>
<p>The staggered transformations are applied automatically when the <code class="docutils literal notranslate"><span class="pre">gvar</span></code>
parameter is specified in <code class="docutils literal notranslate"><span class="pre">lwdid()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lwdid</span><span class="w"> </span><span class="kn">import</span> <span class="n">lwdid</span>

<span class="c1"># Staggered demeaning</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span>
    <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span>
    <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat_year&#39;</span><span class="p">,</span>  <span class="c1"># Cohort indicator</span>
    <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;demean&#39;</span>
<span class="p">)</span>

<span class="c1"># Staggered detrending</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span>
    <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span>
    <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat_year&#39;</span><span class="p">,</span>
    <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;detrend&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="staggered-seasonal-transformations">
<h3>Staggered Seasonal Transformations<a class="headerlink" href="#staggered-seasonal-transformations" title="Link to this heading"></a></h3>
<p><strong>Seasonal transformations are fully supported in staggered mode.</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">demeanq</span></code> and <code class="docutils literal notranslate"><span class="pre">detrendq</span></code> transformations can be used with staggered
adoption designs (<code class="docutils literal notranslate"><span class="pre">gvar</span></code> parameter). For each cohort <span class="math notranslate nohighlight">\(g\)</span>, seasonal
parameters are estimated using only the cohort-specific pre-treatment periods
<span class="math notranslate nohighlight">\(\{1, 2, \ldots, g-1\}\)</span>.</p>
<p><strong>Key considerations for staggered seasonal methods:</strong></p>
<ol class="arabic simple">
<li><p><strong>Pre-treatment requirements</strong>: Each cohort must have sufficient pre-treatment
observations spanning enough seasonal periods for reliable parameter estimation.
Early cohorts with limited pre-treatment data may be excluded automatically.</p></li>
<li><p><strong>Seasonal coverage</strong>: For accurate seasonal adjustment, pre-treatment periods
should ideally cover at least one complete seasonal cycle (e.g., 4 quarters for
quarterly data, 12 months for monthly data).</p></li>
<li><p><strong>Data frequency</strong>: Seasonal transformations are most relevant for sub-annual
data (quarterly, monthly, weekly) where seasonal patterns affect outcomes.</p></li>
</ol>
<p><strong>Usage example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Staggered design with quarterly seasonal adjustment</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">lwdid</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outcome&#39;</span><span class="p">,</span>
    <span class="n">ivar</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span>
    <span class="n">tvar</span><span class="o">=</span><span class="s1">&#39;quarter_index&#39;</span><span class="p">,</span>
    <span class="n">gvar</span><span class="o">=</span><span class="s1">&#39;first_treat_quarter&#39;</span><span class="p">,</span>
    <span class="n">rolling</span><span class="o">=</span><span class="s1">&#39;demeanq&#39;</span><span class="p">,</span>
    <span class="n">Q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>                      <span class="c1"># Quarterly data</span>
    <span class="n">season_var</span><span class="o">=</span><span class="s1">&#39;quarter&#39;</span>      <span class="c1"># Quarter indicator (1-4)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="staggered-transformation-selection">
<h3>Staggered Transformation Selection<a class="headerlink" href="#staggered-transformation-selection" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>demean</strong>: Staggered support = Yes. Pre-periods required:
<span class="math notranslate nohighlight">\(g - 1 \geq 1\)</span> per cohort.</p></li>
<li><p><strong>detrend</strong>: Staggered support = Yes. Pre-periods required:
<span class="math notranslate nohighlight">\(g - 1 \geq 2\)</span> per cohort.</p></li>
<li><p><strong>demeanq</strong>: Staggered support = Yes. Pre-periods required:
<span class="math notranslate nohighlight">\(g - 1 \geq Q + 1\)</span> per cohort (where Q = number of seasons).</p></li>
<li><p><strong>detrendq</strong>: Staggered support = Yes. Pre-periods required:
<span class="math notranslate nohighlight">\(g - 1 \geq Q + 2\)</span> per cohort (where Q = number of seasons).</p></li>
</ul>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<p><a class="reference internal" href="core.html#lwdid.lwdid" title="lwdid.lwdid"><code class="xref py py-func docutils literal notranslate"><span class="pre">lwdid.lwdid()</span></code></a> : Main estimation function.
<a class="reference internal" href="../methodological_notes.html"><span class="doc">Methodological Notes</span></a> : Theoretical foundations of transformations.
<a class="reference internal" href="../user_guide.html"><span class="doc">User Guide</span></a> : Practical guidance on transformation selection.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="staggered.html" class="btn btn-neutral float-left" title="Staggered DiD Module (staggered)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="estimation.html" class="btn btn-neutral float-right" title="Estimation Module (estimation)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Xuanyu Cai, Wenli Xu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>